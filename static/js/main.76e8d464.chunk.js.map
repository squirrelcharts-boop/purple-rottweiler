{"version":3,"sources":["redux/actions.ts","redux/selectors.ts","data/tagUtils.ts","styled/mixins/layout.ts","icons/FontAwesomeIcons.tsx","components/designsystem/Buttons.tsx","styled/mixins/theming.ts","data/types.ts","styled/mixins/gap.ts","styled/zIndex.ts","data/browserUtils.ts","data/utils.ts","hooks/useAction.tsx","hooks/usePreference.tsx","components/designsystem/Text.tsx","misc/formatting.ts","components/designsystem/Surface.tsx","components/designsystem/FlexImage.tsx","icons/TypeIcon.tsx","styled/mixins/scrollbar.ts","components/designsystem/Toggle.tsx","components/designsystem/LabeledToggle.tsx","styled/mixins/media.ts","client/tagUtils.ts","components/designsystem/FlexPair.tsx","styled/mixins/shadow.ts","hooks/useToggleTag.tsx","hooks/useToggle.ts","components/designsystem/ModifierStyledText.tsx","components/tag/TagName.tsx","components/tag/Alias.tsx","components/tag/AliasesList.tsx","components/tag/ChipWrapper.tsx","components/tag/TagChip.tsx","components/tag/Supertag.tsx","components/tag/BiasedTag.tsx","components/tag/Tag.tsx","components/tag/TagList.tsx","icons/OutOfResults.png","icons/Loading.tsx","components/designsystem/Lines.tsx","hooks/useModifier.tsx","components/widgets/ActiveTags.tsx","hooks/useCheckIsActive.ts","hooks/useActivateTag.ts","components/tagSelector/DropdownListEntry.tsx","components/tagSelector/DropdownListError.tsx","components/tagSelector/DropdownList.tsx","components/tagSelector/TagInput.tsx","components/tagSelector/TagSelector.tsx","components/features/ErrorBoundary.tsx","components/features/GlobalKeybindings.tsx","client/firebase/signIn.ts","client/firebase/genericConverter.ts","client/firebase/storage.ts","client/utils.ts","client/firebase/analytics.ts","client/firebase/index.ts","components/widgets/ResetButton.tsx","GlobalStyles.tsx","components/pages/ErrorScreen.tsx","components/pages/LoadingScreen.tsx","components/designsystem/Modal.tsx","icons/eeek.png","components/widgets/CellularWarningModal.tsx","components/widgets/CookieConfirmation.tsx","components/widgets/SupertagModal.tsx","analytics/events.ts","redux/middleware/analytics.ts","redux/reducers/preferences.ts","redux/middleware/persistence.ts","redux/middleware/requests.ts","client/R34Client.ts","redux/middleware/index.ts","redux/migrations.ts","redux/reducers/results.ts","redux/reducers/tags.ts","redux/reducers/fullscreen.ts","redux/reducers/likes.ts","redux/reducers/modals.ts","redux/reducers/suggestions.ts","redux/reducers/index.ts","redux/store.ts","App.tsx","serviceWorkerRegistration.ts","index.tsx"],"names":["ADD_ALIASES","ADD_POSTS","ADD_TAG","CLOSE_MODAL","ENTER_FULLSCREEN","EXIT_FULLSCREEN","FETCH_COMMENTS","FETCH_PREFERENCES","FETCH_SUGGESTIONS","GET_MORE_RESULTS","GET_RESULTS","LIKE_POST","OPEN_MODAL","REMOVE_TAG","SAVE_PREFERENCES","SET_COMMENTS","SET_FULLSCREEN_POST","SET_POSTS","SET_PREFERENCE","SET_PREFERENCES","SET_SUGGESTIONS","SET_SUGGESTIONS_ERROR","SET_SUGGESTIONS_MODIFIER","SCROLL_TO_POST","addTag","tag","type","removeTag","tagName","addAliases","aliases","forTag","addPosts","posts","setPosts","count","pageNumber","arguments","length","undefined","setComments","postId","comments","fetchComments","setPreference","key","value","setPreferences","preferences","getResults","getMoreResults","setFullscreenPost","index","scrollToPost","likePost","openModal","modalId","closeModal","setSuggestions","suggestions","setSuggestionsError","error","fetchSuggestions","includeSupertags","savePreferences","setSuggestionsModifier","modifier","selectActiveTags","state","tags","active","selectActiveThemeId","themeId","selectAliases","selectAutoPlay","autoPlay","selectCookies","cookies","selectCount","results","selectOpenModalId","modals","selectOriginals","originals","selectPageNumber","selectPageSize","pageSize","selectPosts","selectPreferences","selectPreloadVideos","preloadVideos","selectPreloadGifs","selectResultsLayout","resultsLayout","selectShowComments","showComments","selectShowMetadata","showMetadata","selectSort","sort","selectSuggestions","entries","selectSuggestionsError","selectSuggestionsModifier","selectTagSuggestionCount","tagSuggestionsCount","selectUpdated","updated","selectAutoscrollDelay","autoscrollDelay","selectShowPostDetails","showPostDetails","selectNumberOfActiveTags","createSelector","Object","keys","selectAliasesAsList","values","flat","selectOutOfResults","selectHasMoreResults","outOfResults","selectLastPage","Math","ceil","selectFullScreenPost","fullscreen","currentIndex","fullScreenIndex","selectFullScreenIndex","fullScreenPost","indexOf","selectMinRating","rated","ratedThreshold","selectSupertagModalOpen","selectedIndex","ModalId","CREATE_SUPERTAG","selectCellularWarningModalOpen","CELLULAR_WARNING","selectPostById","defaultMemoize","id","find","post","selectLikedByPostId","likes","selectActiveSupertagTags","activeTags","filter","isSupertag","reduce","result","_objectSpread","serializeTagname","tagname","encodeURIComponent","toLowerCase","replace","bias","isBiased","getInterestingType","types","t","match","isSuggestionError","message","multilineList","_ref","theme","css","_templateObject","_taggedTemplateLiteral","flexRowGap","dimensions","bigSpacing","flexColumnGap","flexColumn","_templateObject2","flexColumnWithGap","_ref2","_templateObject3","gridWithGap","_ref3","_templateObject4","gap","flexRowWithGap","_ref4","_templateObject5","centeredMaxWidth","_ref5","_templateObject6","bodyWidth","defaultBlock","_ref6","_templateObject7","blockHeight","fullscreenOverlay","_templateObject8","coverScreen","_templateObject9","buttonBaseStyle","_ref7","_templateObject0","borderRadius","fontSizes","content","defaultRowSpacing","transitionAll","bindIcon","icon","React","memo","props","_jsx","FontAwesomeIcon","ArrowDown","faCaretDown","ArtistIcon","faPen","CalendarIcon","faCalendarDay","CharacterIcon","faUser","CheckIcon","faCheckSquare","CloseIcon","faTimes","CopyrightIcon","faCodeBranch","faCopy","faCopyright","DeviantArtIcon","faDeviantart","DiscordIcon","faDiscord","DownloadIcon","faDownload","ExpandIcon","faExpand","ExternalLinkIcon","faExternalLinkAlt","FailedIcon","faTimesCircle","HeartIcon","faGithub","faGoogle","faHeart","ImageIcon","faImage","LinkIcon","faLink","MetaDataIcon","faInfoCircle","PatreonIcon","faPatreon","RatingIcon","faPlus","faUserShield","faRegistered","SearchIcon","faSearch","SourceIcon","faCog","faShareAlt","faSignOutAlt","faHashtag","SuccessIcon","faCheckCircle","SupertagIcon","faTags","TumblrIcon","faScroll","faTumblr","TwitterIcon","faTwitter","UndoIcon","faUndoAlt","WrenchIcon","faWrench","ForwardIcon","faForward","BackwardIcon","faBackward","SubmitIcon","faArrowRight","ArrowUp","faArrowUp","TextButton","styled","button","LinkButton","a","hugeSpacing","colors","layerBg","text","InvisButton","dropShadow","PrimaryButton","primary","BlockButton","AddButton","ModifierButton","defaultBorder","timings","transitionTime","accentColor","borderWidth","disabled","backgroundColor","subduedText","pointerInteraction","secondary","foreground","focus","backgroundColor2","layer","_ref8","solidLayer","_ref9","layerBgSolid","defaultInput","_ref0","RouteName","NO_OP","amount","supportsGap","supportsFlexGap","defaultSpacing","ZIndex","flex","document","createElement","style","display","flexDirection","rowGap","appendChild","body","isSupported","scrollHeight","parentNode","removeChild","supportsAspectRatio","fullscreenEnabled","navigator","Boolean","localStorage","listToMap","list","keyProp","current","parseUrl","URL","err","versionToNumber","majorMinorPatch","Number","split","join","download","url","filename","pop","fetch","concat","then","response","blob","href","window","createObjectURL","click","remove","catch","e","console","getVersion","_process","_process$env","process","REACT_APP_VERSION","getVersionString","version","boolToNumber","randomBelow","max","floor","random","useAction","actionCreator","dispatch","useDispatch","useCallback","usePreference","useSelector","setValue","Title","h2","bigTitle","BigTitle","h1","SmallTitle","h3","Faded","span","formatCount","trunc","toString","formatSource","source","host","formatDuration","duration","min","sec","formatTagname","formatTagnameAndCount","name","z","formatDatetime","date","dd","getDate","MM","getMonth","yyyy","getFullYear","hh","getHours","mm","getMinutes","formatTime","milliseconds","formatUnit","unitSize","unit","toFixed","unitString","Surface","div","SolidSurface","FlexImage","img","flexMedia","preserveAspectRatio","TypeIcon","className","dropdownScrollbar","Track","longTransitionTime","Thumb","toggleOff","Toggle","onToggle","onClick","role","children","LabeledToggle","_jsxs","FlexPair","mediaStyle","width","height","serializeAllTags","resolvedTags","forEach","push","flattenSupertags","tagsByModifier","_result$current$modif","groupTagsByModifier","normalTags","map","serializeTag","optionalTags","shadow","radius","color","useToggleTag","useToggle","initialValue","useState","toggleValue","resetValue","modifierToStyle","ModifierStyledText","TagName","AliasWrapper","Alias","handleClick","event","stopPropagation","ListWrapper","parentRef","clientRect","getBoundingClientRect","offsetTop","offsetLeft","DROPDOWN","AliasesList","ChipWrapper","switchingColors","collapsed","dropdownBorderRadius","DropdownArrow","$collapsed","DropdownWrapper","TagChip","isActive","detailed","onContextMenu","tagRef","setTagRef","toggleCollapsed","preventDefault","handleArrowClick","handleEnter","handleContextMenu","onKeyDown","ref","tabIndex","title","Supertag","BiasedTag","Tag","biasedTag","TagListWrapper","TagList","onTagClick","getIsActive","onTagMenu","StyledSvg","svg","Loading","xmlns","xmlnsXlink","viewBox","xmlSpace","fill","stroke","cx","cy","r","attributeName","dur","repeatCount","begin","HorizontalLine","layerBgHighlight","order","useModifier","nextModifier","ActiveTags","onChange","offerSupertags","numberOfActiveTags","openSupertagModal","toggleTag","checkIsActive","useCheckIsActive","nextModifer","useEffect","activeSupertagsTags","useActivateTag","EntryWrapper","Name","Count","Icon","DropdownListEntry","DropdownListError","tagSelectorRef","tagSelector","clientHeight","clientWidth","sizeAndPosition","DropdownList","entry","Input","input","TagInput","onSubmit","handleChange","target","placeholder","TagSelectorWrapper","form","closed","TagSelector","showSupertags","setTagSelectorRef","activateTag","useThrottledEffect","handleAddClick","trim","sanitizedTagname","suggestion","s","showList","ErrorBoundary","Component","constructor","super","this","hasError","getDerivedStateFromError","render","fallback","keybinds","/","_document$getElementB","getElementById","ctrl+1","location","hash","SEARCH","ctrl+2","PREFERENCES","ctrl+3","ABOUT","GlobalKeybindings","handler","pressed","ctrlKey","addEventListener","removeEventListener","googleAuthProvider","initialized","GenericConverter","toFirestore","data","fromFirestore","snapshot","options","userConverter","async","getUserDoc","log","currentUser","firebase","auth","email","msgBuffer","TextEncoder","encode","hashBuffer","crypto","subtle","digest","Array","from","Uint8Array","b","padStart","sha256","firestore","collection","doc","warn","getPreferences","userData","userDoc","withConverter","get","getUserData","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","init","initializeApp","GoogleAuthProvider","ResetButton","reset","_localStorage","clear","signOut","code","reload","createGlobalStyle","FullScreenCentered","ErrorScreen","themes","defaultThemeId","GlobalStyles","src","outOfResultsPicture","alt","LoadingScreen","Wrapper","MODAL","backdrop","ModalSurface","modalWidth","Modal","close","blockEvent","ButtonRow","CellularWarningModal","search","onConfirm","onCancel","setAutoPlay","toggleAutoPlay","setPreloadVideos","togglePreloadVideos","setOriginals","toggleOriginals","eeek","CookieWrapper","COOKIEBAR","StyledSpan","CookieConfirmation","setCookies","handleAccept","StyledInput","SupertagModal","setName","description","setDescription","handleCreate","set","addSupertag","AnalyticsEventId","eventLogging","store","next","action","getState","analytics","logEvent","payload","page_number","initialPreferencesState","hideSeen","backends","produce","draft","assign","saveTimeout","persistence","clearTimeout","setTimeout","firebaseFunctions","newPreferences","client","currentBackend","useFirebase","postLimit","tagLimit","requestRetries","verbose","parseComment","comment","attr","useNextBackend","getFullUrl","path","params","acc","append","asString","URLSearchParams","createSearchParams","fetchWithFailover","fetchOptions","retries","res","ok","status","fetchTags","_params$name","replaceAll","fetched","json","isArray","Error","label","substring","lastIndexOf","getTags","supertags","sanitzedName","snap","getSupertags","matchingSupertags","_","includes","details","_unused","getPostsUrl","limit","serializedTags","getCountUrl","getPosts","_params$limit","_params$page","paramsInternal","pid","page","score","postsResponse","countResponse","countText","countXml","DOMParser","parseFromString","getElementsByTagName","getAttribute","x","change","parsePost","file_url","parent_id","sample_url","sample_width","sample_height","preview_url","rating","comment_count","has_comments","array","comments_url","creator_url","endsWith","getAliases","getComments","commentsUrl","xml","newComment","attributes","getArtist","apiRequests","hasMoreResults","_payload","_payload$preferences","minRating","sanitizedAliases","alias","mode","middleware","composeWithDevTools","applyMiddleware","requests","migrations","reader","initialResultsState","Date","getTime","postCount","postIndex","findIndex","p","initialTagsState","newTag","initialFullscreenState","isEnabled","scrollIndex","initialLikesState","now","initialModalsState","setOpenModal","initialSuggestionsState","setError","setModifier","combineReducers","enterFullscreen","setIndex","exitFullscreen","setScrollIndex","persistConfig","storage","migrate","createMigrate","persistedReducer","persistReducer","rootReducer","createStore","persistor","persistStore","Search","lazy","loadingScreen","App","Provider","PersistGate","loading","ThemedApp","isCellularWarningModalOpen","isSupertagModalOpen","ThemeProvider","Helmet","HashRouter","Suspense","Switch","Route","component","isLocalhost","hostname","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","Sentry","dsn","integrations","Offline","tracesSampleRate","release","allowUrls","ignoreErrors","denyUrls","beforeBreadcrumb","breadcrumb","hint","_breadcrumb$category","category","startsWith","innerText","ReactDOM","origin","headers","contentType","ready","unregister","checkValidServiceWorker","serviceWorkerRegistration"],"mappings":"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","file":"static/js/main.76e8d464.chunk.js","sourcesContent":["import { ModalId, SuggestionsError } from '../data/types'\nimport { AliasTag, AnyBiasedTag, AnyTag, Comment, Post, PreferenceKey, TagModifier } from 'r34-types'\nimport { PreferencesState } from './reducers/preferences'\n\n// Action Names\nexport const ADD_ALIASES = `r34-react/ADD_ALIASES`\nexport const ADD_POSTS = `r34-react/ADD_POSTS`\nexport const ADD_TAG = `r34-react/ADD_TAG`\nexport const CLOSE_MODAL = `r34-react/CLOSE_MODAL`\nexport const ENTER_FULLSCREEN = `r34-react/ENTER_FULLSCREEN`\nexport const EXIT_FULLSCREEN = 'r34-react/EXIT_FULLSCREEN'\nexport const FETCH_COMMENTS = `r34-react/FETCH_COMMENTS`\nexport const FETCH_PREFERENCES = `r34-react/FETCH_PREFERENCES`\nexport const FETCH_SUGGESTIONS = `r34-react/FETCH_SUGGESTIONS`\nexport const GET_MORE_RESULTS = `r34-react/GET_MORE_RESULTS`\nexport const GET_RESULTS = `r34-react/GET_RESULTS`\nexport const LIKE_POST = `r34-react/LIKE_POST`\nexport const OPEN_MODAL = `r34-react/OPEN_MODAL`\nexport const REMOVE_TAG = `r34-react/REMOVE_TAG`\nexport const SAVE_PREFERENCES = 'r34-react/SAVE_PREFERENCES'\nexport const SET_COMMENTS = `r34-react/SET_COMMENTS`\nexport const SET_FULLSCREEN_POST = `r34-react/SET_FULLSCREEN_POST`\nexport const SET_POSTS = `r34-react/SET_POSTS`\nexport const SET_PREFERENCE = `r34-react/SET_PREFERENCE`\nexport const SET_PREFERENCES = `r34-react/SET_PREFERENCES`\nexport const SET_SUGGESTIONS = `r34-react/SET_SUGGESTIONS`\nexport const SET_SUGGESTIONS_ERROR = `r34-react/SET_SUGGESTIONS_ERROR`\nexport const SET_SUGGESTIONS_MODIFIER = 'r34-react/SET_SUGGESTIONS_MODIFIER'\nexport const SCROLL_TO_POST = 'r34-react/SCROLL_TO_POST'\n\n// Action Types\ninterface AddTagAction {\n  type: typeof ADD_TAG\n  tag: AnyBiasedTag\n}\n\ninterface RemoveTagAction {\n  type: typeof REMOVE_TAG\n  tagName: string\n}\n\ninterface AddAliasesAction {\n  type: typeof ADD_ALIASES\n  aliases: AliasTag[]\n  forTag: string\n}\n\nexport interface AddPostsAction {\n  type: typeof ADD_POSTS\n  posts: Post[]\n}\n\nexport interface SetPostsAction {\n  type: typeof SET_POSTS\n  posts: Post[]\n  count: number\n  pageNumber?: number\n}\n\ninterface SetCommentsAction {\n  type: typeof SET_COMMENTS\n  postId: number\n  comments: Comment[]\n}\n\ninterface FetchCommentsAction {\n  type: typeof FETCH_COMMENTS\n  postId: number\n}\n\ninterface SetPreferenceAction {\n  type: typeof SET_PREFERENCE\n  key: PreferenceKey\n  value: PreferencesState[PreferenceKey]\n}\n\ninterface SetPreferencesAction {\n  type: typeof SET_PREFERENCES\n  preferences: Partial<PreferencesState>\n}\n\ninterface GetResultsAction {\n  type: typeof GET_RESULTS\n  pageNumber: number\n}\n\ninterface GetMoreResultsAction {\n  type: typeof GET_MORE_RESULTS\n}\n\ninterface EnterFullcreenAction {\n  type: typeof ENTER_FULLSCREEN\n  postId: number\n}\n\ninterface SetFullScreenPostAction {\n  type: typeof SET_FULLSCREEN_POST\n  index: number\n}\n\ninterface ExitFullscreenAction {\n  type: typeof EXIT_FULLSCREEN\n}\n\ninterface LikePostAction {\n  type: typeof LIKE_POST\n  postId: number\n}\n\ninterface OpenModalAction {\n  type: typeof OPEN_MODAL\n  modalId: ModalId\n}\n\ninterface CloseModalAction {\n  type: typeof CLOSE_MODAL\n}\n\ninterface SetSuggestionsAction {\n  type: typeof SET_SUGGESTIONS\n  suggestions: AnyTag[]\n}\n\ninterface SetSuggestionsErrorAction {\n  type: typeof SET_SUGGESTIONS_ERROR\n  error: SuggestionsError\n}\n\ninterface FetchSuggestionsAction {\n  type: typeof FETCH_SUGGESTIONS\n  value: string\n  includeSupertags: boolean\n}\n\ninterface FetchPreferencesAction {\n  type: typeof FETCH_PREFERENCES\n}\n\ninterface SavePreferencesAction {\n  type: typeof SAVE_PREFERENCES\n}\n\ninterface SetSuggestionsModifierAction {\n  type: typeof SET_SUGGESTIONS_MODIFIER\n  modifier: TagModifier\n}\n\ninterface ScrollToPostAction {\n  type: typeof SCROLL_TO_POST\n  index: number\n}\n\nexport type AppAction =\n  | AddAliasesAction\n  | AddPostsAction\n  | AddTagAction\n  | CloseModalAction\n  | EnterFullcreenAction\n  | ExitFullscreenAction\n  | FetchCommentsAction\n  | FetchPreferencesAction\n  | FetchSuggestionsAction\n  | GetMoreResultsAction\n  | GetResultsAction\n  | LikePostAction\n  | OpenModalAction\n  | RemoveTagAction\n  | SavePreferencesAction\n  | SetCommentsAction\n  | SetFullScreenPostAction\n  | SetPostsAction\n  | SetPreferenceAction\n  | SetPreferencesAction\n  | SetSuggestionsAction\n  | SetSuggestionsErrorAction\n  | SetSuggestionsModifierAction\n  | ScrollToPostAction\n\n// Action Creators\nexport function addTag(tag: AnyBiasedTag): AddTagAction {\n  return {\n    type: ADD_TAG,\n    tag,\n  }\n}\n\nexport function removeTag(tagName: string): RemoveTagAction {\n  return {\n    type: REMOVE_TAG,\n    tagName,\n  }\n}\n\nexport function addAliases(aliases: AliasTag[], forTag: string): AddAliasesAction {\n  return {\n    type: ADD_ALIASES,\n    aliases,\n    forTag,\n  }\n}\n\nexport function addPosts(posts: Post[]): AddPostsAction {\n  return {\n    type: ADD_POSTS,\n    posts,\n  }\n}\n\nexport function setPosts(posts: Post[], count: number, pageNumber: number = 0): SetPostsAction {\n  return {\n    type: SET_POSTS,\n    posts,\n    count,\n    pageNumber,\n  }\n}\n\nexport function setComments(postId: number, comments: Comment[]): SetCommentsAction {\n  return {\n    type: SET_COMMENTS,\n    postId,\n    comments,\n  }\n}\n\nexport function fetchComments(postId: number): FetchCommentsAction {\n  return {\n    type: FETCH_COMMENTS,\n    postId,\n  }\n}\n\nexport function setPreference(key: PreferenceKey, value: any): SetPreferenceAction {\n  return {\n    type: SET_PREFERENCE,\n    key,\n    value,\n  }\n}\n\nexport function setPreferences(preferences: Partial<PreferencesState>): SetPreferencesAction {\n  return {\n    type: SET_PREFERENCES,\n    preferences,\n  }\n}\n\nexport function getResults(pageNumber: number = 0): GetResultsAction {\n  return {\n    type: GET_RESULTS,\n    pageNumber,\n  }\n}\n\nexport function getMoreResults(): GetMoreResultsAction {\n  return {\n    type: GET_MORE_RESULTS,\n  }\n}\n\nexport function enterFullscreen(postId: number): EnterFullcreenAction {\n  return {\n    type: ENTER_FULLSCREEN,\n    postId,\n  }\n}\n\nexport function exitFullscreen(): ExitFullscreenAction {\n  return {\n    type: EXIT_FULLSCREEN,\n  }\n}\n\nexport function setFullscreenPost(index: number): SetFullScreenPostAction {\n  return {\n    type: SET_FULLSCREEN_POST,\n    index,\n  }\n}\n\nexport function scrollToPost(index: number): ScrollToPostAction {\n  return {\n    type: SCROLL_TO_POST,\n    index,\n  }\n}\n\nexport function likePost(postId: number): LikePostAction {\n  return {\n    type: LIKE_POST,\n    postId,\n  }\n}\n\nexport function openModal(modalId: ModalId): OpenModalAction {\n  return {\n    type: OPEN_MODAL,\n    modalId,\n  }\n}\n\nexport function closeModal(): CloseModalAction {\n  return {\n    type: CLOSE_MODAL,\n  }\n}\n\nexport function setSuggestions(suggestions: AnyTag[]): SetSuggestionsAction {\n  return {\n    type: SET_SUGGESTIONS,\n    suggestions,\n  }\n}\n\nexport function setSuggestionsError(error: SuggestionsError): SetSuggestionsErrorAction {\n  return {\n    type: SET_SUGGESTIONS_ERROR,\n    error,\n  }\n}\n\nexport function fetchSuggestions(value: string, includeSupertags: boolean): FetchSuggestionsAction {\n  return {\n    type: FETCH_SUGGESTIONS,\n    value,\n    includeSupertags,\n  }\n}\n\nexport function fetchPreferences(): FetchPreferencesAction {\n  return {\n    type: FETCH_PREFERENCES,\n  }\n}\n\nexport function savePreferences(): SavePreferencesAction {\n  return {\n    type: SAVE_PREFERENCES,\n  }\n}\n\nexport function setSuggestionsModifier(modifier: TagModifier): SetSuggestionsModifierAction {\n  return {\n    type: SET_SUGGESTIONS_MODIFIER,\n    modifier,\n  }\n}\n","import * as r34 from 'r34-types'\nimport { createSelector, defaultMemoize } from 'reselect'\nimport { isSupertag } from '../data/tagUtils'\nimport { ModalId } from '../data/types'\nimport { AppState } from './appState'\n\n// Simple selectors\nexport const selectActiveTags = (state: AppState) => state.tags.active\nexport const selectActiveThemeId = (state: AppState) => state.preferences.themeId\nexport const selectAliases = (state: AppState) => state.tags.aliases\nexport const selectAutoPlay = (state: AppState) => state.preferences.autoPlay\nexport const selectCookies = (state: AppState) => state.preferences.cookies\nexport const selectCount = (state: AppState) => state.results.count\nexport const selectFullsceenIndex = (state: AppState) => state.fullscreen.currentIndex\nexport const selectFullsceenState = (state: AppState) => state.fullscreen.isEnabled\nexport const selectHideSeen = (state: AppState) => state.preferences.hideSeen\nexport const selectOpenModalId = (state: AppState) => state.modals.openModal\nexport const selectOriginals = (state: AppState) => state.preferences.originals\nexport const selectPageNumber = (state: AppState) => state.results.pageNumber\nexport const selectPageSize = (state: AppState) => state.preferences.pageSize\nexport const selectPosts = (state: AppState) => state.results.posts\nexport const selectPreferences = (state: AppState) => state.preferences\nexport const selectPreloadVideos = (state: AppState) => state.preferences.preloadVideos\nexport const selectPreloadGifs = (state: AppState) => state.preferences.preloadVideos\nexport const selectRated = (state: AppState) => state.preferences.rated\nexport const selectRatedThreshold = (state: AppState) => state.preferences.ratedThreshold\nexport const selectResults = (state: AppState) => state.results\nexport const selectResultsLayout = (state: AppState) => state.preferences.resultsLayout\nexport const selectShowComments = (state: AppState) => state.preferences.showComments\nexport const selectShowMetadata = (state: AppState) => state.preferences.showMetadata\nexport const selectSort = (state: AppState) => state.preferences.sort\nexport const selectSuggestions = (state: AppState) => state.suggestions.entries\nexport const selectSuggestionsError = (state: AppState) => state.suggestions.error\nexport const selectSuggestionsModifier = (state: AppState) => state.suggestions.modifier\nexport const selectTagSuggestionCount = (state: AppState) => state.preferences.tagSuggestionsCount\nexport const selectUpdated = (state: AppState) => state.results.updated\nexport const selectAutoscrollDelay = (state: AppState) => state.preferences.autoscrollDelay\nexport const selectScrollIndex = (state: AppState) => state.fullscreen.scrollIndex\nexport const selectShowPostDetails = (state: AppState) => state.preferences.showPostDetails\n\n// Memoized selectors\nexport const selectNumberOfActiveTags = createSelector(selectActiveTags, (tags) => Object.keys(tags).length)\nexport const selectAliasesAsList = createSelector(selectAliases, (aliases) => Object.values(aliases).flat())\nexport const selectHasResults = createSelector(selectPosts, (posts) => posts.length !== 0)\nexport const selectOutOfResults = createSelector(selectPosts, selectCount, (posts, count) => posts.length === count)\nexport const selectHasMoreResults = createSelector(selectOutOfResults, (outOfResults) => !outOfResults)\nexport const selectLastPage = createSelector(\n  selectCount,\n  selectPageSize,\n  (count, pageSize) => Math.ceil(count / pageSize) - 1\n)\nexport const selectFullScreenPost = createSelector(\n  selectPosts,\n  selectFullsceenIndex,\n  (posts, fullScreenIndex) => posts[fullScreenIndex]\n)\nexport const selectFullScreenIndex = createSelector(selectPosts, selectFullScreenPost, (posts, fullScreenPost) =>\n  fullScreenPost ? posts.indexOf(fullScreenPost) : -1\n)\nexport const selectMinRating = createSelector(selectRated, selectRatedThreshold, (rated, ratedThreshold) =>\n  rated ? ratedThreshold : 0\n)\nexport const selectNextIndex = createSelector(selectPosts, selectFullScreenIndex, (posts, selectedIndex) =>\n  selectedIndex + 1 < posts.length ? selectedIndex + 1 : undefined\n)\nexport const selectPreviousIndex = createSelector(selectFullScreenIndex, (selectedIndex) =>\n  selectedIndex > 0 ? selectedIndex - 1 : undefined\n)\nexport const selectSupertagModalOpen = createSelector(\n  selectOpenModalId,\n  (modalId) => modalId === ModalId.CREATE_SUPERTAG\n)\nexport const selectCellularWarningModalOpen = createSelector(\n  selectOpenModalId,\n  (modalId) => modalId === ModalId.CELLULAR_WARNING\n)\n\n// Parameterized selectors\nexport const selectPostById = defaultMemoize((id: number) => {\n  return createSelector(selectPosts, (posts) => {\n    return posts.find((post) => post.id === id) as r34.Post\n  })\n})\nexport const selectPostByIndex = defaultMemoize((index: number) => {\n  return createSelector(selectPosts, (posts) => {\n    return posts[index]\n  })\n})\n\nexport const selectAliasesByTagName = defaultMemoize((tagName: string) => {\n  return createSelector(selectAliases, (aliases) => {\n    return aliases[tagName]\n  })\n})\n\nexport const selectLikedByPostId = defaultMemoize((id: number) => (state: AppState) => id in state.likes)\n\nexport const selectActiveSupertagTags = createSelector(selectActiveTags, (activeTags) =>\n  Object.values(activeTags)\n    .filter(isSupertag)\n    .reduce((result, tag) => ({ ...result, ...tag.tags }), {})\n)\n","import * as r34 from 'r34-types'\nimport { SuggestionsError } from './types'\n\n//#region Tag serialization\n\n/**\n * Accepts a map of all tags and serializes them into a string that can be used as a Querystring parameter\n */\nexport function serializeAllTags(tags: Record<string, r34.QueryTag | r34.Supertag>) {\n  const resolvedTags = flattenSupertags(Object.values(tags))\n  const tagsByModifier = groupTagsByModifier(resolvedTags)\n  const normalTags = [...tagsByModifier['+'], ...tagsByModifier['-']].map(serializeTag).join(' + ')\n  const optionalTags =\n    tagsByModifier['~'].length > 0 ? ` + ( ${tagsByModifier['~'].map(serializeTag).join(' ~ ')} )` : ''\n\n  return `${normalTags}${optionalTags}`\n}\n\n/**\n * Accepts a list that holds normal tags and supertags and unpacks all supertags.\n * The result contains all normal tags given plus all contents of the supertags given.\n */\nexport function flattenSupertags(tags: Array<r34.QueryTag | r34.Supertag>) {\n  let resolvedTags: r34.QueryTag[] = []\n\n  tags.forEach((tag) => {\n    if (isSupertag(tag)) {\n      Object.entries(tag.tags).forEach(([name, modifier]) => {\n        resolvedTags.push({ name, modifier })\n      })\n    } else {\n      resolvedTags.push(tag)\n    }\n  })\n\n  return resolvedTags\n}\n\n/**\n * Given a list of tags this function returns a record with an entry for each modifier countaining all tags of the original list that match that modifier.\n */\nexport function groupTagsByModifier(tags: r34.QueryTag[]) {\n  return tags.reduce(\n    (result, current) => {\n      if (!(current.modifier in result)) result[current.modifier] = []\n\n      result[current.modifier]?.push(current)\n\n      return result\n    },\n    { '+': [], '-': [], '~': [] } as Record<r34.TagModifier, r34.QueryTag[]>\n  )\n}\n\n/**\n * Serializes a tag for use in urls\n */\nexport function serializeTag(tag: r34.QueryTag) {\n  return `${tag.modifier === '-' ? '-' : ''}${serializeTagname(tag.name)}`\n}\n\n/**\n * Serializes tag names for use in api requests.\n */\nexport function serializeTagname(tagname: string) {\n  return encodeURIComponent(tagname.toLowerCase().replace(/ /g, '_'))\n}\n\n//#endregion\n\n//#region Query parameter construction\n\n/**\n * Constructs the tag parameter for getting posts from the api\n */\nexport function getTagParameter(\n  tags: Record<string, r34.QueryTag | r34.Supertag>,\n  minScore: number,\n  sort: r34.PostsSort\n) {\n  const tagParts = []\n\n  if (Object.keys(tags).length > 0) {\n    tagParts.push(serializeAllTags(tags))\n  }\n\n  if (minScore > 0) {\n    tagParts.push(encodeURIComponent(`score:>=${minScore}`))\n  }\n\n  if (sort) {\n    tagParts.push(encodeURIComponent(`sort:${sort}`))\n  }\n\n  return tagParts.join(' + ')\n}\n\n//#endregion\n\n//#region Typing\n\nexport function bias(tag: r34.Tag, modifier: r34.TagModifier): r34.BiasedTag {\n  return { ...tag, modifier }\n}\n\nexport function isBiased(tag: r34.Tag | r34.BiasedTag): tag is r34.BiasedTag {\n  return (tag as r34.BiasedTag).modifier !== undefined\n}\n\nexport function isSupertag(tag: unknown): tag is r34.Supertag {\n  return (tag as r34.Supertag).tags !== undefined\n}\n\nexport function getInterestingType(types: r34.TagType[]) {\n  return types.find((t) => !t.match(/^[general|ambiguous]$/))\n}\n\nexport function isSuggestionError(value: unknown): value is SuggestionsError {\n  return (value as SuggestionsError).message !== undefined\n}\n\n//#endregion\n\n//#region Compression\n\nfunction removeLeadingHastag(value: string) {\n  if (value[0] === '#') return value.substr(1)\n  else return value\n}\n\nexport function encodeSupertag(supertag: r34.Supertag) {\n  const payload = `${encodeURI(supertag.name)}/${encodeURI(supertag.description)}/${encodeURI(\n    Object.entries(supertag.tags)\n      .map(([t, m]) => `${t},${m}`)\n      .join(';')\n  )}`\n\n  return Buffer.from(payload).toString('base64')\n}\n\nexport function decodeSupertag(base64: string) {\n  const payload = Buffer.from(removeLeadingHastag(base64), 'base64').toString()\n\n  const parts = payload.split('/').map(decodeURI)\n\n  const supertag: r34.Supertag = {\n    name: parts[0],\n    description: parts[1],\n    tags: Object.fromEntries(parts[2].split(';').map((e) => e.split(','))),\n  }\n\n  return supertag\n}\n\n//#endregion\n","import { css } from 'styled-components'\nimport { flexRowGap, flexColumnGap, gap, defaultRowSpacing } from './gap'\nimport { transitionAll } from './theming'\nimport { PropsWithTheme } from './types'\n\nexport function multilineList({ theme }: PropsWithTheme) {\n  return css`\n    display: flex;\n    flex-wrap: wrap;\n    ${flexRowGap(theme.dimensions.bigSpacing)}\n    ${flexColumnGap(theme.dimensions.bigSpacing)}\n  `\n}\n\nexport function flexColumn() {\n  return css`\n    display: flex;\n    flex-direction: column;\n  `\n}\n\nexport function flexColumnWithGap({ theme }: PropsWithTheme) {\n  return css`\n    display: flex;\n    flex-direction: column;\n    ${flexColumnGap(theme.dimensions.bigSpacing)};\n  `\n}\n\nexport function gridWithGap({ theme }: PropsWithTheme) {\n  return css`\n    display: grid;\n    ${gap(theme.dimensions.bigSpacing)}\n  `\n}\n\nexport function flexRowWithGap({ theme }: PropsWithTheme) {\n  return css`\n    display: flex;\n    align-items: center;\n    ${flexRowGap(theme.dimensions.bigSpacing)};\n  `\n}\n\n/**\n * Limits content to a maximum width and centers it\n */\nexport function centeredMaxWidth({ theme }: PropsWithTheme) {\n  return css`\n    width: 100%;\n    max-width: ${theme.dimensions.bodyWidth};\n    margin-left: auto;\n    margin-right: auto;\n  `\n}\n\n/**\n * Fixed height and padding\n */\nexport function defaultBlock({ theme }: PropsWithTheme) {\n  return css`\n    height: ${theme.dimensions.blockHeight};\n    padding: 0 ${theme.dimensions.bigSpacing};\n  `\n}\n\nexport function fullscreenOverlay() {\n  return css`\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    ${coverScreen};\n  `\n}\n\nexport function coverScreen() {\n  return css`\n    width: 100vw;\n    height: 100vh;\n  `\n}\n\nexport function buttonBaseStyle({ theme }: PropsWithTheme) {\n  return css`\n    display: inline-flex;\n    align-items: center;\n    place-content: center;\n\n    height: ${theme.dimensions.blockHeight};\n    cursor: pointer;\n    white-space: nowrap;\n    border-radius: ${theme.dimensions.borderRadius};\n    font-size: ${theme.fontSizes.content};\n    ${defaultRowSpacing}\n    ${transitionAll}\n  `\n}\n","import { IconProp } from '@fortawesome/fontawesome-svg-core'\nimport {\n  faDeviantart,\n  faDiscord,\n  faGithub,\n  faGoogle,\n  faPatreon,\n  faTumblr,\n  faTwitter,\n} from '@fortawesome/free-brands-svg-icons'\nimport {\n  faArrowRight,\n  faArrowUp,\n  faBackward,\n  faCalendarDay,\n  faCaretDown,\n  faCheckCircle,\n  faCheckSquare,\n  faCodeBranch,\n  faCog,\n  faCopy,\n  faCopyright,\n  faDownload,\n  faExpand,\n  faExternalLinkAlt,\n  faForward,\n  faHashtag,\n  faHeart,\n  faImage,\n  faInfoCircle,\n  faLink,\n  faPen,\n  faPlus,\n  faRegistered,\n  faScroll,\n  faSearch,\n  faShareAlt,\n  faSignOutAlt,\n  faTags,\n  faTimes,\n  faTimesCircle,\n  faUndoAlt,\n  faUser,\n  faUserShield,\n  faWrench,\n} from '@fortawesome/free-solid-svg-icons'\nimport { FontAwesomeIcon, FontAwesomeIconProps } from '@fortawesome/react-fontawesome'\nimport React from 'react'\n\n/**\n * Component factory that shortens the definition of a new icon considerably\n */\nconst bindIcon = (icon: IconProp) =>\n  React.memo((props: Omit<FontAwesomeIconProps, 'icon'>) => (\n    <FontAwesomeIcon data-testid='icon' icon={icon} {...props} />\n  ))\n\nexport const ArrowDown = bindIcon(faCaretDown)\nexport const ArtistIcon = bindIcon(faPen)\nexport const CalendarIcon = bindIcon(faCalendarDay)\nexport const CharacterIcon = bindIcon(faUser)\nexport const CheckIcon = bindIcon(faCheckSquare)\nexport const CloseIcon = bindIcon(faTimes)\nexport const CodeBranchIcon = bindIcon(faCodeBranch)\nexport const CopyIcon = bindIcon(faCopy)\nexport const CopyrightIcon = bindIcon(faCopyright)\nexport const DeviantArtIcon = bindIcon(faDeviantart)\nexport const DiscordIcon = bindIcon(faDiscord)\nexport const DownloadIcon = bindIcon(faDownload)\nexport const ExpandIcon = bindIcon(faExpand)\nexport const ExternalLinkIcon = bindIcon(faExternalLinkAlt)\nexport const FailedIcon = bindIcon(faTimesCircle)\nexport const GithubIcon = bindIcon(faGithub)\nexport const GoogleIcon = bindIcon(faGoogle)\nexport const HeartIcon = bindIcon(faHeart)\nexport const ImageIcon = bindIcon(faImage)\nexport const LinkIcon = bindIcon(faLink)\nexport const MetaDataIcon = bindIcon(faInfoCircle)\nexport const PatreonIcon = bindIcon(faPatreon)\nexport const PlusIcon = bindIcon(faPlus)\nexport const PrivacyIcon = bindIcon(faUserShield)\nexport const RatingIcon = bindIcon(faRegistered)\nexport const SearchIcon = bindIcon(faSearch)\nexport const PreferencesIcon = bindIcon(faCog)\nexport const ShareIcon = bindIcon(faShareAlt)\nexport const SignOutIcon = bindIcon(faSignOutAlt)\nexport const SourceIcon = bindIcon(faHashtag)\nexport const SuccessIcon = bindIcon(faCheckCircle)\nexport const SupertagIcon = bindIcon(faTags)\nexport const TermsIcon = bindIcon(faScroll)\nexport const TumblrIcon = bindIcon(faTumblr)\nexport const TwitterIcon = bindIcon(faTwitter)\nexport const UndoIcon = bindIcon(faUndoAlt)\nexport const WrenchIcon = bindIcon(faWrench)\nexport const ForwardIcon = bindIcon(faForward)\nexport const BackwardIcon = bindIcon(faBackward)\nexport const SubmitIcon = bindIcon(faArrowRight)\nexport const ArrowUp = bindIcon(faArrowUp)\n","import styled, { css } from 'styled-components'\nimport { buttonBaseStyle } from '../../styled/mixins/layout'\nimport { dropShadow } from '../../styled/mixins/shadow'\nimport { defaultBorder, primary, transitionAll } from '../../styled/mixins/theming'\n\nconst TextButton = styled.button`\n  ${buttonBaseStyle}\n`\n\nexport const LinkButton = styled.a(\n  ({ theme }) => css`\n    ${buttonBaseStyle}\n\n    gap: ${theme.dimensions.bigSpacing};\n    padding: 0 ${theme.dimensions.hugeSpacing};\n    background-color: ${theme.colors.layerBg};\n    border-radius: ${theme.dimensions.borderRadius};\n    color: ${theme.colors.text};\n\n    :visited {\n      color: ${theme.colors.text} !important;\n      text-decoration: none !important;\n    }\n\n    :hover {\n      opacity: 0.8;\n      text-decoration: none !important;\n    }\n\n    :active {\n      opacity: 0.6;\n      text-decoration: none !important;\n    }\n  `\n)\n\nexport const InvisButton = styled.button(\n  ({ theme }) => css`\n    background-color: transparent;\n    border: none;\n    padding: ${theme.dimensions.bigSpacing};\n    color: ${theme.colors.text};\n    cursor: pointer;\n    font-size: ${theme.fontSizes.content};\n\n    ${dropShadow}\n\n    svg {\n      ${transitionAll}\n    }\n  `\n)\n\nexport const PrimaryButton = styled(TextButton)(\n  ({ theme }) => css`\n    ${primary}\n\n    gap: ${theme.dimensions.bigSpacing};\n    padding: 0 ${theme.dimensions.hugeSpacing};\n  `\n)\n\nexport const BlockButton = styled(PrimaryButton)`\n  width: 100%;\n`\n\nexport const AddButton = styled(PrimaryButton)(\n  ({ theme }) => css`\n    border-radius: 0 ${theme.dimensions.borderRadius} ${theme.dimensions.borderRadius} 0;\n    min-width: ${theme.dimensions.blockHeight};\n  `\n)\n\nexport const ModifierButton = styled(TextButton)(\n  ({ theme }) => css`\n    background-color: transparent;\n    min-width: 48px;\n    font-size: 24px;\n\n    :focus {\n      text-decoration: none;\n    }\n\n    ${defaultBorder}\n    border-right-width: 0;\n    border-radius: ${theme.dimensions.borderRadius} 0 0 ${theme.dimensions.borderRadius};\n  `\n)\n","import { css } from 'styled-components'\nimport { defaultBlock } from './layout'\nimport { PropsWithTheme, SupportsDisable } from './types'\n\n/**\n * Adds a short transition to every attribute\n */\nexport function transitionAll({ theme }: PropsWithTheme) {\n  return css`\n    transition: all ${theme.timings.transitionTime} linear;\n  `\n}\n\n/**\n * Sets border-radius to the default\n */\nexport function borderRadius({ theme }: PropsWithTheme) {\n  return css`\n    border-radius: ${theme.dimensions.borderRadius};\n  `\n}\n\n/**\n * Gives elements a border\n */\nexport function defaultBorder({ theme }: PropsWithTheme) {\n  return css`\n    border-color: ${theme.colors.accentColor};\n    border-width: ${theme.dimensions.borderWidth};\n    border-style: solid;\n    ${borderRadius}\n  `\n}\n\n/**\n * Accent colored element with hover/focus/active/disabled states\n */\nexport function primary({ theme, disabled }: PropsWithTheme & Partial<SupportsDisable>) {\n  return css`\n    color: ${theme.colors.backgroundColor};\n    background-color: ${disabled ? theme.colors.subduedText : theme.colors.accentColor};\n    border: none;\n\n    ${transitionAll}\n    ${pointerInteraction}\n  `\n}\n\n/**\n * Transparent with text and border in accentcolor\n */\nexport function secondary({ theme, disabled }: PropsWithTheme & Partial<SupportsDisable>) {\n  const foreground = disabled ? theme.colors.subduedText : theme.colors.accentColor\n\n  return css`\n    color: ${foreground};\n    background-color: transparent;\n\n    ${transitionAll}\n    ${defaultBorder}\n    ${pointerInteraction}\n  `\n}\n\nexport function focus({ theme }: PropsWithTheme) {\n  return css`\n    :focus {\n      color: ${theme.colors.backgroundColor2};\n      border-color: ${theme.colors.backgroundColor2};\n    }\n  `\n}\n\nexport function pointerInteraction({ disabled }: PropsWithTheme & Partial<SupportsDisable>) {\n  return disabled\n    ? ''\n    : css`\n        :hover {\n          filter: brightness(120%);\n        }\n\n        :focus {\n          ${focus}\n        }\n\n        :active {\n          filter: brightness(90%);\n        }\n      `\n}\n\n/**\n * Element will look like a new layer\n */\nexport function layer({ theme }: PropsWithTheme) {\n  return css`\n    background-color: ${theme.colors.layerBg};\n    ${borderRadius}\n  `\n}\n\n/**\n * Element will look like a new layer\n */\nexport function solidLayer({ theme }: PropsWithTheme) {\n  return css`\n    background-color: ${theme.colors.layerBgSolid};\n    ${borderRadius}\n  `\n}\n\n/**\n * Height and coloring for most inputs\n */\nexport function defaultInput({ theme }: PropsWithTheme) {\n  return css`\n    ${defaultBorder}\n    ${defaultBlock}\n   \n    background-color: ${theme.colors.backgroundColor2};\n    cursor: pointer;\n  `\n}\n","/**\n * Tabs displayed in Post details\n */\nexport type ActiveTab = 'tags' | 'comments' | 'metadata'\n\n/**\n * All routes of the app.\n */\nexport enum RouteName {\n  SEARCH = '/',\n  PREFERENCES = '/preferences',\n  ABOUT = '/about',\n  PRIVACY = '/privacy',\n  TERMS = '/terms',\n  STORIES = '/stories',\n  SHARE = '/share',\n}\n\n/**\n * All modals the app can display.\n */\nexport enum ModalId {\n  CREATE_SUPERTAG,\n  CELLULAR_WARNING,\n}\n\nexport type EmptyCallback = () => void\n\n/**\n * One-time definition of an empty function. Reusing this improves React's performance as it does not break memoization.\n */\nexport const NO_OP = () => {}\n\n/**\n * Error sent from the backend when too many tag results were found\n */\nexport type SuggestionsError = { message: string; results: number }\n\n/**\n * direct: Tag is part of active tags\n * indirect: Tag is part of a supertag that is in active tags\n * no: Tag is not part of supertags at all\n */\nexport type TagIsActive = 'direct' | 'indirect' | 'no'\n\n/**\n * Unit for display in the TagSelector dropdown\n */\nexport type CountUnit = 'tags' | 'posts'\n","import { css } from 'styled-components'\nimport { supportsFlexGap, supportsGap } from '../../data/browserUtils'\nimport { PropsWithTheme } from './types'\n\nexport function gap(amount: string) {\n  return supportsGap\n    ? css`\n        gap: ${amount};\n      `\n    : css`\n        > :not(:last-child) {\n          margin-right: ${amount};\n          margin-bottom: ${amount};\n        }\n      `\n}\n\nexport function flexRowGap(amount: string) {\n  return supportsFlexGap\n    ? css`\n        gap: ${amount};\n      `\n    : css`\n        > :not(:last-child) {\n          margin-right: ${amount};\n        }\n      `\n}\n\nexport function flexColumnGap(amount: string) {\n  return supportsFlexGap\n    ? css`\n        gap: ${amount};\n      `\n    : css`\n        > :not(:last-child) {\n          margin-bottom: ${amount};\n        }\n      `\n}\n\n/**\n * `gap` and `padding` set to `bigSpacing`\n */\nexport function defaultSpacing({ theme }: PropsWithTheme) {\n  return css`\n    ${gap(theme.dimensions.bigSpacing)};\n    padding: ${theme.dimensions.bigSpacing};\n  `\n}\n\n/**\n * `gap` and `padding` set to `bigSpacing`. `padding` only horizontally.\n * Use `align-items: center` or similar to handle veritcal padding\n */\nexport function defaultRowSpacing({ theme }: PropsWithTheme) {\n  return css`\n    ${gap(theme.dimensions.bigSpacing)};\n    padding: 0 ${theme.dimensions.bigSpacing};\n  `\n}\n","export enum ZIndex {\n  POST = 1,\n  OVERLAY = 2,\n  COOKIEBAR = 100,\n  DROPDOWN = 3,\n  MODAL = 1000,\n}\n","export const supportsFlexGap = (() => {\n  // create flex container with row-gap set\n  var flex = document.createElement('div')\n  flex.style.display = 'flex'\n  flex.style.flexDirection = 'column'\n  flex.style.rowGap = '1px'\n\n  // create two, elements inside it\n  flex.appendChild(document.createElement('div'))\n  flex.appendChild(document.createElement('div'))\n\n  // append to the DOM (needed to obtain scrollHeight)\n  document.body.appendChild(flex)\n  var isSupported = flex.scrollHeight === 1 // flex container should be 1px high from the row-gap\n  //@ts-expect-error\n  flex.parentNode.removeChild(flex)\n\n  return isSupported\n})()\n\nexport const supportsGap = 'gap' in document.body.style\nexport const supportsAspectRatio = 'aspect-ratio' in document.body.style\nexport const supportsObjectFit = 'object-fit' in document.body.style\nexport const supportsFullscreen = document.fullscreenEnabled\nexport const supportsNetworkInformationAPI =\n  'connection' in navigator || 'mozConnection' in navigator || 'webkitConnection' in navigator\nexport const supportsLocalStorage = Boolean(localStorage)\n\nexport async function openFullscreen(element: Element) {\n  if (document.fullscreenEnabled && document.fullscreenElement === null) {\n    try {\n      const result = element.requestFullscreen()\n\n      if ('then' in result) {\n        return await result\n      }\n\n      return Promise.resolve(result)\n    } catch (err) {\n      // this causes a warning in console. So nothing to do for me here.\n    }\n  }\n\n  return null\n}\n\nexport async function closeFullscreen() {\n  if (document.fullscreenEnabled && document.fullscreenElement !== null) {\n    try {\n      const result = document.exitFullscreen()\n\n      if ('then' in result) {\n        return await result\n      }\n\n      return Promise.resolve(result)\n    } catch (err) {\n      // this causes a warning in console. So nothing to do for me here.\n    }\n  }\n\n  return null\n}\n","/**\n * Converts a list of objects into a map.\n * @param list The original list\n * @param keyProp The keyProp parameter defines which property of the objects will be used as the index for the map\n */\nexport const listToMap = <T>(list: T[], keyProp: string): Record<string, T> => {\n  return list.reduce((result: Record<string, T>, current: any) => {\n    result[current[keyProp]] = current\n    return result\n  }, {})\n}\n\n/**\n * Returns a URL object when the value is a hyperlink. Else undefined\n */\nexport function parseUrl(value: string) {\n  try {\n    return new URL(value)\n  } catch (err) {\n    // This is expected. If this method cannot parse the url it will return undefined.\n    return undefined\n  }\n}\n\n/**\n * converts a version like \"1.2.7\" into 127\n */\nexport function versionToNumber(majorMinorPatch: string) {\n  return Number(majorMinorPatch.split('.').join(''))\n}\n\n/**\n * Hacky ass way to download images cross origin. Could solve this by hosting both the app and the api on the same domain.\n */\nexport function download(url: string) {\n  const filename = url.split('/').pop() || ''\n\n  fetch(`https://r34-json.herokuapp.com/images?url=${url}`)\n    .then((response) => response.blob())\n    .then((blob) => {\n      var a = document.createElement('a')\n      a.download = filename\n      a.href = window.URL.createObjectURL(blob)\n      document.body.appendChild(a)\n      a.click()\n      a.remove()\n    })\n    .catch((e) => console.error('Download error:', e))\n}\n\n/**\n * Returns the current version of the project\n */\nexport function getVersion() {\n  // Some browsers fail to get environment variables. In that case return unknown.\n  if (process?.env?.REACT_APP_VERSION) {\n    return process.env.REACT_APP_VERSION\n  }\n\n  return 'unknown'\n}\n\n/**\n * Render ready version.\n */\nexport function getVersionString() {\n  const version = getVersion()\n\n  return version === 'unknown' ? 'Latest Release' : `Version ${version}`\n}\n\n/**\n * Returns the correct source based on preferences\n */\nexport function getCorrectSource(loadOriginal: boolean, big_src: string, small_src: string) {\n  const source = loadOriginal ? big_src : small_src\n  return source\n}\n\nexport function boolToNumber(value: boolean) {\n  return value ? 1 : 0\n}\n\nexport const randomBelow = (max: number) => Math.floor(Math.random() * max)\n","import { useCallback } from 'react'\nimport { useDispatch } from 'react-redux'\nimport { AnyAction } from 'redux'\n\n/**\n * A hook that simplifies usage of simple (unparameterized) Redux actions\n */\nexport default function useAction<T extends () => AnyAction>(actionCreator: T) {\n  const dispatch = useDispatch()\n\n  return useCallback(() => dispatch(actionCreator()), [actionCreator, dispatch])\n}\n","import { useCallback } from 'react'\nimport { PreferenceKey } from 'r34-types'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { setPreference } from '../redux/actions'\nimport { PreferencesState } from '../redux/reducers/preferences'\nimport { selectPreferences } from '../redux/selectors'\n\n/**\n * useState for preferences using redux instead of local state.\n */\nexport default function usePreference<T extends PreferenceKey>(\n  key: T\n): [PreferencesState[T], (value: PreferencesState[T]) => void] {\n  const dispatch = useDispatch()\n  const preferences = useSelector(selectPreferences)\n  const setValue = useCallback((value: any) => dispatch(setPreference(key, value)), [dispatch, key])\n\n  return [preferences[key], setValue]\n}\n","import styled, { css } from 'styled-components'\nimport { flexRowWithGap } from '../../styled/mixins/layout'\n\nexport const Title = styled.h2(\n  ({ theme }) => css`\n    font-size: ${theme.fontSizes.bigTitle};\n    font-weight: lighter;\n    text-align: center;\n  `\n)\n\nexport const BigTitle = styled.h1(\n  ({ theme }) => css`\n    ${flexRowWithGap({ theme })}\n\n    justify-content: center;\n    font-size: ${theme.fontSizes.bigTitle};\n    font-weight: lighter;\n    text-align: center;\n  `\n)\n\nexport const SmallTitle = styled.h3(\n  ({ theme }) => css`\n    font-size: ${theme.fontSizes.content};\n  `\n)\n\nexport const Faded = styled.span(\n  ({ theme }) => css`\n    color: ${theme.colors.subduedText};\n  `\n)\n","import { parseUrl } from '../data/utils'\n\n/**\n * Transforms a number into a shortened version for rendering.\n * Useful as it takes up less space.\n */\nexport const formatCount = (value: number) => {\n  if (value / 1e6 >= 1) {\n    return `${Math.trunc(value / 1e6)}M`\n  }\n\n  if (value >= 1e3) {\n    return `${Math.trunc(value / 1e3)}K`\n  }\n\n  return value.toString()\n}\n\n/**\n * Formats source strings for rendering\n */\nexport const formatSource = (source: string) => {\n  const url = parseUrl(source)\n  return url ? url.host : source\n}\n\n/**\n * Seconds to mm:ss formatter\n */\nexport function formatDuration(duration: number) {\n  const min = Math.trunc(duration / 60)\n  const sec = Math.trunc(duration % 60)\n\n  return min + ':' + (sec < 10 ? '0' : '') + sec\n}\n\n/**\n * Formats tag names for rendering.\n */\nexport function formatTagname(tagname: string) {\n  return tagname\n    .replace(/_/g, ' ')\n    .replace(/source:/g, '')\n    .replace(/rating:/g, '')\n}\n\n/**\n * Formats tags with their count if possible\n */\nexport function formatTagnameAndCount(name: string, count?: number) {\n  return count ? `${formatTagname(name)} (${formatCount(count)})` : formatTagname(name)\n}\n\nconst z = (value: number) => (value < 10 ? `0${value}` : value.toString())\n\n/**\n * Returns a string containing date and time of agiven Date object\n */\nexport function formatDatetime(date: Date) {\n  const dd = z(date.getDate())\n  const MM = z(date.getMonth() + 1) // zero indexed\n  const yyyy = date.getFullYear()\n  const hh = z(date.getHours())\n  const mm = z(date.getMinutes())\n\n  return `${dd}/${MM}/${yyyy} ${hh}:${mm}`\n}\n\n/**\n * Returns a human friendly approximation of a given time\n */\nexport function formatTime(milliseconds: number) {\n  if (milliseconds >= 315576e5) {\n    return formatUnit(milliseconds, 315576e5, 'year')\n  }\n\n  if (milliseconds >= 26297568e2) {\n    return formatUnit(milliseconds, 26297568e2, 'month')\n  }\n\n  if (milliseconds >= 6048e5) {\n    return formatUnit(milliseconds, 6048e5, 'week')\n  }\n\n  if (milliseconds >= 854e5) {\n    return formatUnit(milliseconds, 854e5, 'day')\n  }\n\n  if (milliseconds >= 36e5) {\n    return formatUnit(milliseconds, 36e5, 'hour')\n  }\n\n  if (milliseconds >= 6e4) {\n    return formatUnit(milliseconds, 6e4, 'minute')\n  }\n\n  if (milliseconds >= 1e3) {\n    return formatUnit(milliseconds, 1e3, 'second')\n  }\n\n  return `${milliseconds} ms`\n}\n\nexport function formatUnit(value: number, unitSize: number, unit: string) {\n  const result = (value / unitSize).toFixed(0)\n\n  const unitString = result === '1' ? unit : `${unit}s`\n\n  return `${result} ${unitString}`\n}\n","import styled from 'styled-components'\nimport { defaultSpacing } from '../../styled/mixins/gap'\nimport { layer, solidLayer } from '../../styled/mixins/theming'\n\n/**\n * Includes spacing and background color\n */\nexport const Surface = styled.div`\n  display: grid;\n  ${defaultSpacing}\n  ${layer}\n  width: 100%;\n`\n\n/**\n * Includes spacing and background color\n */\nexport const SolidSurface = styled.div`\n  ${defaultSpacing}\n  ${solidLayer}\n  width: 100%;\n`\n","import styled from 'styled-components'\nimport { flexMedia, preserveAspectRatio } from '../../styled/mixins/media'\n\nconst FlexImage = styled.img`\n  ${flexMedia}\n  ${preserveAspectRatio}\n`\n\nexport default FlexImage\n","import { TagType } from 'r34-types'\nimport React from 'react'\nimport {\n  CharacterIcon,\n  CopyrightIcon,\n  ArtistIcon,\n  RatingIcon,\n  SourceIcon,\n  MetaDataIcon,\n  SupertagIcon,\n} from './FontAwesomeIcons'\n\ninterface TypeIconProps {\n  type?: TagType\n  className?: string\n}\n\nexport default function TypeIcon(props: TypeIconProps) {\n  const { type, className = '' } = props\n\n  switch (type) {\n    case 'character':\n      return <CharacterIcon className={className} />\n    case 'copyright':\n      return <CopyrightIcon className={className} />\n    case 'artist':\n      return <ArtistIcon className={className} />\n    case 'rating':\n      return <RatingIcon className={className} />\n    case 'source':\n      return <SourceIcon className={className} />\n    case 'metadata':\n      return <MetaDataIcon className={className} />\n    case 'supertag':\n      return <SupertagIcon className={className} />\n    default:\n      return null\n  }\n}\n","import { css } from 'styled-components'\nimport { PropsWithTheme } from './types'\n\nexport function dropdownScrollbar({ theme }: PropsWithTheme) {\n  return css`\n    overflow-x: hidden;\n    overflow-y: auto;\n\n    ::-webkit-scrollbar {\n      width: 8px;\n\n      :hover {\n        background: ${theme.colors.layerBg};\n      }\n    }\n\n    /* Track */\n    ::-webkit-scrollbar-track {\n      background: ${theme.colors.backgroundColor2};\n      border-left: 1px lightgray solid;\n    }\n\n    /* Handle */\n    :hover {\n      ::-webkit-scrollbar {\n        background: ${theme.colors.backgroundColor}20;\n      }\n    }\n\n    ::-webkit-scrollbar-thumb {\n      background: ${theme.colors.backgroundColor}40;\n      border-radius: 100px;\n\n      :hover {\n        background: ${theme.colors.backgroundColor}30;\n      }\n    }\n  `\n}\n","import React, { MouseEventHandler } from 'react'\nimport styled, { css, DefaultTheme } from 'styled-components'\nimport { supportsAspectRatio } from '../../data/browserUtils'\nimport { defaultBorder } from '../../styled/mixins/theming'\n\nconst Track = styled.div(\n  (props) => css`\n    height: 24px;\n    width: 50px;\n    ${defaultBorder(props)}\n    border-radius: 30px;\n    background-color: transparent;\n    transition: transform ${props.theme.timings.longTransitionTime} ease-in-out;\n    cursor: pointer;\n  `\n)\n\n/**\n * CSS helper that falls back to less fancy styling on older browsers\n */\nfunction circle() {\n  return supportsAspectRatio\n    ? css`\n        height: 100%;\n        aspect-ratio: 1/1;\n      `\n    : css`\n        height: 100%;\n        width: 22px;\n      `\n}\n\nconst Thumb = styled.div(\n  (props: { value: boolean; theme: DefaultTheme }) => css`\n    ${circle()}\n    background-color: ${props.value ? props.theme.colors.accentColor : props.theme.colors.toggleOff};\n    border-radius: 100px;\n    transition: all 0.2s ease-in-out;\n    transform: translate(${props.value ? '26px' : '0px'});\n  `\n)\n\ninterface ToggleProps {\n  value: boolean\n  onToggle: MouseEventHandler\n}\n\nexport default function Toggle(props: ToggleProps) {\n  const { value, onToggle } = props\n\n  return (\n    <Track onClick={onToggle} role='checkbox' aria-checked={value}>\n      <Thumb value={value} />\n    </Track>\n  )\n}\n","import React, { MouseEventHandler } from 'react'\nimport FlexPair from './FlexPair'\nimport Toggle from './Toggle'\n\ninterface LabeledToggleProps {\n  children: React.ReactNode\n  value: boolean\n  onToggle: MouseEventHandler\n  className?: string\n}\n\nexport default function LabeledToggle(props: LabeledToggleProps) {\n  const { children, value, onToggle, className } = props\n\n  return (\n    <FlexPair className={className}>\n      <Toggle value={value} onToggle={onToggle} />\n      <span>{children}</span>\n    </FlexPair>\n  )\n}\n","import { Size } from 'react-virtualized'\nimport { css } from 'styled-components'\nimport { supportsAspectRatio } from '../../data/browserUtils'\nimport { borderRadius } from './theming'\n\n/**\n * Determines how media elements are displayed\n */\nexport function mediaStyle() {\n  return css`\n    ${borderRadius}\n  `\n}\n\n/**\n * Preserves aspect ratio of the element and ensures it is displayed as big as possible\n */\nexport function flexMedia() {\n  return css`\n    width: 100%;\n    height: 100%;\n    display: block;\n    object-fit: contain;\n  `\n}\n\n/**\n * Attempts to preserve aspect ration of an element.\n */\nexport function preserveAspectRatio({ width, height }: Partial<Size>) {\n  if (!width || !height) {\n    return ''\n  }\n\n  return supportsAspectRatio\n    ? css`\n        aspect-ratio: ${width} / ${height};\n      `\n    : css`\n        max-width: 100%;\n        height: auto;\n      `\n}\n","import {\n  TagType,\n  Tag,\n  TagModifier,\n  BiasedTag,\n  Supertag,\n  TagsError,\n  QueryTag,\n} from \"r34-types\"\n\nconst removeLeadingHastag = (value: string) =>\n  value[0] === \"#\" ? value.substr(1) : value\nconst isInteresting = (tagType: TagType) =>\n  ![\"general\", \"ambiguous\"].includes(tagType)\nexport const getInterestingType = (types: TagType[]) =>\n  types.find(isInteresting)\n\n//#region Typing\nexport const bias = (tag: Tag, modifier: TagModifier): BiasedTag => ({\n  ...tag,\n  modifier,\n})\nexport const isBiased = (tag: Tag | BiasedTag): tag is BiasedTag =>\n  (tag as BiasedTag).modifier !== undefined\nexport const isSupertag = (tag: unknown): tag is Supertag =>\n  (tag as Supertag).tags !== undefined\nexport const isSuggestionError = (value: unknown): value is TagsError =>\n  (value as TagsError).message !== undefined\n//#endregion\n\n//#region Compression\nexport function encodeSupertag(supertag: Supertag) {\n  const payload = `${encodeURI(supertag.name)}/${encodeURI(\n    supertag.description\n  )}/${encodeURI(\n    Object.entries(supertag.tags)\n      .map(([t, m]) => `${t},${m}`)\n      .join(\";\")\n  )}`\n\n  return Buffer.from(payload).toString(\"base64\")\n}\n\nexport function decodeSupertag(base64: string) {\n  const payload = Buffer.from(removeLeadingHastag(base64), \"base64\").toString()\n  const parts = payload.split(\"/\").map(decodeURI)\n  const supertag: Supertag = {\n    name: parts[0],\n    description: parts[1],\n    tags: Object.fromEntries(parts[2].split(\";\").map((e) => e.split(\",\"))),\n  }\n\n  return supertag\n}\n//#endregion\n\n//#region Tag serialization\n\n/**\n * Accepts a map of all tags and serializes them into a string that can be used as a Querystring parameter\n */\nexport function serializeAllTags(tags: Record<string, QueryTag | Supertag>) {\n  const resolvedTags = flattenSupertags(Object.values(tags))\n  const tagsByModifier = groupTagsByModifier(resolvedTags)\n  const normalTags = [...tagsByModifier[\"+\"], ...tagsByModifier[\"-\"]]\n    .map(serializeTag)\n    .join(\" + \")\n  const optionalTags =\n    tagsByModifier[\"~\"].length > 0\n      ? ` + ( ${tagsByModifier[\"~\"].map(serializeTag).join(\" ~ \")} )`\n      : \"\"\n\n  return `${normalTags}${optionalTags}`\n}\n\n/**\n * Accepts a list that holds normal tags and supertags and unpacks all supertags.\n * The result contains all normal tags given plus all contents of the supertags given.\n */\nexport function flattenSupertags(tags: Array<QueryTag | Supertag>) {\n  let resolvedTags: QueryTag[] = []\n\n  tags.forEach((tag) => {\n    if (isSupertag(tag)) {\n      Object.entries(tag.tags).forEach(([name, modifier]) => {\n        resolvedTags.push({ name, modifier })\n      })\n    } else {\n      resolvedTags.push(tag)\n    }\n  })\n\n  return resolvedTags\n}\n\n/**\n * Given a list of tags this function returns a record with an entry for each modifier countaining all tags of the original list that match that modifier.\n */\nexport function groupTagsByModifier(tags: QueryTag[]) {\n  return tags.reduce(\n    (result, current) => {\n      if (!(current.modifier in result)) result[current.modifier] = []\n\n      result[current.modifier]?.push(current)\n\n      return result\n    },\n    { \"+\": [], \"-\": [], \"~\": [] } as Record<TagModifier, QueryTag[]>\n  )\n}\n\n/**\n * Serializes a tag for use in urls\n */\nexport function serializeTag(tag: QueryTag) {\n  return `${tag.modifier === \"-\" ? \"-\" : \"\"}${serializeTagname(tag.name)}`\n}\n\n/**\n * Serializes tag names for use in api requests.\n */\nexport function serializeTagname(tagname: string) {\n  return encodeURIComponent(tagname.toLowerCase().replace(/ /g, \"_\"))\n}\n\n//#endregion\n","import styled from 'styled-components'\nimport { flexRowWithGap } from '../../styled/mixins/layout'\n\nconst FlexPair = styled.div`\n  ${flexRowWithGap}\n`\n\nexport default FlexPair\n","import { css } from 'styled-components'\nimport { PropsWithTheme } from './types'\n\nexport function boxShadow({ theme }: PropsWithTheme) {\n  return css`\n    box-shadow: 0 1px ${theme.shadow.radius} ${theme.shadow.color};\n  `\n}\n\nexport function dropShadow({ theme }: PropsWithTheme) {\n  return css`\n    filter: drop-shadow(0 1px ${theme.shadow.radius} ${theme.shadow.color});\n  `\n}\n","import { useCallback } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { removeTag, addTag } from '../redux/actions'\nimport { selectActiveTags } from '../redux/selectors'\nimport * as r34 from 'r34-types'\n\n/**\n * This hook allows you to add a tag to your search or remove it based on its current status.\n */\nexport default function useToggleTag() {\n  const dispatch = useDispatch()\n  const activeTags = useSelector(selectActiveTags)\n  const toggleTag = useCallback(\n    (tag: r34.AnyBiasedTag) => {\n      if (tag.name in activeTags) {\n        dispatch(removeTag(tag.name))\n      } else {\n        dispatch(addTag(tag))\n      }\n    },\n    [activeTags, dispatch]\n  )\n\n  return toggleTag\n}\n","import { useCallback, useState } from 'react'\n\n/**\n * A small wrapper for a useState<boolean> that is primarily used for toggling.\n * Saves me a few useCallbacks.\n */\nexport default function useToggle(initialValue = false): [boolean, () => void, () => void] {\n  const [value, setValue] = useState<boolean>(initialValue)\n  const toggleValue = useCallback(() => setValue(!value), [value])\n  const resetValue = useCallback(() => setValue(initialValue), [initialValue])\n\n  return [value, toggleValue, resetValue]\n}\n","import styled, { css } from 'styled-components'\nimport { TagModifier } from 'r34-types'\n\nconst modifierToStyle = {\n  '+': css``,\n  '-': css`\n    text-decoration: line-through;\n  `,\n  '~': css`\n    font-style: italic;\n  `,\n}\n\ninterface ModifierStyledTextProps {\n  modifier: TagModifier\n}\n\nexport const ModifierStyledText = styled.span(\n  ({ modifier = '+' }: ModifierStyledTextProps) => modifierToStyle[modifier]\n)\n","import { TagModifier } from 'r34-types'\nimport { formatTagnameAndCount } from '../../misc/formatting'\nimport { ModifierStyledText } from '../designsystem/ModifierStyledText'\n\ninterface TagNameProps {\n  modifier: TagModifier\n  name: string\n  count?: number\n}\n\nexport default function TagName(props: TagNameProps) {\n  const { modifier, name, count } = props\n\n  return <ModifierStyledText modifier={modifier}>{formatTagnameAndCount(name, count)}</ModifierStyledText>\n}\n","import React, { MouseEventHandler, useCallback } from 'react'\nimport { useDispatch } from 'react-redux'\nimport styled, { css } from 'styled-components'\nimport { TagModifier } from 'r34-types'\nimport { addTag } from '../../redux/actions'\nimport { flexRowWithGap } from '../../styled/mixins/layout'\nimport TagName from './TagName'\n\ninterface AliasProps {\n  modifier: TagModifier\n  name: string\n  count: number\n}\n\nconst AliasWrapper = styled.div(\n  ({ theme }) => css`\n    ${flexRowWithGap({ theme })}\n    padding: ${theme.dimensions.bigSpacing};\n    font-size: ${theme.fontSizes.content};\n    cursor: pointer;\n  `\n)\n\nexport default function Alias(props: AliasProps) {\n  const { name, count, modifier } = props\n\n  const dispatch = useDispatch()\n\n  const handleClick: MouseEventHandler = useCallback(\n    (event) => {\n      event.stopPropagation()\n      dispatch(addTag({ name, types: [], count, modifier }))\n    },\n    [count, dispatch, modifier, name]\n  )\n\n  return (\n    <AliasWrapper onClick={handleClick} data-name={`alias:${name}`}>\n      <TagName modifier={modifier} name={name} count={count} />\n    </AliasWrapper>\n  )\n}\n","import React from 'react'\nimport styled, { css, DefaultTheme } from 'styled-components'\nimport Alias from './Alias'\nimport * as r34 from 'r34-types'\nimport { dropdownScrollbar } from '../../styled/mixins/scrollbar'\nimport { ZIndex } from '../../styled/zIndex'\n\nconst ListWrapper = styled.div(({ theme, parentRef }: { theme: DefaultTheme; parentRef: HTMLDivElement }) => {\n  if (parentRef) {\n    const clientRect = parentRef.getBoundingClientRect()\n\n    return css`\n      position: absolute;\n      top: ${parentRef.offsetTop + clientRect.height}px;\n      left: ${parentRef.offsetLeft}px;\n      width: ${clientRect.width}px;\n\n      display: flex;\n      flex-direction: column;\n\n      border-bottom-left-radius: ${theme.dimensions.borderRadius};\n      border-bottom-right-radius: ${theme.dimensions.borderRadius};\n      border: ${theme.dimensions.borderWidth} solid ${theme.colors.accentColor};\n      border-top: none;\n\n      background: ${theme.colors.backgroundColor2};\n      z-index: ${ZIndex.DROPDOWN};\n      color: ${theme.colors.backgroundColor};\n\n      > :not(:last-child) {\n        border-bottom: ${theme.dimensions.borderWidth} solid lightgray;\n      }\n\n      max-height: 30vh;\n\n      ${dropdownScrollbar}\n    `\n  } else {\n    return css`\n      display: none;\n    `\n  }\n})\n\ninterface AliasesListProps {\n  aliases: r34.AliasTag[]\n  modifier: r34.TagModifier\n  parentRef: HTMLDivElement\n}\n\nexport default function AliasesList(props: AliasesListProps) {\n  const { aliases, modifier, parentRef } = props\n\n  return (\n    <ListWrapper parentRef={parentRef} className='aliaslist'>\n      {aliases.map(({ name, count }) => (\n        <Alias key={'a_' + name} name={name} count={count} modifier={modifier} />\n      ))}\n    </ListWrapper>\n  )\n}\n","import styled, { css, DefaultTheme } from 'styled-components'\nimport { TagIsActive } from '../../data/types'\nimport { flexRowWithGap } from '../../styled/mixins/layout'\nimport { primary, secondary, focus } from '../../styled/mixins/theming'\n\nconst dropdownBorderRadius = (collapsed: boolean, theme: DefaultTheme) =>\n  collapsed ? theme.dimensions.borderRadius : `${theme.dimensions.borderRadius} ${theme.dimensions.borderRadius} 0 0`\n\nconst switchingColors = (active: TagIsActive, collapsed: boolean, theme: DefaultTheme) => {\n  switch (active) {\n    case 'direct':\n      return css`\n        ${primary}\n      `\n    case 'indirect':\n      return css`\n        color: ${theme.colors.accentColor};\n        background-color: ${theme.colors.accentColor}40;\n\n        :hover {\n          background-color: ${theme.colors.accentColor}60;\n        }\n\n        :active {\n          background-color: ${theme.colors.accentColor}50;\n        }\n\n        ${focus}\n      `\n    case 'no':\n      return css`\n        ${secondary}\n      `\n  }\n}\n\nexport const ChipWrapper = styled.div(\n  (props: { active: TagIsActive; collapsed: boolean; theme: DefaultTheme }) =>\n    css`\n      cursor: pointer;\n      border: ${props.theme.colors.accentColor} ${props.theme.dimensions.borderWidth} solid;\n      ${flexRowWithGap({ theme: props.theme })}\n      ${switchingColors(props.active, props.collapsed, props.theme)}\n      padding: 0 ${props.theme.dimensions.bigSpacing};\n      height: ${props.theme.dimensions.blockHeight};\n      border-radius: ${dropdownBorderRadius(props.collapsed, props.theme)};\n      font-size: ${props.theme.fontSizes.content};\n      user-select: none;\n\n      ${props.collapsed\n        ? ''\n        : css`\n            border-bottom-color: ${props.theme.colors.accentColor};\n          `}\n    `\n)\n","import React, { KeyboardEventHandler, MouseEventHandler, SyntheticEvent, useCallback, useState } from 'react'\nimport styled, { DefaultTheme, css } from 'styled-components'\nimport { TagModifier, TagType, AliasTag } from 'r34-types'\nimport useToggle from '../../hooks/useToggle'\nimport { ArrowDown } from '../../icons/FontAwesomeIcons'\nimport TypeIcon from '../../icons/TypeIcon'\nimport AliasesList from './AliasesList'\nimport { ChipWrapper } from './ChipWrapper'\nimport TagName from './TagName'\nimport { TagIsActive } from '../../data/types'\n\nconst DropdownArrow = styled(ArrowDown)(\n  ({ $collapsed, theme }: { $collapsed: boolean; theme: DefaultTheme }) => css`\n    transition: all ${theme.timings.transitionTime} ease-out;\n    height: 32px;\n    width: 32px !important;\n    padding: 8px;\n    margin: 0 -8px;\n    ${$collapsed\n      ? css``\n      : css`\n          transform: rotate(180deg);\n        `}\n  `\n)\n\nconst DropdownWrapper = styled.div(\n  ({ theme }) => css`\n    .aliaslist {\n      border-color: ${theme.colors.backgroundColor2};\n    }\n  `\n)\n\ninterface TagChipProps {\n  name: string\n  modifier: TagModifier\n  count?: number\n  type?: TagType\n  isActive: TagIsActive\n  detailed: boolean\n  onClick: React.EventHandler<SyntheticEvent>\n  onContextMenu?: React.EventHandler<SyntheticEvent>\n  aliases?: AliasTag[]\n}\n\nexport default function TagChip(props: TagChipProps) {\n  const { name, count, modifier, type, isActive, detailed, onClick, onContextMenu, aliases } = props\n\n  const [tagRef, setTagRef] = useState<HTMLDivElement | null>(null)\n  const [collapsed, toggleCollapsed] = useToggle(true)\n\n  const handleClick = useCallback(\n    (event: React.MouseEvent | React.KeyboardEvent) => {\n      event.preventDefault()\n      event.stopPropagation()\n      onClick(event)\n    },\n    [onClick]\n  )\n\n  const handleArrowClick: MouseEventHandler = useCallback(\n    (event) => {\n      event.stopPropagation()\n      toggleCollapsed()\n    },\n    [toggleCollapsed]\n  )\n\n  const handleEnter: KeyboardEventHandler = useCallback(\n    (event) => {\n      if (event.key === 'Enter') handleClick(event)\n    },\n    [handleClick]\n  )\n\n  const handleContextMenu = React.useCallback(\n    (e) => {\n      e.stopPropagation()\n      e.preventDefault()\n      onContextMenu?.(e)\n    },\n    [onContextMenu]\n  )\n\n  return (\n    <DropdownWrapper>\n      <ChipWrapper\n        active={isActive}\n        collapsed={collapsed}\n        onClick={handleClick}\n        onKeyDown={handleEnter}\n        onContextMenu={handleContextMenu}\n        ref={setTagRef}\n        tabIndex={0}\n        role='listitem'\n      >\n        {detailed && <TypeIcon type={type} />}\n        <TagName modifier={modifier} name={name} count={count} />\n        {detailed && aliases && aliases.length > 0 && (\n          <DropdownArrow onClick={handleArrowClick} $collapsed={collapsed} title='Show aliases' />\n        )}\n      </ChipWrapper>\n      {detailed && aliases && aliases.length > 0 && !collapsed && tagRef && (\n        <AliasesList aliases={aliases} modifier={modifier} parentRef={tagRef} />\n      )}\n    </DropdownWrapper>\n  )\n}\n","import React from 'react'\nimport * as r34 from 'r34-types'\nimport TagChip from './TagChip'\nimport { TagIsActive } from '../../data/types'\n\ninterface SupertagProps {\n  tag: r34.Supertag\n  isActive: TagIsActive\n  detailed: boolean\n  onClick: React.MouseEventHandler\n}\n\nexport default function Supertag(props: SupertagProps) {\n  const { tag, isActive, detailed, onClick } = props\n  const { name, tags } = tag\n\n  const count = Object.keys(tags).length\n\n  return (\n    <TagChip\n      name={name}\n      modifier='+'\n      type='supertag'\n      count={count}\n      isActive={isActive}\n      detailed={detailed}\n      onClick={onClick}\n    />\n  )\n}\n","import * as r34 from 'r34-types'\nimport TagChip from './TagChip'\nimport { getInterestingType } from '../../data/tagUtils'\nimport { TagIsActive } from '../../data/types'\nimport { useSelector } from 'react-redux'\nimport { selectAliases } from '../../redux/selectors'\n\ninterface TagProps {\n  tag: r34.BiasedTag\n  isActive: TagIsActive\n  detailed: boolean\n  onClick: React.MouseEventHandler\n  onContextMenu: React.MouseEventHandler\n}\n\nexport function BiasedTag(props: TagProps) {\n  const { tag, detailed, onClick, isActive, onContextMenu } = props\n  const { name, count, modifier, types } = tag\n\n  const aliases = useSelector(selectAliases)[name]\n\n  return (\n    <TagChip\n      name={name}\n      modifier={modifier}\n      type={getInterestingType(types)}\n      count={count}\n      isActive={isActive}\n      detailed={detailed}\n      onClick={onClick}\n      onContextMenu={onContextMenu}\n      aliases={aliases}\n    />\n  )\n}\n","import React, { MouseEventHandler, useCallback } from 'react'\nimport * as r34 from 'r34-types'\nimport { bias, isBiased, isSupertag } from '../../data/tagUtils'\nimport Supertag from './Supertag'\nimport { BiasedTag } from './BiasedTag'\nimport { TagIsActive } from '../../data/types'\n\ninterface TagProps {\n  tag: r34.AnyBiasedTag | r34.AnyTag\n  isActive: TagIsActive\n  detailed: boolean\n  onClick: (tag: r34.AnyBiasedTag) => void\n  onContextMenu: (tag: r34.AnyBiasedTag) => void\n}\n\nexport default function Tag(props: TagProps) {\n  const { tag, isActive, detailed, onClick, onContextMenu } = props\n\n  const biasedTag = isSupertag(tag) || isBiased(tag) ? tag : bias(tag, '+')\n\n  const handleClick: MouseEventHandler = useCallback(\n    (event) => {\n      event?.stopPropagation()\n      onClick(biasedTag)\n    },\n    [onClick, biasedTag]\n  )\n\n  const handleContextMenu: MouseEventHandler = useCallback(\n    (event) => {\n      onContextMenu(biasedTag)\n    },\n    [biasedTag, onContextMenu]\n  )\n\n  return isSupertag(biasedTag) ? (\n    <Supertag tag={biasedTag} isActive={isActive} detailed={detailed} onClick={handleClick} />\n  ) : (\n    <BiasedTag\n      tag={biasedTag}\n      isActive={isActive}\n      detailed={detailed}\n      onClick={handleClick}\n      onContextMenu={handleContextMenu}\n    />\n  )\n}\n","import React from 'react'\nimport styled from 'styled-components'\nimport { AnyBiasedTag, AnyTag } from 'r34-types'\nimport { multilineList } from '../../styled/mixins/layout'\nimport Tag from './Tag'\nimport { TagIsActive } from '../../data/types'\n\nconst TagListWrapper = styled.div`\n  ${multilineList}\n`\n\ninterface TagListProps {\n  /**\n   * The entries of the list. Must be a map to avoid duplicates\n   */\n  tags: Record<string, AnyTag>\n  /**\n   * Passthrough classname for styling from outside\n   */\n  className?: string\n  /**\n   * Setting detailed to true displays a type for some tags and provides the ability to add aliases.\n   */\n  detailed: boolean\n  /**\n   * Children will be added at the end of the list. Here you can provide additional functionality or information\n   */\n  children?: React.ReactNode\n\n  onTagClick: (tag: AnyBiasedTag) => void\n  onTagMenu: (tag: AnyBiasedTag) => void\n  getIsActive?: (tag: AnyTag) => TagIsActive\n}\n\n/**\n * This component can be used to display multiple tags in a list of chips/badges.\n *\n */\nexport default function TagList(props: TagListProps) {\n  const { tags, className, detailed, children = null, onTagClick, getIsActive, onTagMenu } = props\n\n  return (\n    <TagListWrapper className={className} role='list'>\n      {Object.entries(tags).map(([key, tag]) => (\n        <Tag\n          key={key}\n          detailed={detailed}\n          tag={tag}\n          onClick={onTagClick}\n          onContextMenu={onTagMenu}\n          isActive={getIsActive?.(tag) || 'no'}\n        />\n      ))}\n      {children}\n    </TagListWrapper>\n  )\n}\n","export default __webpack_public_path__ + \"static/media/OutOfResults.9c71691c.png\";","import React from 'react'\nimport styled from 'styled-components'\n\n// Don't use theme here so the loadingScreen is independent\n// eg. Loading the theme displays this loading screen\nconst StyledSvg = styled.svg`\n  height: 32px;\n  padding: 8px;\n  color: white;\n`\n\nexport default function Loading() {\n  return (\n    <StyledSvg\n      xmlns='http://www.w3.org/2000/svg'\n      xmlnsXlink='http://www.w3.org/1999/xlink'\n      viewBox='0 0 50 20'\n      enable-background='new 0 0 0 0'\n      xmlSpace='preserve'\n    >\n      <circle fill='currentcolor' stroke='none' cx='6' cy='10' r='6'>\n        <animate attributeName='opacity' dur='1s' values='0;1;0' repeatCount='indefinite' begin='0.1' />\n      </circle>\n      <circle fill='currentcolor' stroke='none' cx='25' cy='10' r='6'>\n        <animate attributeName='opacity' dur='1s' values='0;1;0' repeatCount='indefinite' begin='0.2' />\n      </circle>\n      <circle fill='currentcolor' stroke='none' cx='44' cy='10' r='6'>\n        <animate attributeName='opacity' dur='1s' values='0;1;0' repeatCount='indefinite' begin='0.3' />\n      </circle>\n    </StyledSvg>\n  )\n}\n","import styled, { css } from 'styled-components'\n\nexport const HorizontalLine = styled.div(\n  (props) => css`\n    align-self: stretch;\n    height: 1px;\n    background: ${props.theme.colors.layerBgHighlight};\n  `\n)\n\nexport const VerticalLine = styled.div(\n  (props) => css`\n    width: 1px;\n    align-self: stretch;\n    background: ${props.theme.colors.layerBgHighlight};\n  `\n)\n","import { useCallback } from 'react'\nimport { TagModifier } from 'r34-types'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { selectSuggestionsModifier } from '../redux/selectors'\nimport { setSuggestionsModifier } from '../redux/actions'\n\nconst order: TagModifier[] = ['+', '-', '~']\n\n/**\n * Small utility hook to abstract the rotating modifier away\n */\nexport default function useModifier() {\n  const dispatch = useDispatch()\n  const modifier = useSelector(selectSuggestionsModifier)\n  const nextModifier = useCallback(\n    () => dispatch(setSuggestionsModifier(order[(order.indexOf(modifier) + 1) % order.length])),\n    [dispatch, modifier]\n  )\n\n  return [modifier, nextModifier] as const\n}\n","import React, { useCallback, useEffect } from 'react'\nimport * as r34 from 'r34-types'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { isSupertag } from '../../data/tagUtils'\nimport { ModalId, NO_OP } from '../../data/types'\nimport { useCheckIsActive } from '../../hooks/useCheckIsActive'\nimport useToggleTag from '../../hooks/useToggleTag'\nimport { SupertagIcon } from '../../icons/FontAwesomeIcons'\nimport { addTag, openModal } from '../../redux/actions'\nimport { selectActiveTags, selectNumberOfActiveTags } from '../../redux/selectors'\nimport { PrimaryButton } from '../designsystem/Buttons'\nimport TagList from '../tag/TagList'\n\ninterface ActiveTagsProps {\n  onChange?: () => void\n  offerSupertags?: boolean\n}\n\nexport default function ActiveTags(props: ActiveTagsProps) {\n  const { onChange = NO_OP, offerSupertags = false } = props\n\n  const dispatch = useDispatch()\n\n  const activeTags = useSelector(selectActiveTags)\n  const numberOfActiveTags = useSelector(selectNumberOfActiveTags)\n  const openSupertagModal = useCallback(() => dispatch(openModal(ModalId.CREATE_SUPERTAG)), [dispatch])\n\n  const toggleTag = useToggleTag()\n  const checkIsActive = useCheckIsActive()\n\n  const onTagMenu = React.useCallback(\n    (tag: r34.AnyBiasedTag) => {\n      if (!isSupertag(tag)) {\n        const order: r34.TagModifier[] = ['+', '-', '~']\n        const nextModifer = order[(order.indexOf(tag.modifier) + 1) % 3]\n        dispatch(addTag({ ...tag, modifier: nextModifer }))\n      }\n    },\n    [dispatch]\n  )\n\n  // Fire change event when tags change\n  // This is used to re-measure the height\n  useEffect(() => onChange(), [onChange, activeTags])\n\n  return numberOfActiveTags > 0 ? (\n    <TagList tags={activeTags} onTagClick={toggleTag} getIsActive={checkIsActive} onTagMenu={onTagMenu} detailed>\n      {offerSupertags && Object.keys(activeTags).length > 1 && (\n        <PrimaryButton onClick={openSupertagModal} title='Create a supertag'>\n          <SupertagIcon />\n        </PrimaryButton>\n      )}\n    </TagList>\n  ) : null\n}\n","import { useCallback } from 'react'\nimport { useSelector } from 'react-redux'\nimport { AnyTag } from 'r34-types'\nimport { TagIsActive } from '../data/types'\nimport { selectActiveSupertagTags, selectActiveTags } from '../redux/selectors'\n\nexport const useCheckIsActive = () => {\n  const activeTags = useSelector(selectActiveTags)\n  const activeSupertagsTags = useSelector(selectActiveSupertagTags)\n\n  return useCallback(\n    (tag: AnyTag): TagIsActive => {\n      if (tag.name in activeTags) return 'direct'\n      if (tag.name in activeSupertagsTags) return 'indirect'\n      else return 'no'\n    },\n    [activeSupertagsTags, activeTags]\n  )\n}\n","import * as r34 from 'r34-types'\nimport { useCallback } from 'react'\nimport { useDispatch } from 'react-redux'\nimport { addTag } from '../redux/actions'\n\nexport const useActivateTag = () => {\n  const dispatch = useDispatch()\n\n  return useCallback(\n    (tag: r34.AnyBiasedTag) => {\n      dispatch(addTag(tag))\n    },\n    [dispatch]\n  )\n}\n","import React from 'react'\nimport * as r34 from 'r34-types'\nimport styled, { css } from 'styled-components'\nimport { CountUnit } from '../../data/types'\nimport TypeIcon from '../../icons/TypeIcon'\nimport { formatCount, formatTagname } from '../../misc/formatting'\n\nconst EntryWrapper = styled.div(\n  ({ theme }) => css`\n    display: grid;\n    grid-template-columns: 48px 1fr auto;\n    background: ${theme.colors.backgroundColor2};\n    padding: ${theme.dimensions.bigSpacing} 0;\n    align-items: center;\n    cursor: pointer;\n  `\n)\n\nconst Name = styled.span`\n  grid-column: 2/3;\n`\n\nconst Count = styled.span(\n  ({ theme }) => css`\n    grid-column: 3/4;\n    padding-right: ${theme.dimensions.bigSpacing};\n  `\n)\n\nconst Icon = styled.div`\n  grid-column: 1/2;\n  text-align: center;\n`\n\ninterface EntryProps {\n  name: string\n  count: number\n  type?: r34.TagType\n  onClick: React.MouseEventHandler\n}\n\nexport default function DropdownListEntry(props: EntryProps) {\n  const { name, count, type, onClick } = props\n\n  const unit: CountUnit = type === 'supertag' ? 'tags' : 'posts'\n\n  return (\n    <EntryWrapper onClick={onClick} role='listitem'>\n      <Icon>\n        <TypeIcon type={type} />\n      </Icon>\n      <Name>{formatTagname(name)}</Name>\n      <Count title={`${count} ${unit}`}>\n        {count && formatCount(count)} {unit}\n      </Count>\n    </EntryWrapper>\n  )\n}\n","import styled, { css } from 'styled-components'\nimport { flexRowWithGap } from '../../styled/mixins/layout'\n\nexport const DropdownListError = styled.div(\n  ({ theme }) => css`\n    ${flexRowWithGap}\n    flex-wrap: wrap;\n    min-height: ${theme.dimensions.blockHeight}; // COMPAT: Kiwi Browser\n    background: ${theme.colors.backgroundColor2};\n    padding: 6px;\n    align-items: center;\n    justify-content: center;\n    text-align: center;\n  `\n)\n","import React from 'react'\nimport styled, { css, DefaultTheme } from 'styled-components'\nimport DropdownListEntry from './DropdownListEntry'\nimport * as r34 from 'r34-types'\nimport { getInterestingType, isSupertag } from '../../data/tagUtils'\nimport { SuggestionsError } from '../../data/types'\nimport { DropdownListError } from './DropdownListError'\nimport { flexColumnGap } from '../../styled/mixins/gap'\nimport { flexColumn } from '../../styled/mixins/layout'\nimport { dropdownScrollbar } from '../../styled/mixins/scrollbar'\nimport { ZIndex } from '../../styled/zIndex'\n\nfunction sizeAndPosition(tagSelector: HTMLElement | null) {\n  if (tagSelector) {\n    const { offsetTop, clientHeight, offsetLeft, clientWidth } = tagSelector\n\n    return css`\n      position: absolute;\n      top: ${offsetTop + clientHeight}px;\n      left: ${offsetLeft}px;\n      width: ${clientWidth}px;\n      max-height: 50vh;\n    `\n  } else {\n    return css`\n      display: none;\n    `\n  }\n}\n\nconst ListWrapper = styled.div(\n  ({ theme, tagSelectorRef }: { tagSelectorRef: HTMLElement | null; theme: DefaultTheme }) => css`\n    ${flexColumn()}\n    ${flexColumnGap('1px')}\n    ${sizeAndPosition(tagSelectorRef)};\n    background: lightgrey;\n    box-sizing: border-box;\n    border: ${theme.dimensions.borderWidth} ${theme.colors.accentColor} solid;\n    border-top: none;\n    border-radius: 0 0 3px 3px;\n    color: black;\n    z-index: ${ZIndex.DROPDOWN};\n\n    ${dropdownScrollbar}\n  `\n)\n\ninterface DropdownListProps {\n  tagSelectorRef: HTMLElement | null\n  entries: r34.AnyTag[]\n  onClick: (entry: r34.AnyTag) => void\n  error: SuggestionsError | null\n}\n\nexport default function DropdownList(props: DropdownListProps) {\n  const { tagSelectorRef, entries, onClick, error } = props\n\n  return (\n    <ListWrapper tagSelectorRef={tagSelectorRef} role='list'>\n      {error ? (\n        <DropdownListError role='listitem'>\n          <span>{error.message}.</span>\n          <span>{error.results} tags found</span>\n        </DropdownListError>\n      ) : (\n        entries.map((entry) => {\n          const type = isSupertag(entry) ? 'supertag' : getInterestingType(entry.types)\n          const count = isSupertag(entry) ? Object.keys(entry.tags).length : (entry.count as number)\n\n          return (\n            <DropdownListEntry\n              key={entry.name}\n              onClick={() => onClick(entry)}\n              name={entry.name}\n              type={type}\n              count={count}\n            />\n          )\n        })\n      )}\n    </ListWrapper>\n  )\n}\n","import React, { ChangeEventHandler, KeyboardEventHandler, useCallback } from 'react'\nimport styled, { css } from 'styled-components'\n\nconst Input = styled.input(\n  (props) => css`\n    width: 100%;\n    border: none;\n    outline: none;\n    background: none;\n    font-size: ${props.theme.fontSizes.content};\n    border-top: ${props.theme.colors.accentColor} ${props.theme.dimensions.borderWidth} solid;\n    border-bottom: ${props.theme.colors.accentColor} ${props.theme.dimensions.borderWidth} solid;\n  `\n)\n\ninterface TagInputProps {\n  value: string\n  setValue: (newValue: string) => void\n  onSubmit: () => void\n}\n\nexport default function TagInput(props: TagInputProps) {\n  const { value, setValue, onSubmit } = props\n\n  const handleChange: ChangeEventHandler<HTMLInputElement> = useCallback(\n    (event) => {\n      setValue(event.target.value)\n    },\n    [setValue]\n  )\n\n  const handleEnter: KeyboardEventHandler = useCallback(\n    (event: React.KeyboardEvent) => {\n      if (event.key === 'Enter') {\n        onSubmit()\n      }\n    },\n    [onSubmit]\n  )\n\n  return (\n    <Input\n      id='tag-input'\n      value={value}\n      onChange={handleChange}\n      onKeyDown={handleEnter}\n      placeholder='Search for tags'\n      aria-label='Search'\n    />\n  )\n}\n","import React from 'react'\nimport * as r34 from 'r34-types'\nimport { useDispatch, useSelector } from 'react-redux'\nimport styled, { css, DefaultTheme } from 'styled-components'\nimport useThrottledEffect from 'use-throttled-effect'\nimport { bias, isSupertag, serializeTagname } from '../../data/tagUtils'\nimport useModifier from '../../hooks/useModifier'\nimport { SubmitIcon } from '../../icons/FontAwesomeIcons'\nimport { fetchSuggestions, setSuggestions } from '../../redux/actions'\nimport { selectSuggestions, selectSuggestionsError } from '../../redux/selectors'\nimport { AddButton, ModifierButton } from '../designsystem/Buttons'\nimport DropdownList from './DropdownList'\nimport TagInput from './TagInput'\n\nconst TagSelectorWrapper = styled.form(\n  (props: { closed: boolean; ref: (ref: HTMLInputElement) => void; theme: DefaultTheme }) => css`\n    display: flex;\n    background: white;\n    ${props.closed\n      ? css`\n          border-radius: ${props.theme.dimensions.borderRadius};\n        `\n      : css`\n          border-radius: ${props.theme.dimensions.borderRadius} ${props.theme.dimensions.borderRadius} 0 0;\n\n          > ${AddButton} {\n            border-radius: 0 ${props.theme.dimensions.borderRadius} 0 0;\n          }\n\n          > ${ModifierButton} {\n            border-radius: ${props.theme.dimensions.borderRadius} 0 0 0;\n          }\n        `}\n  `\n)\n\ninterface TagSelectorProps {\n  showSupertags: boolean\n  onSubmit: (tag: r34.AnyBiasedTag) => void\n}\n\nexport default function TagSelector(props: TagSelectorProps) {\n  const { onSubmit, showSupertags } = props\n\n  const dispatch = useDispatch()\n\n  const [value, setValue] = React.useState('')\n  const [tagSelectorRef, setTagSelectorRef] = React.useState<HTMLElement | null>(null)\n  const [modifier, nextModifier] = useModifier()\n\n  const suggestions = useSelector(selectSuggestions)\n  const error = useSelector(selectSuggestionsError)\n\n  const activateTag = React.useCallback(\n    (tag: r34.Tag | r34.Supertag) => {\n      const biasedTag = isSupertag(tag) ? tag : bias(tag, modifier)\n      onSubmit(biasedTag)\n      setValue('')\n    },\n    [modifier, onSubmit]\n  )\n\n  // This effect updates suggestions based on the input value\n  // if the value is empty, it clears suggestions\n  // if the value is not empty, it fetches suggestions from the backend\n  useThrottledEffect(\n    () => {\n      if (value === '') {\n        if (suggestions.length > 0) {\n          dispatch(setSuggestions([]))\n        }\n      } else {\n        dispatch(fetchSuggestions(value, showSupertags))\n      }\n    },\n    300,\n    [value]\n  )\n\n  const handleAddClick = React.useCallback(() => {\n    if (value.trim()) {\n      const sanitizedTagname = serializeTagname(value)\n      const suggestion: r34.AnyTag | undefined = suggestions.find((s) => s.name === sanitizedTagname)\n\n      if (suggestion) {\n        activateTag(suggestion)\n      } else {\n        activateTag({ name: sanitizedTagname, types: [] })\n      }\n    }\n  }, [value, activateTag, suggestions])\n\n  const showList = suggestions.length > 0 || error !== null\n\n  const preventDefault = React.useCallback((e) => e.preventDefault(), [])\n\n  return (\n    <TagSelectorWrapper ref={setTagSelectorRef} closed={!showList} onSubmit={preventDefault}>\n      <ModifierButton onClick={nextModifier} aria-label='Tag Modifier' title='Cycle tag modifier'>\n        {modifier}\n      </ModifierButton>\n      <TagInput value={value} setValue={setValue} onSubmit={handleAddClick} />\n      <AddButton onClick={handleAddClick} aria-label='Add Tag'>\n        <SubmitIcon title='Add tag' />\n      </AddButton>\n      {showList && value.length > 0 && (\n        <DropdownList tagSelectorRef={tagSelectorRef} entries={suggestions} error={error} onClick={activateTag} />\n      )}\n    </TagSelectorWrapper>\n  )\n}\n","import React, { ReactNode } from 'react'\n\ninterface ErrorBoundaryProps {\n  fallback: ReactNode\n  children: ReactNode\n}\n\ninterface ErrorBoundaryState {\n  hasError: boolean\n}\n\nexport default class ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props)\n    this.state = { hasError: false }\n  }\n\n  static getDerivedStateFromError(error: Error) {\n    return { hasError: true }\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return this.props.fallback\n    }\n\n    return this.props.children\n  }\n}\n","import React from 'react'\nimport { RouteName } from '../../data/types'\n\nconst keybinds: Record<string, () => void> = {\n  '/': () => document.getElementById('tag-input')?.focus(),\n  'ctrl+1': () => (window.location.hash = `#${RouteName.SEARCH}`),\n  'ctrl+2': () => (window.location.hash = `#${RouteName.PREFERENCES}`),\n  'ctrl+3': () => (window.location.hash = `#${RouteName.ABOUT}`),\n}\n\nexport default function GlobalKeybindings() {\n  React.useEffect(() => {\n    const handler = (event: KeyboardEvent) => {\n      const pressed = `${event.ctrlKey ? 'ctrl+' : ''}${event.key}`\n\n      if (pressed in keybinds) {\n        event.preventDefault()\n        event.stopPropagation()\n        keybinds[pressed]()\n      }\n    }\n    document.addEventListener('keydown', handler)\n    return () => document.removeEventListener('keydown', handler)\n  })\n\n  return null\n}\n","import firebase from 'firebase/app'\nimport 'firebase/auth'\n\nlet initialized = false\nlet googleAuthProvider!: firebase.auth.GoogleAuthProvider\n\nexport function init() {\n  googleAuthProvider = new firebase.auth.GoogleAuthProvider()\n  initialized = true\n}\n\nexport function signIn() {\n  if (initialized) {\n    firebase\n      .auth()\n      .signInWithPopup(googleAuthProvider)\n      .catch((error) => {\n        console.error('Sign in failed:', error.code, error.message)\n      })\n  } else {\n    console.warn('Cannot sign in before initialization')\n  }\n}\n\nexport async function signOut() {\n  if (initialized) {\n    return await firebase\n      .auth()\n      .signOut()\n      .catch((error) => {\n        console.error('Sign out failed:', error.code, error.message)\n      })\n  } else {\n    console.warn('Cannot sign out before initialization')\n  }\n}\n","import firebase from \"firebase/app\"\n\nexport class GenericConverter<T> {\n  toFirestore(data: T): firebase.firestore.DocumentData {\n    return data as firebase.firestore.DocumentData\n  }\n  fromFirestore(\n    snapshot: firebase.firestore.QueryDocumentSnapshot,\n    options: firebase.firestore.SnapshotOptions\n  ): T {\n    const data = snapshot.data(options)!\n    return data as T\n  }\n}\n","import firebase from 'firebase/app'\nimport 'firebase/auth'\nimport 'firebase/firestore'\nimport { Preferences, SupertagData, TagModifier, User } from 'r34-types'\nimport { sha256 } from '../utils'\nimport { GenericConverter } from './genericConverter'\n\nlet initialized = false\nlet userConverter!: GenericConverter<User>\n\nexport function init() {\n  userConverter = new GenericConverter<User>()\n  initialized = true\n}\n\nasync function getUserDoc() {\n  console.log('[firestore] getting user document')\n  if (!initialized) {\n    console.warn('Cannot get userDoc. Not initialized yet')\n    return undefined\n  }\n  try {\n    const { currentUser } = firebase.auth()\n    const email = currentUser?.email\n\n    if (email) {\n      const key = await sha256(email)\n      const userDoc = firebase.firestore().collection('users').doc(key)\n      return userDoc\n    }\n\n    return undefined\n  } catch (err) {\n    console.warn('Failed to get user document:', err)\n    return undefined\n  }\n}\n\nasync function getUserData() {\n  const userDoc = await getUserDoc()\n\n  if (userDoc) {\n    let userSnap = await userDoc.withConverter(userConverter).get()\n\n    const userData = userSnap.data()\n    return userData\n  }\n\n  return undefined\n}\n\nexport async function getPreferences() {\n  const userData = await getUserData()\n\n  if (userData) return userData.preferences\n\n  return undefined\n}\n\nexport async function setPreferences(preferences: Preferences) {\n  const userDoc = await getUserDoc()\n\n  await userDoc?.set({ preferences: preferences })\n}\n\nexport async function resetSeenPosts() {\n  console.warn('no longer supported')\n}\n\nexport async function getSupertags() {\n  const userDoc = await getUserDoc()\n\n  if (userDoc) {\n    console.log('[firestore] getting user supertags')\n    const snap = await userDoc.collection('supertags').get()\n    const result: Record<string, SupertagData> = {}\n\n    snap.forEach((doc) => {\n      result[doc.id] = doc.data() as SupertagData\n    })\n\n    return result\n  }\n\n  return undefined\n}\n\nexport async function addSupertag(name: string, description: string, tags: Record<string, TagModifier>) {\n  const userDoc = await getUserDoc()\n\n  userDoc?.collection('supertags').doc(name).set({ description, tags })\n}\n\nexport async function removeSupertag(name: string) {\n  const userDoc = await getUserDoc()\n\n  userDoc?.collection('supertags').doc(name).delete()\n}\n\nexport async function setTagsOfSupertag(name: string, tags: Record<string, TagModifier>) {\n  const userDoc = await getUserDoc()\n\n  userDoc?.collection('supertags').doc(name).update({ tags })\n}\n","export type ParamsRecord = Record<string, string | number | boolean>\n\nexport const asString = (value: any): string => (typeof value === 'string' ? value : value.toString())\n\nexport const createSearchParams = (params: ParamsRecord) =>\n  Object.entries(params).reduce((acc, [key, value]) => {\n    acc.append(key, asString(value))\n    return acc\n  }, new URLSearchParams())\n\nexport const sha256 = async (value: string) => {\n  const msgBuffer = new TextEncoder().encode(value)\n  const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer)\n  const hashArray = Array.from(new Uint8Array(hashBuffer))\n  const hashHex = hashArray.map((b) => b.toString(16).padStart(2, '0')).join('')\n\n  return hashHex\n}\n","import firebase from 'firebase/app'\nimport 'firebase/analytics'\n\nenum AnalyticsEventId {\n  SEARCH = 'r34_search',\n}\n\nexport type SearchEvent = {\n  id: AnalyticsEventId.SEARCH\n  payload: {\n    page_number: number\n  }\n}\n\n/**\n * Should be called whenever a new search is started.\n */\nexport const searchEvent = (page_number: number): SearchEvent => ({\n  id: AnalyticsEventId.SEARCH,\n  payload: {\n    page_number,\n  },\n})\n\nlet initialized = false\n\nexport function init() {\n  initialized = true\n}\n\nexport async function logEvent(event: SearchEvent) {\n  if (initialized) {\n    firebase.analytics().logEvent<typeof event.id>(event.id, event.payload)\n  }\n}\n\nexport async function logFirebaseRead() {\n  if (initialized) {\n    firebase.analytics().logEvent('firebase_read', { site: 'r34_react' })\n  }\n}\n\nexport async function logFirebaseWrite() {\n  if (initialized) {\n    firebase.analytics().logEvent('firebase_write', { site: 'r34_react' })\n  }\n}\n","import firebase from 'firebase/app'\nimport 'firebase/analytics'\nimport 'firebase/auth'\nimport 'firebase/firestore'\nimport * as signIn from './signIn'\nimport * as storage from './storage'\nimport * as analytics from './analytics'\n\nlet initialized = false\nconst firebaseConfig = {\n  apiKey: 'AIzaSyBHdepwE7M4Byu2lFtX2s__9COcMdvXu7Q',\n  authDomain: 'r34-react.firebaseapp.com',\n  databaseURL: 'https://r34-react.firebaseio.com',\n  projectId: 'r34-react',\n  storageBucket: 'r34-react.appspot.com',\n  messagingSenderId: '844749417844',\n  appId: '1:844749417844:web:11fa1fda0e14f1ac2dd021',\n  measurementId: 'G-27J3QXZ8YR',\n}\n\nexport function init() {\n  if (!initialized) {\n    firebase.initializeApp(firebaseConfig)\n\n    initialized = true\n\n    signIn.init()\n    storage.init()\n    analytics.init()\n  }\n}\n\nexport * from './analytics'\nexport * from './signIn'\nexport * from './storage'\n","import React, { useCallback } from 'react'\nimport { signOut } from '../../client/firebase'\nimport { UndoIcon } from '../../icons/FontAwesomeIcons'\nimport { BlockButton } from '../designsystem/Buttons'\n\nexport default function ResetButton(props: any) {\n  const reset = useCallback(async () => {\n    // localStorage can be disabled in browser settings\n    localStorage?.clear()\n\n    await signOut()\n\n    window.location.hash = ''\n    window.location.reload()\n  }, [])\n\n  return (\n    <BlockButton onClick={reset} {...props}>\n      <UndoIcon /> Reset Application\n    </BlockButton>\n  )\n}\n","import { createGlobalStyle, css } from 'styled-components'\n\nexport default createGlobalStyle(\n  ({ theme }) => css`\n    p,\n    a,\n    button,\n    span,\n    div,\n    select,\n    input {\n      font-family: 'Raleway', sans-serif;\n      -webkit-font-smoothing: antialiased;\n      -moz-osx-font-smoothing: grayscale;\n      font-size: ${theme.fontSizes.content};\n    }\n\n    html {\n      background-color: ${theme.colors.backgroundColor};\n    }\n\n    body {\n      font-size: ${theme.fontSizes.content};\n      color: ${theme.colors.text};\n      background-color: ${theme.colors.backgroundColor};\n      transition: color 0.4s, background-color 0.4s;\n\n      // always show scrollbar to prevent layout shifts when changing pages\n      overflow-y: scroll;\n    }\n\n    a {\n      color: ${theme.colors.accentColor};\n      text-decoration: none;\n    }\n\n    // Not a touch device\n    // Touch devices have nice scrollbars by default\n    @media (pointer: fine) {\n      // Underline stuff that is focused on non-touch devices\n      // makes keyboard navigation clearer\n      button,\n      input,\n      select {\n        &:focus {\n          text-decoration: underline;\n        }\n      }\n\n      ::-webkit-scrollbar {\n        height: 8px;\n        transition: all ${theme.timings.transitionTime} ease-in-out;\n\n        :hover {\n          background: ${theme.colors.layerBg};\n        }\n      }\n\n      /* Track */\n      ::-webkit-scrollbar-track {\n        background: transparent;\n      }\n\n      /* Handle */\n      :hover {\n        ::-webkit-scrollbar {\n          background: ${theme.colors.layerBg};\n        }\n      }\n\n      ::-webkit-scrollbar-thumb {\n        background: ${theme.colors.layerBg};\n        border-radius: 1000px;\n\n        :hover {\n          background: ${theme.colors.layerBgHighlight};\n        }\n      }\n    }\n  `\n)\n","import React from 'react'\nimport styled from 'styled-components'\nimport ResetButton from '../widgets/ResetButton'\nimport outOfResultsPicture from '../../icons/OutOfResults.png'\nimport FlexImage from '../designsystem/FlexImage'\nimport { themes, defaultThemeId } from 'r34-branding'\nimport GlobalStyles from '../../GlobalStyles'\nimport { BlockButton } from '../designsystem/Buttons'\nimport { UndoIcon } from '../../icons/FontAwesomeIcons'\n\nconst FullScreenCentered = styled.div`\n  height: 100vh;\n  width: 100%;\n  display: grid;\n  place-items: center;\n  align-content: center;\n  padding: 30px;\n  background: ${({ theme }) => theme.colors.backgroundColor};\n\n  > * {\n    margin-bottom: 10px;\n  }\n`\n\nexport default function ErrorScreen() {\n  const theme = themes[defaultThemeId]\n\n  return (\n    <FullScreenCentered theme={theme}>\n      <GlobalStyles theme={theme} />\n      <FlexImage src={outOfResultsPicture} alt='Cute image to make unexpected crash more bearable' />\n      <h1>Sorry about that...</h1>\n      <p>A page reload might help:</p>\n      <BlockButton onClick={() => window.location.reload()}>\n        <UndoIcon /> Reload\n      </BlockButton>\n      <p>If the issue persists try resetting the app</p>\n      <ResetButton theme={theme} />\n    </FullScreenCentered>\n  )\n}\n","import React from 'react'\nimport styled from 'styled-components'\nimport Loading from '../../icons/Loading'\n\nconst FullScreenCentered = styled.div`\n  height: 100vh;\n  width: 100vw;\n  display: grid;\n  place-items: center;\n  background: black;\n`\n\nexport default function LoadingScreen() {\n  return (\n    <FullScreenCentered>\n      <Loading />\n    </FullScreenCentered>\n  )\n}\n","import React, { useCallback } from 'react'\nimport styled, { css } from 'styled-components'\nimport useAction from '../../hooks/useAction'\nimport { closeModal } from '../../redux/actions'\nimport { flexColumnWithGap, fullscreenOverlay } from '../../styled/mixins/layout'\nimport { ZIndex } from '../../styled/zIndex'\nimport { SolidSurface } from './Surface'\n\nconst Wrapper = styled.div(\n  ({ theme }) => css`\n    display: grid;\n    place-items: center;\n    ${fullscreenOverlay}\n    z-index: ${ZIndex.MODAL};\n    padding: ${theme.dimensions.hugeSpacing};\n    background: ${theme.colors.backdrop};\n  `\n)\n\nconst ModalSurface = styled(SolidSurface)(\n  ({ theme }) => css`\n    ${flexColumnWithGap}\n    max-width: ${theme.dimensions.modalWidth};\n    max-height: 100vh;\n    overflow-y: auto;\n    overscroll-behavior: none;\n  `\n)\n\ninterface ModalProps {\n  children: React.ReactNode\n}\n\nexport default function Modal(props: ModalProps) {\n  const { children } = props\n\n  const close = useAction(closeModal)\n  const blockEvent = useCallback((e) => e.stopPropagation(), [])\n\n  return (\n    <Wrapper onClick={close} title='Close modal'>\n      <ModalSurface onClick={blockEvent} title=''>\n        {children}\n      </ModalSurface>\n    </Wrapper>\n  )\n}\n","export default __webpack_public_path__ + \"static/media/eeek.ff41d889.png\";","import React, { useCallback } from 'react'\nimport useAction from '../../hooks/useAction'\nimport { closeModal, getResults } from '../../redux/actions'\nimport Modal from '../designsystem/Modal'\nimport eeek from '../../icons/eeek.png'\nimport FlexImage from '../designsystem/FlexImage'\nimport { Faded, Title } from '../designsystem/Text'\nimport { flexRowWithGap } from '../../styled/mixins/layout'\nimport { PrimaryButton } from '../designsystem/Buttons'\nimport styled from 'styled-components'\nimport { FailedIcon, SuccessIcon } from '../../icons/FontAwesomeIcons'\nimport LabeledToggle from '../designsystem/LabeledToggle'\nimport usePreference from '../../hooks/usePreference'\n\nconst ButtonRow = styled.div`\n  ${flexRowWithGap}\n\n  > ${PrimaryButton} {\n    flex-grow: 1;\n  }\n`\n\nexport default function CellularWarningModal() {\n  const close = useAction(closeModal)\n  const search = useAction(getResults)\n\n  const onConfirm = useCallback(() => {\n    search()\n    close()\n  }, [close, search])\n\n  const onCancel = useCallback(() => {\n    close()\n  }, [close])\n\n  const [autoPlay, setAutoPlay] = usePreference('autoPlay')\n  const toggleAutoPlay = useCallback(() => setAutoPlay(!autoPlay), [autoPlay, setAutoPlay])\n  const [preloadVideos, setPreloadVideos] = usePreference('preloadVideos')\n  const togglePreloadVideos = useCallback(() => setPreloadVideos(!preloadVideos), [preloadVideos, setPreloadVideos])\n  const [originals, setOriginals] = usePreference('originals')\n  const toggleOriginals = useCallback(() => setOriginals(!originals), [originals, setOriginals])\n\n  return (\n    <Modal>\n      <FlexImage src={eeek} />\n      <Title>Wait!</Title>\n      <Faded>\n        You are on cellular and have some features enabled that will consume a lot of data. Are you sure this is\n        intended?\n      </Faded>\n      <LabeledToggle value={autoPlay} onToggle={toggleAutoPlay}>\n        Auto-play Animations\n      </LabeledToggle>\n      <LabeledToggle value={preloadVideos} onToggle={togglePreloadVideos}>\n        Preload Animations\n      </LabeledToggle>\n      <LabeledToggle value={originals} onToggle={toggleOriginals}>\n        Load original sizes\n      </LabeledToggle>\n      <ButtonRow>\n        <PrimaryButton onClick={onConfirm}>\n          <SuccessIcon /> Yes\n        </PrimaryButton>\n        <PrimaryButton onClick={onCancel}>\n          <FailedIcon /> No\n        </PrimaryButton>\n      </ButtonRow>\n    </Modal>\n  )\n}\n","import React, { useCallback } from 'react'\nimport styled, { css } from 'styled-components'\nimport { PrimaryButton } from '../designsystem/Buttons'\nimport usePreference from '../../hooks/usePreference'\nimport { ZIndex } from '../../styled/zIndex'\nimport { SolidSurface } from '../designsystem/Surface'\n\nconst CookieWrapper = styled(SolidSurface)(\n  ({ theme }) => css`\n    position: sticky;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    color: ${theme.colors.text};\n    background: ${theme.colors.layerBgSolid};\n    z-index: ${ZIndex.COOKIEBAR};\n  `\n)\n\nconst StyledSpan = styled.span`\n  height: min-content;\n`\n\nexport default function CookieConfirmation() {\n  const [, setCookies] = usePreference('cookies')\n\n  const handleAccept = useCallback(() => setCookies(true), [setCookies])\n\n  return (\n    <CookieWrapper>\n      <StyledSpan>This website uses cookies.</StyledSpan>\n      <PrimaryButton onClick={handleAccept} aria-label='Allow Cookies' title='Accept Cookie usage'>\n        Okay\n      </PrimaryButton>\n    </CookieWrapper>\n  )\n}\n","import React, { useCallback, useState } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport styled, { css } from 'styled-components'\nimport { addSupertag } from '../../client/firebase'\nimport { selectActiveTags } from '../../redux/selectors'\nimport { defaultBorder } from '../../styled/mixins/theming'\nimport { BlockButton } from '../designsystem/Buttons'\nimport { HorizontalLine } from '../designsystem/Lines'\nimport { Title } from '../designsystem/Text'\nimport TagSelector from '../tagSelector/TagSelector'\nimport ActiveTags from './ActiveTags'\nimport * as r34 from 'r34-types'\nimport { isSupertag } from '../../data/tagUtils'\nimport { useActivateTag } from '../../hooks/useActivateTag'\nimport { closeModal, removeTag } from '../../redux/actions'\nimport useAction from '../../hooks/useAction'\nimport Modal from '../designsystem/Modal'\nimport { defaultBlock } from '../../styled/mixins/layout'\n\nconst StyledInput = styled.input(\n  ({ theme }) => css`\n    ${defaultBorder}\n    background-color: ${theme.colors.backgroundColor2};\n    ${defaultBlock}\n    text-align: left;\n  `\n)\n\nexport default function SupertagModal() {\n  const [name, setName] = useState('')\n  const [description, setDescription] = useState('')\n  const activeTags = useSelector(selectActiveTags)\n  const dispatch = useDispatch()\n  const activateTag = useActivateTag()\n  const close = useAction(closeModal)\n\n  const tags: Record<string, r34.TagModifier> = Object.values(activeTags)\n    .filter((tag): tag is r34.BiasedTag => !isSupertag(tag))\n    .reduce((result, tag) => ({ ...result, [tag.name]: tag.modifier }), {})\n\n  const handleCreate = useCallback(() => {\n    addSupertag(name, description, tags)\n      .then(() => {\n        Object.keys(tags).forEach((tagname) => dispatch(removeTag(tagname)))\n        activateTag({ name, description, tags })\n        close()\n      })\n      .catch((err) => console.error('Failed to create supertag', err))\n  }, [activateTag, close, description, dispatch, name, tags])\n\n  return (\n    <Modal>\n      <Title>Create Supertag</Title>\n      <HorizontalLine />\n      <StyledInput type='text' placeholder='Name' value={name} onChange={(e) => setName(e.target.value)} />\n      <StyledInput\n        type='text'\n        placeholder='Description'\n        value={description}\n        onChange={(e) => setDescription(e.target.value)}\n      />\n      <TagSelector showSupertags={false} onSubmit={activateTag} />\n      <ActiveTags />\n      <BlockButton onClick={handleCreate}>Create</BlockButton>\n    </Modal>\n  )\n}\n","enum AnalyticsEventId {\n  SEARCH = 'r34_search',\n}\n\nexport type SearchEvent = {\n  id: AnalyticsEventId.SEARCH\n  payload: {\n    page_number: number\n  }\n}\n\n/**\n * Should be called whenever a new search is started.\n */\nexport const searchEvent = (page_number: number): SearchEvent => ({\n  id: AnalyticsEventId.SEARCH,\n  payload: {\n    page_number,\n  },\n})\n","import { AppAction, SET_POSTS, ADD_POSTS } from '../actions'\n\nimport { searchEvent } from '../../analytics/events'\nimport { selectPageNumber, selectCookies } from '../selectors'\nimport { MiddlewareAPI, Dispatch } from 'redux'\nimport { logEvent } from '../../client/firebase'\n\nconst eventLogging = (store: MiddlewareAPI<any>) => (next: Dispatch<AppAction>) => (action: AppAction) => {\n  const state = store.getState()\n  const cookies = selectCookies(state)\n\n  // Only send analytics if the user consented\n  if (cookies) {\n    if (action.type === ADD_POSTS || action.type === SET_POSTS) {\n      const pageNumber = selectPageNumber(state)\n      logEvent(searchEvent(pageNumber))\n    }\n  }\n\n  next(action)\n}\n\nexport default eventLogging\n","import produce from 'immer'\nimport * as r34 from 'r34-types'\nimport { AppAction, SET_PREFERENCE, SET_PREFERENCES } from '../actions'\n\nexport interface PreferencesState {\n  rated: boolean\n  ratedThreshold: number\n  originals: boolean\n  cookies: boolean\n  preloadVideos: boolean\n  tagSuggestionsCount: number\n  resultsLayout: r34.ResultsLayout\n  pageSize: number\n  showMetadata: boolean\n  showComments: boolean\n  sort: r34.PostsSort\n  themeId: r34.Theme\n  autoPlay: boolean\n  hideSeen: boolean\n  autoscrollDelay: number\n  showPostDetails: boolean\n  backends: string[]\n}\n\nexport const initialPreferencesState: PreferencesState = {\n  rated: false,\n  ratedThreshold: 1,\n  originals: false,\n  cookies: false,\n  preloadVideos: false,\n  tagSuggestionsCount: 20,\n  resultsLayout: 'infinite_column',\n  pageSize: 20,\n  showMetadata: false,\n  showComments: false,\n  sort: 'date:desc',\n  themeId: 'dark',\n  autoPlay: false,\n  hideSeen: false,\n  autoscrollDelay: 10,\n  showPostDetails: true,\n  backends: ['https://r34-json.herokuapp.com', 'https://r34-api-clone.herokuapp.com'],\n}\n\nfunction setPreference<T extends r34.PreferenceKey>(state: PreferencesState, key: T, value: PreferencesState[T]) {\n  return produce(state, (draft) => {\n    draft[key] = value\n  })\n}\n\nfunction setPreferences(state: PreferencesState, preferences: Partial<PreferencesState>) {\n  return produce(state, (draft) => {\n    Object.assign(draft, preferences)\n  })\n}\n\nconst preferences = (state: PreferencesState = initialPreferencesState, action: AppAction): PreferencesState => {\n  switch (action.type) {\n    case SET_PREFERENCE:\n      return setPreference(state, action.key, action.value)\n    case SET_PREFERENCES:\n      return setPreferences(state, action.preferences)\n    default:\n      return state\n  }\n}\n\nexport default preferences\n","import { MiddlewareAPI } from 'redux'\nimport { Dispatch } from 'react'\nimport {\n  AppAction,\n  FETCH_PREFERENCES,\n  savePreferences,\n  SAVE_PREFERENCES,\n  setPreferences,\n  SET_PREFERENCE,\n} from '../actions'\nimport * as firebaseFunctions from '../../client/firebase'\nimport { initialPreferencesState } from '../reducers/preferences'\n\nlet saveTimeout: ReturnType<typeof setTimeout> | null = null\n\nconst persistence = (store: MiddlewareAPI) => (next: Dispatch<AppAction>) => async (action: AppAction) => {\n  if (action.type === SET_PREFERENCE) {\n    if (saveTimeout) {\n      clearTimeout(saveTimeout)\n      saveTimeout = null\n    } else {\n      saveTimeout = setTimeout(() => {\n        store.dispatch(savePreferences())\n        saveTimeout = null\n      }, 10000)\n    }\n  }\n\n  if (action.type === FETCH_PREFERENCES) {\n    const preferences = await firebaseFunctions.getPreferences()\n\n    if (preferences) {\n      // fill gaps with default values to avoid invalid preferences\n      const newPreferences = { ...initialPreferencesState, ...preferences }\n      store.dispatch(setPreferences(newPreferences))\n    }\n  }\n\n  if (action.type === SAVE_PREFERENCES) {\n    const { preferences } = store.getState()\n    firebaseFunctions.setPreferences(preferences)\n  }\n\n  next(action)\n}\n\nexport default persistence\n","import { AliasTag } from 'r34-types'\nimport { R34Client } from '../../client/R34Client'\nimport { Dispatch } from 'react'\nimport { MiddlewareAPI } from 'redux'\nimport { isSuggestionError, isSupertag, serializeTagname } from '../../data/tagUtils'\nimport {\n  addAliases,\n  addPosts,\n  ADD_TAG,\n  AppAction,\n  FETCH_COMMENTS,\n  FETCH_SUGGESTIONS,\n  GET_MORE_RESULTS,\n  GET_RESULTS,\n  LIKE_POST,\n  setComments,\n  setPosts,\n  setSuggestions,\n  setSuggestionsError,\n  SET_PREFERENCE,\n} from '../actions'\nimport {\n  selectActiveTags,\n  selectHasMoreResults,\n  selectMinRating,\n  selectPageNumber,\n  selectPageSize,\n  selectPostById,\n  selectSort,\n  selectTagSuggestionCount,\n} from '../selectors'\n\nconst client = new R34Client(['https://r34-json.herokuapp.com', 'https://r34-api-clone.herokuapp.com'], {\n  version: 'v2',\n  useFirebase: true,\n  requestRetries: 1,\n  verbose: true,\n})\n\nconst apiRequests = (store: MiddlewareAPI) => (next: Dispatch<AppAction>) => async (action: AppAction) => {\n  const state = store.getState()\n  const hasMoreResults = selectHasMoreResults(state)\n\n  if (action.type === SET_PREFERENCE && action.key === 'backends') {\n    client.backends = action.value as string[]\n  }\n\n  if ((action as any).type === 'persist/REHYDRATE') {\n    if ((action as any)?.payload?.preferences?.backends) {\n      client.backends = (action as any).payload.preferences.backends\n    }\n  }\n\n  if (action.type === GET_RESULTS) {\n    const activeTags = selectActiveTags(state)\n    const pageSize = selectPageSize(state)\n    const minRating = selectMinRating(state)\n    const sort = selectSort(state)\n\n    const result = await client.getPosts({\n      tags: activeTags,\n      limit: pageSize,\n      page: action.pageNumber,\n      score: `>=${minRating}`,\n      sort,\n    })\n\n    store.dispatch(setPosts(result.posts, result.count, action.pageNumber))\n  }\n\n  if (action.type === GET_MORE_RESULTS && hasMoreResults) {\n    const activeTags = selectActiveTags(state)\n    const pageNumber = selectPageNumber(state)\n    const pageSize = selectPageSize(state)\n    const minRating = selectMinRating(state)\n    const sort = selectSort(state)\n\n    const result = await client.getPosts({\n      tags: activeTags,\n      limit: pageSize,\n      page: pageNumber + 1,\n      score: `>=${minRating}`,\n      sort,\n    })\n\n    store.dispatch(addPosts(result.posts))\n  }\n\n  if (action.type === ADD_TAG) {\n    const activeTags = selectActiveTags(state)\n    let aliases: AliasTag[] = []\n    try {\n      aliases = await client.getAliases({ name: action.tag.name })\n    } catch (err) {\n      console.warn('Failed toget aliases for tag:', action.tag)\n    }\n\n    const sanitizedAliases = aliases\n      .sort((a, b) => b.count - a.count)\n      .filter((alias) => !(alias.name in activeTags))\n      .map(({ name, count }) => ({ name, count, types: [] }))\n\n    store.dispatch(addAliases(sanitizedAliases, action.tag.name))\n\n    // Request types for newly added tag\n    if (!isSupertag(action.tag) && action.tag.types.length === 0) {\n      try {\n        const data = await client.getTags({\n          name: action.tag.name,\n          limit: 1,\n        })\n        if (!isSuggestionError(data)) {\n          const tag = data.find((tag) => tag.name === action.tag.name)\n\n          if (tag && !isSupertag(tag)) {\n            action.tag.types = tag.types\n            action.tag.count = tag.count\n          }\n        }\n      } catch (err) {\n        console.warn('Failed to get types for tag:', action.tag)\n      }\n    }\n  }\n\n  if (action.type === LIKE_POST) {\n    fetch(`https://rule34.xxx/index.php?page=post&s=vote&id=${action.postId}&type=up`, { mode: 'no-cors' })\n      .then(() => {\n        // nothing to do, I update the state in advance\n      })\n      .catch((err) => {\n        console.warn('Upvote rejected', err)\n      })\n  }\n\n  if (action.type === FETCH_SUGGESTIONS) {\n    const limit = selectTagSuggestionCount(state)\n    const result = await client.getTags({\n      name: serializeTagname(action.value),\n      limit,\n      supertags: action.includeSupertags,\n      sort: 'count',\n    })\n\n    if (isSuggestionError(result)) {\n      store.dispatch(setSuggestionsError(result))\n    } else {\n      store.dispatch(setSuggestions(result))\n    }\n  }\n\n  if (action.type === FETCH_COMMENTS) {\n    const post = selectPostById(action.postId)(state)\n\n    if (post) {\n      const commentsUrl = `https://rule34-api.netlify.app/comments?post_id=${post.id}`\n      const comments = await client.getComments({ commentsUrl })\n      store.dispatch(setComments(action.postId, comments))\n    }\n  }\n\n  next(action)\n}\n\nexport default apiRequests\n","import { AliasTag, AnyTag, api, ApiVersion, Artist, Comment } from 'r34-types'\nimport { getSupertags, init } from './firebase'\nimport { createSearchParams, ParamsRecord } from './utils'\nimport { isSuggestionError, serializeAllTags } from './tagUtils'\n\n/**\n * Configure your client.\n */\nexport interface R34ClientOptions {\n  /**\n   * API version to use.\n   */\n  version: ApiVersion\n  /**\n   * When set to true, the API provides additional, user-specific information like supertags.\n   */\n  useFirebase: boolean\n  /**\n   * Configure how many posts are returned by default\n   */\n  postLimit: number\n  /**\n   * Configure how many tags are returned by default\n   */\n  tagLimit: number\n  /**\n   * How many times to retry failed requests\n   */\n  requestRetries: number\n  /**\n   * Enables console logging\n   */\n  verbose: boolean\n}\n\n/**\n * Can be a single backend or multiple. If there are multiple it will automatically switch when one goes down.\n * Valid backends include protocol and port and do not have a trailing slash.\n * @example \"http://localhost:8080\"\n * @example \"https://my-api-server.herokuapp.com\"\n */\nexport type BackendsUrls = string | string[]\n\nexport class R34Client {\n  //#region Properties\n  private currentBackend: number\n\n  backends: string[]\n  useFirebase: boolean\n  postLimit: number\n  tagLimit: number\n  version: ApiVersion\n  requestRetries: number\n  verbose: boolean\n  //#endregion\n\n  //#region Management and Utils\n  /**\n   * Creates a new R34Client.\n   */\n  constructor(backends: BackendsUrls, options: Partial<R34ClientOptions> = {}) {\n    this.backends = typeof backends === 'string' ? [backends] : [...backends]\n    this.version = options.version || 'v2'\n    this.useFirebase = options.useFirebase || false\n    this.postLimit = options.postLimit || 20\n    this.tagLimit = options.tagLimit || 20\n    this.requestRetries = options.requestRetries || 1\n    this.verbose = options.verbose || false\n    this.currentBackend = 0\n\n    if (this.useFirebase) {\n      init()\n    }\n  }\n\n  /**\n   * Switches to the next backend in the list. When it runs out of backends returns to the first one.\n   */\n  private useNextBackend() {\n    this.currentBackend = (this.currentBackend + 1) % this.backends.length\n  }\n\n  /**\n   * Combines path with current backend and version to create a valid url\n   */\n  private getFullUrl(path: string, params: ParamsRecord): URL {\n    const host = this.backends[this.currentBackend]\n    const version = this.version\n    const search = createSearchParams(params).toString()\n\n    return new URL(`${host}/${version}/${path}?${search}`)\n  }\n\n  /**\n   * Wraps fetch with failover functionality\n   */\n  private async fetchWithFailover(\n    path: string,\n    params: ParamsRecord = {},\n    fetchOptions: Partial<RequestInit> = {},\n    retries = 0\n  ): Promise<Response> {\n    const url = this.getFullUrl(path, { ...params })\n\n    return fetch(url.toString(), fetchOptions).then((res) => {\n      if (!res.ok && this.backends.length > 1 && retries < this.requestRetries) {\n        if (this.verbose) {\n          console.warn(\n            `Fetch failed against ${url}. Status: ${res.status}. Retrying against next backend.\\nDetails:`,\n            res\n          )\n        }\n        this.useNextBackend()\n        return this.fetchWithFailover(path, params, fetchOptions, retries + 1)\n      }\n\n      return res\n    })\n  }\n  //#endregion\n\n  //#region API\n  //#region Tags\n  /**\n   * Retrieves tags given a searchTerm\n   */\n  private async fetchTags(params: api.params.Tags): Promise<api.responses.Tags> {\n    console.log(params)\n\n    const baseUrl = 'https://api.rule34.xxx/autocomplete.php?q='\n    const name = params.name?.replaceAll(' ', '_')\n    const fetched = await fetch(`${baseUrl}${name}`)\n\n    if (fetched.ok) {\n      const json = await fetched.json()\n      if (Array.isArray(json)) {\n        if (json.length === 0) {\n          throw new Error('No tags found')\n        } else {\n          return json.map((t) => ({\n            name: t.value,\n            count: Number(t.label.substring(t.label.lastIndexOf('(') + 1, t.label.length - 1)),\n            types: ['ambiguous'],\n          }))\n        }\n      } else if (json.message) {\n        return json\n      } else {\n        return { message: 'Invalid tag suggestions received', results: 0 }\n      }\n    } else {\n      return { message: 'Failed to load suggestions', results: 0 }\n    }\n  }\n\n  async getTags(params: api.params.Tags) {\n    try {\n      const result = await this.fetchTags(params)\n\n      if (isSuggestionError(result)) {\n        return result\n      }\n\n      let tags = result as AnyTag[]\n\n      const name = params.name\n\n      if (params.supertags && name) {\n        try {\n          const sanitzedName = name.replaceAll('*', '').toLowerCase()\n          const supertags = await getSupertags()\n          if (supertags) {\n            const matchingSupertags = Object.entries(supertags)\n              .filter(([key, _]) => key.toLowerCase().includes(sanitzedName))\n              .map(([name, details]) => ({\n                name,\n                ...details,\n              }))\n            tags = [...matchingSupertags, ...tags]\n          }\n        } catch {\n          // do nothing as supertags are only for registered users.\n        }\n      }\n\n      return tags\n    } catch (err) {\n      console.warn('Failed to get tags:', err)\n      return []\n    }\n  }\n  //#endregion\n\n  //#region Posts\n  getPostsUrl(pageNumber: number, limit: number, serializedTags: string) {\n    const url = `https://rule34-api.netlify.app/posts?limit=${limit.toString()}&pid=${pageNumber}`\n    return serializedTags === '' ? url : `${url}&tags=${serializedTags}`\n  }\n\n  getCountUrl(serializedTags: string) {\n    const url = `https://rule34-api.netlify.app/count`\n    return serializedTags === '' ? url : `${url}?tags=${serializedTags}`\n  }\n\n  /**\n   * This function can be used to retrieve a number of posts from the backend.\n   */\n  async getPosts(params: api.params.Posts) {\n    try {\n      let paramsInternal = {\n        limit: params.limit ?? this.postLimit,\n        pid: params.page ?? 0,\n        tags: '',\n      }\n\n      if (params.tags) paramsInternal.tags += serializeAllTags(params.tags)\n      if (params.score) paramsInternal.tags += `+score:${params.score}`\n      if (params.sort && params.sort !== 'date:desc') paramsInternal.tags += `+sort:${params.sort}`\n\n      const postsResponse = await fetch(this.getPostsUrl(paramsInternal.pid, paramsInternal.limit, paramsInternal.tags))\n      const countResponse = await fetch(this.getCountUrl(paramsInternal.tags))\n\n      const countText = await countResponse.text()\n      const countParser = new DOMParser()\n      const countXml = countParser.parseFromString(countText, 'text/xml')\n      const count = Number(countXml.getElementsByTagName('posts')[0].getAttribute('count'))\n\n\n      let posts = []\n\n      try {\n        let data = await postsResponse.json();\n        data = data.filter((x: any) => x.change); // sometimes api returns placeholders that cause lots of null issues\n        posts = data.map(this.parsePost);\n      } catch (error) {\n        console.warn('Failed to get posts', error);\n        posts = [];\n      }\n\n      return { count, posts }\n    } catch (err) {\n      console.warn('Failed to get posts:', err)\n      return { count: 0, posts: [] }\n    }\n  }\n\n  parsePost(post: any): any {\n    const height = post.height;\n    const score = post.score;\n    const file_url = post.file_url;\n    const parent_id = post.parent_id;\n    const sample_url = post.sample_url;\n    const sample_width = post.sample_width;\n    const sample_height = post.sample_height;\n    const preview_url = post.preview_url;\n    const rating = post.rating;\n    const tags = post.tags;\n    const id = post.id;\n    const width = post.width;\n    const change = post.change;\n    const comment_count = post.comment_count;\n    const status = post.status;\n    const source = post.source;\n\n    return {\n      preview_url,\n      sample_url,\n      file_url,\n      height: Number(height),\n      id: Number(id),\n      change: Number(change),\n      has_comments: Boolean(Number(comment_count) > 0),\n      parent_id: parent_id ? Number(parent_id) : null,\n      rating,\n      sample_height: Number(sample_height),\n      sample_width: Number(sample_width),\n      score: Number(score),\n      source,\n      status,\n      tags: tags.split(' ').filter((tag: any, index: any, array: any) => tag !== '' && array.indexOf(tag) === index),\n      width: Number(width),\n      comments_url: '',\n      creator_url: '',\n      type:\n        file_url.endsWith('.webm') || file_url.endsWith('.mp4') ? 'video' : file_url.includes('.gif') ? 'gif' : 'image',\n    }\n  }\n  //#endregion\n\n  //#region Aliases\n  /**\n   * Returns all aliases for a given tag\n   */\n  async getAliases(params: api.params.Aliases) {\n    try {\n      const aliases: AliasTag[] = await (await this.fetchWithFailover('alias/' + params.name)).json()\n\n      return aliases\n    } catch (err) {\n      console.warn('Failed to get aliases:', err)\n      return []\n    }\n  }\n  //#endregion\n\n  //#region Comments\n  /**\n   * Returns all comments for a given post.\n   */\n  async getComments(params: api.params.Comments): Promise<api.responses.Comments> {\n    try {\n      // This does not use my api but it is included here for simplicity.\n      // Therefore, no failover etc.\n      const response = await fetch(params.commentsUrl)\n      const text = await response.text()\n      const parser = new DOMParser()\n      const xml = parser.parseFromString(text, 'text/xml')\n\n      const comments: Comment[] = []\n      for (const comment of xml.getElementsByTagName('comment')) {\n        const newComment = this.parseComment(comment.attributes)\n        comments.push(newComment)\n      }\n\n      return comments\n    } catch (err) {\n      console.warn('Failed to get comments:', err)\n      return []\n    }\n  }\n\n  parseComment = (comment: NamedNodeMap): Comment => {\n    let result = {} as Record<string, any>\n\n    for (const attr of comment) {\n      result[attr.name] = attr.value\n    }\n    return result as Comment\n  }\n  //#endregion\n\n  //#region Artists\n  async getArtist(params: api.params.Artist) {\n    try {\n      const artist: Artist = await (await this.fetchWithFailover('artist', params)).json()\n\n      return artist\n    } catch (err) {\n      console.warn('Failed to get aliases:', err)\n      return undefined\n    }\n  }\n  //#endregion\n  //#endregion\n}\n","import { applyMiddleware } from 'redux'\nimport analytics from './analytics'\nimport persistence from './persistence'\nimport requests from './requests'\nimport { composeWithDevTools } from 'redux-devtools-extension'\n\nconst middleware = composeWithDevTools(applyMiddleware(analytics, requests, persistence))\n\nexport default middleware\n","export const migrations = {\n  // Delete reader state\n  278: (state: any) => {\n    return {\n      ...state,\n      reader: undefined,\n    }\n  },\n  // Add autoscroll delay\n  279: (state: any) => {\n    return {\n      ...state,\n      preferences: {\n        ...state.preferences,\n        autoscrollDelay: 10,\n      },\n    }\n  },\n  // Removed electric theme\n  285: (state: any) => {\n    if (state.preferences.themeId === 'electric') {\n      return {\n        ...state,\n        preferences: {\n          ...state.preferences,\n          themeId: 'deepsea',\n        },\n      }\n    } else {\n      return state\n    }\n  },\n  288: (state: any) => {\n    return {\n      ...state,\n      preferences: {\n        ...state.preferences,\n        showPostDetails: true,\n      },\n    }\n  },\n  289: (state: any) => {\n    return {\n      ...state,\n      preferences: {\n        ...state.preferences,\n        backends: ['https://r34-json.herokuapp.com', 'https://r34-api-clone.herokuapp.com'],\n      },\n    }\n  },\n  301: (state: any) => {\n    return {\n      ...state,\n      preferences: {\n        ...state.preferences,\n        backends: ['https://json-api.onrender.com'],\n      },\n    }\n  },\n}\n","import produce from 'immer'\nimport { Comment, Post } from 'r34-types'\nimport { SET_POSTS, ADD_POSTS, SET_COMMENTS, AppAction } from '../actions'\n\nexport interface ResultsState {\n  posts: Post[]\n  pageNumber: number\n  count: number\n  updated: number\n}\n\nconst initialResultsState: ResultsState = {\n  posts: [],\n  pageNumber: 0,\n  count: 0,\n  updated: 0,\n}\n\nconst addPosts = (state: ResultsState, posts: Post[]) =>\n  produce(state, (draft) => {\n    draft.posts = [...state.posts, ...posts]\n    draft.pageNumber = state.pageNumber + 1\n    draft.updated = new Date().getTime()\n  })\n\nconst setPosts = (state: ResultsState, posts: Post[], postCount: number, pageNumber: number = 0) =>\n  produce(state, (draft) => {\n    draft.posts = posts\n    draft.count = postCount\n    draft.pageNumber = pageNumber\n    draft.updated = new Date().getTime()\n  })\n\nconst setComments = (state: ResultsState, postId: number, comments: Comment[]) =>\n  produce(state, (draft) => {\n    const postIndex = state.posts.findIndex((p) => p.id === postId)\n    if (postIndex >= 0) {\n      draft.posts[postIndex].comments = comments\n    }\n  })\n\nconst results = (state: ResultsState = initialResultsState, action: AppAction): ResultsState => {\n  switch (action.type) {\n    case ADD_POSTS:\n      return addPosts(state, action.posts)\n    case SET_POSTS:\n      return setPosts(state, action.posts, action.count, action.pageNumber)\n    case SET_COMMENTS:\n      return setComments(state, action.postId, action.comments)\n    default:\n      return state\n  }\n}\n\nexport default results\n","import produce from 'immer'\nimport { AliasTag, AnyBiasedTag } from 'r34-types'\nimport { ADD_TAG, AppAction, REMOVE_TAG, ADD_ALIASES } from '../actions'\n\nexport interface TagsState {\n  active: Record<string, AnyBiasedTag>\n  aliases: Record<string, AliasTag[]>\n}\n\nconst initialTagsState: TagsState = {\n  active: {},\n  aliases: {},\n}\n\nconst addTag = (state: TagsState, newTag: AnyBiasedTag) =>\n  produce(state, (draft) => {\n    draft.active[newTag.name] = { ...state.active[newTag.name], ...newTag }\n  })\n\nconst addAliases = (state: TagsState, aliases: AliasTag[], forTag: string) =>\n  produce(state, (draft) => {\n    draft.aliases[forTag] = aliases\n  })\n\nconst removeTag = (state: TagsState, tagName: string) =>\n  produce(state, (draft) => {\n    delete draft.active[tagName]\n    delete draft.aliases[tagName]\n  })\n\nconst tags = (state: TagsState = initialTagsState, action: AppAction): TagsState => {\n  switch (action.type) {\n    case ADD_TAG:\n      return addTag(state, action.tag)\n    case REMOVE_TAG:\n      return removeTag(state, action.tagName)\n    case ADD_ALIASES:\n      return addAliases(state, action.aliases, action.forTag)\n    default:\n      return state\n  }\n}\n\nexport default tags\n","import produce from 'immer'\nimport { ENTER_FULLSCREEN, EXIT_FULLSCREEN, SET_FULLSCREEN_POST, AppAction, SCROLL_TO_POST } from '../actions'\n\nexport interface FullscreenState {\n  isEnabled: boolean\n  currentIndex: number\n  scrollIndex: number | null\n}\n\nconst initialFullscreenState: FullscreenState = {\n  isEnabled: false,\n  currentIndex: 0,\n  scrollIndex: null,\n}\n\nconst enterFullscreen = (state: FullscreenState, index: number) =>\n  produce(state, (draft) => {\n    draft.isEnabled = true\n    draft.currentIndex = index\n  })\n\nconst exitFullscreen = (state: FullscreenState) =>\n  produce(state, (draft) => {\n    draft.isEnabled = false\n  })\n\nconst setIndex = (state: FullscreenState, index: number) =>\n  produce(state, (draft) => {\n    draft.currentIndex = index\n  })\n\nconst setScrollIndex = (state: FullscreenState, index: number) =>\n  produce(state, (draft) => {\n    draft.scrollIndex = index\n  })\n\nexport const fullscreen = (state: FullscreenState = initialFullscreenState, action: AppAction): FullscreenState => {\n  switch (action.type) {\n    case ENTER_FULLSCREEN:\n      return enterFullscreen(state, action.postId)\n    case SET_FULLSCREEN_POST:\n      return setIndex(state, action.index)\n    case EXIT_FULLSCREEN:\n      return exitFullscreen(state)\n    case SCROLL_TO_POST:\n      return setScrollIndex(state, action.index)\n    default:\n      return state\n  }\n}\n","import produce from 'immer'\nimport { AppAction, LIKE_POST } from '../actions'\n\n/**\n * Key is postId, Value is time of like\n */\nexport type LikesState = Record<number, number>\n\nconst initialLikesState: LikesState = {}\n\nconst likePost = (state: LikesState, postId: number) =>\n  produce(state, (draft) => {\n    if (!(postId in state)) {\n      draft[postId] = Date.now()\n    }\n\n    // NOTE: Might need to introduce a cap here...\n    // Like 1000 likes max, delete oldest when more are added?\n  })\n\nconst likes = (state: LikesState = initialLikesState, action: AppAction): LikesState => {\n  switch (action.type) {\n    case LIKE_POST:\n      return likePost(state, action.postId)\n    default:\n      return state\n  }\n}\n\nexport default likes\n","import produce from 'immer'\nimport { ModalId } from '../../data/types'\nimport { AppAction, CLOSE_MODAL, OPEN_MODAL } from '../actions'\n\nexport interface ModalsState {\n  openModal: ModalId | null\n}\n\nconst initialModalsState: ModalsState = {\n  openModal: null,\n}\n\nconst setOpenModal = (state: ModalsState, modalId: ModalId | null) =>\n  produce(state, (draft) => {\n    draft.openModal = modalId\n  })\n\nconst modals = (state: ModalsState = initialModalsState, action: AppAction): ModalsState => {\n  switch (action.type) {\n    case OPEN_MODAL:\n      return setOpenModal(state, action.modalId)\n    case CLOSE_MODAL:\n      return setOpenModal(state, null)\n    default:\n      return state\n  }\n}\n\nexport default modals\n","import produce from 'immer'\nimport * as r34 from 'r34-types'\nimport { SuggestionsError } from '../../data/types'\nimport { AppAction, SET_SUGGESTIONS, SET_SUGGESTIONS_ERROR, SET_SUGGESTIONS_MODIFIER } from '../actions'\n\nexport interface SuggestionsState {\n  entries: r34.AnyTag[]\n  error: SuggestionsError | null\n  modifier: r34.TagModifier\n}\n\nconst initialSuggestionsState: SuggestionsState = {\n  entries: [],\n  error: null,\n  modifier: '+',\n}\n\nconst setSuggestions = (state: SuggestionsState, suggestions: r34.AnyTag[]) =>\n  produce(state, (draft) => {\n    draft.entries = suggestions\n    draft.error = null\n  })\n\nconst setError = (state: SuggestionsState, error: SuggestionsError) =>\n  produce(state, (draft) => {\n    draft.entries = []\n    draft.error = error\n  })\n\nconst setModifier = (state: SuggestionsState, modifier: r34.TagModifier) =>\n  produce(state, (draft) => {\n    draft.modifier = modifier\n  })\n\nconst suggestions = (state: SuggestionsState = initialSuggestionsState, action: AppAction): SuggestionsState => {\n  switch (action.type) {\n    case SET_SUGGESTIONS:\n      return setSuggestions(state, action.suggestions)\n    case SET_SUGGESTIONS_ERROR:\n      return setError(state, action.error)\n    case SET_SUGGESTIONS_MODIFIER:\n      return setModifier(state, action.modifier)\n    default:\n      return state\n  }\n}\n\nexport default suggestions\n","import { combineReducers } from 'redux'\nimport preferences from './preferences'\nimport results from './results'\nimport tags from './tags'\nimport { fullscreen } from './fullscreen'\nimport likes from './likes'\nimport modals from './modals'\nimport suggestions from './suggestions'\n\nexport default combineReducers({ tags, results, preferences, fullscreen, likes, suggestions, modals })\n","import { createStore } from 'redux'\nimport { createMigrate, persistReducer, persistStore } from 'redux-persist'\nimport storage from 'redux-persist/lib/storage'\nimport { getVersion, versionToNumber } from '../data/utils'\nimport middleware from './middleware'\nimport { migrations } from './migrations'\nimport rootReducer from './reducers'\n\nconst version = getVersion()\n\nconst persistConfig = {\n  key: 'appstate',\n  version: versionToNumber(version),\n  storage,\n  migrate: createMigrate(migrations),\n}\n\nconst persistedReducer = persistReducer(persistConfig, rootReducer)\n\nexport const store = createStore(persistedReducer, middleware)\n\nexport const persistor = persistStore(store)\n","import React, { Suspense } from 'react'\nimport { Helmet } from 'react-helmet'\nimport { Provider, useSelector } from 'react-redux'\nimport { HashRouter, Route, Switch } from 'react-router-dom'\nimport { PersistGate } from 'redux-persist/integration/react'\nimport { ThemeProvider } from 'styled-components'\nimport ErrorBoundary from './components/features/ErrorBoundary'\nimport GlobalKeybindings from './components/features/GlobalKeybindings'\nimport ErrorScreen from './components/pages/ErrorScreen'\nimport LoadingScreen from './components/pages/LoadingScreen'\nimport CellularWarningModal from './components/widgets/CellularWarningModal'\nimport CookieConfirmation from './components/widgets/CookieConfirmation'\nimport SupertagModal from './components/widgets/SupertagModal'\nimport { RouteName } from './data/types'\nimport './client/firebase' // init firebase immediately\nimport GlobalStyles from './GlobalStyles'\nimport {\n  selectActiveThemeId,\n  selectCellularWarningModalOpen,\n  selectCookies,\n  selectSupertagModalOpen,\n} from './redux/selectors'\nimport { persistor, store } from './redux/store'\nimport { themes, defaultThemeId } from 'r34-branding'\n\nconst Search = React.lazy(() => import('./components/pages/Search'))\n\nconst loadingScreen = <LoadingScreen />\n\nexport default function App() {\n  return (\n    <ErrorBoundary fallback={<ErrorScreen />}>\n      <Provider store={store}>\n        <PersistGate loading={loadingScreen} persistor={persistor}>\n          <ThemedApp />\n        </PersistGate>\n      </Provider>\n    </ErrorBoundary>\n  )\n}\n\nfunction ThemedApp() {\n  const cookies = useSelector(selectCookies)\n  const isCellularWarningModalOpen = useSelector(selectCellularWarningModalOpen)\n  const isSupertagModalOpen = useSelector(selectSupertagModalOpen)\n  const themeId = useSelector(selectActiveThemeId)\n  const theme = themes[themeId || defaultThemeId]\n\n  // useLoadPreferences()\n\n  return (\n    <ThemeProvider theme={theme}>\n      <GlobalStyles />\n      <GlobalKeybindings />\n      <Helmet>\n        <meta name='theme-color' content={theme.colors.layerBgSolid} />\n      </Helmet>\n      <HashRouter>\n        <Suspense fallback={loadingScreen}>\n          <Switch>\n            <Route path={RouteName.SEARCH} component={Search} />\n          </Switch>\n        </Suspense>\n\n        {isSupertagModalOpen && <SupertagModal />}\n        {isCellularWarningModalOpen && <CellularWarningModal />}\n        {!cookies && <CookieConfirmation />}\n      </HashRouter>\n    </ThemeProvider>\n  )\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://cra.link/PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n)\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void\n  onUpdate?: (registration: ServiceWorkerRegistration) => void\n}\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href)\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://cra.link/PWA'\n          )\n        })\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n        if (installingWorker == null) {\n          return\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://cra.link/PWA.'\n              )\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration)\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.')\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration)\n              }\n            }\n          }\n        }\n      }\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error)\n    })\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type')\n      if (response.status === 404 || (contentType != null && contentType.indexOf('javascript') === -1)) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload()\n          })\n        })\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log('No internet connection found. App is running in offline mode.')\n    })\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister()\n      })\n      .catch((error) => {\n        console.error(error.message)\n      })\n  }\n}\n","// Polyfills\nimport 'whatwg-fetch'\n\nimport * as Sentry from '@sentry/react'\nimport { Offline } from '@sentry/integrations'\nimport ReactDOM from 'react-dom'\nimport App from './App'\nimport { getVersionString } from './data/utils'\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration'\n\nSentry.init({\n  dsn: 'https://1a2933d829da41fe84d4dab5fcc520ae@o955708.ingest.sentry.io/5905045',\n  integrations: [new Offline()],\n  tracesSampleRate: 0.1,\n  release: getVersionString(),\n  allowUrls: [/https:\\/\\/kurozenzen\\.github\\.io(.*)/, /https:\\/\\/r34-json\\.herokuapp\\.com(.*)/],\n  ignoreErrors: [\n    // Random plugins/extensions\n    'top.GLOBALS',\n    // See: http://blog.errorception.com/2012/03/tale-of-unfindable-js-error.html\n    'originalCreateNotification',\n    'canvas.contentDocument',\n    'MyApp_RemoveAllHighlights',\n    'http://tt.epicplay.com',\n    \"Can't find variable: ZiteReader\",\n    'jigsaw is not defined',\n    'ComboSearch is not defined',\n    'http://loading.retry.widdit.com/',\n    'atomicFindClose',\n  ],\n  denyUrls: [\n    // Chrome extensions\n    /extensions\\//i,\n    /^chrome:\\/\\//i,\n  ],\n  beforeBreadcrumb(breadcrumb, hint) {\n    try {\n      if (breadcrumb?.category?.startsWith('ui')) {\n        const target = hint?.event.target as HTMLElement\n        const tag = target.tagName.toLowerCase()\n        if (target.innerText) {\n          breadcrumb.message = `${tag}: ${target.innerText}`\n        } else if (target.id) {\n          breadcrumb.message = `${tag}: ${target.id}`\n        } else if (target.getAttribute('name')) {\n          breadcrumb.message = `${tag}: ${target.getAttribute('name')}`\n        } else if (target.title) {\n          breadcrumb.message = `${tag}: ${target.title}`\n        } else if (target.getAttribute('aria-label')) {\n          breadcrumb.message = `${tag}: ${target.getAttribute('aria-label')}`\n        } else if (target.getAttribute('data-name')) {\n          breadcrumb.message = `${tag}: ${target.getAttribute('data-name')}`\n        }\n      }\n    } catch (err) {\n      // fancy breadcrumbs are optional. So no error handling required.\n    }\n    return breadcrumb\n  },\n})\n\nReactDOM.render(\n  // <React.StrictMode>\n  <App />,\n  // </React.StrictMode>\n  document.getElementById('app-root')\n)\n\nserviceWorkerRegistration.register()\n"],"sourceRoot":""}