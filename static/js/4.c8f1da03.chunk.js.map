{"version":3,"sources":["components/layout/infinite/InfiniteColumn.tsx","styled/animations.tsx","components/designsystem/Slider.tsx","icons/PlayPauseIcon.tsx","components/player/ToggleFullscreenButton.tsx","components/player/LinkList.tsx","components/player/Overlay.tsx","components/player/ProgressBar.tsx","components/player/FullscreenProgressBar.tsx","components/designsystem/FlexVideo.tsx","components/player/media/StyledMedia.ts","components/player/media/Picture.tsx","hooks/useIsOnScreen.tsx","hooks/useIsScrolling.tsx","hooks/useAutoplay.tsx","components/player/media/Gif.tsx","components/player/media/Video.tsx","components/player/Media.tsx","hooks/useSources.tsx","components/post/source/FallbackSource.tsx","components/designsystem/ColoredIconLink.tsx","components/post/source/LinkSource.tsx","components/post/source/sourceUtils.ts","icons/PixivIcon.tsx","components/post/source/SpecialLinkSource.tsx","components/post/source/Source.tsx","components/post/details/AdditonalDetails.tsx","components/post/details/Comments.tsx","components/post/details/Metadata.tsx","components/post/details/Rating.tsx","components/post/details/Score.tsx","components/post/details/Details.tsx","components/post/Post.tsx","components/widgets/SearchButton.tsx","hooks/useConnectionState.tsx","components/designsystem/TitledSurface.tsx","components/designsystem/SubtleInput.tsx","components/widgets/RatedFilter.tsx","components/designsystem/Select.tsx","components/widgets/SortSelect.tsx","components/features/SearchEditor.tsx","hooks/useFirebaseAuthState.tsx","icons/R34Icon.tsx","components/widgets/OfflineIndicator.tsx","hooks/useOnlineChange.ts","components/features/Header.tsx","components/designsystem/C.tsx","components/widgets/RandomTip.tsx","components/widgets/UpdateHighlight.tsx","components/widgets/SearchPlaceholder.tsx","components/widgets/ResultsTitle.tsx","components/layout/LayoutHeader.tsx","components/widgets/ScrollToTopButton.tsx","components/layout/LayoutOutOfItems.tsx","components/layout/LayoutLoadingItem.tsx","components/designsystem/FlexColumn.tsx","components/designsystem/SmallInput.tsx","components/layout/pages/PageNavigation.tsx","components/layout/pages/PageLayout.tsx","components/pages/Search.tsx","hooks/useScrollUpBackNavigation.tsx","hooks/usePageTitle.tsx"],"names":["cache","CellMeasurerCache","fixedWidth","InifinteColumn","props","Header","items","LoadingItem","hasMoreRows","ItemComponent","loadMore","OutOfItems","isLoading","prependedRows","rowCount","length","isRowLoaded","useCallback","_ref","index","rowRenderer","_ref2","key","parent","style","_jsx","CellMeasurer","columnIndex","rowIndex","children","_ref3","measure","registerChild","virtualRef","onLoad","_objectSpread","console","warn","loadMoreRows","params","Promise","resolve","handleResize","size","clearAll","InfiniteLoader","_ref4","onRowsRendered","AutoSizer","onResize","disableHeight","_ref5","width","WindowScroller","_ref6","height","isScrolling","onChildScroll","scrollTop","List","autoHeight","onScroll","ref","deferredMeasurementCache","overscanRowCount","rowHeight","fadeOut","keyframes","_templateObject","_taggedTemplateLiteral","Slider","styled","input","$controls","$accent","theme","css","_templateObject4","_templateObject3","colors","layerBg","accentColor","backgroundColor2","trackStyle","commonStyle","_templateObject2","thumbStyle","MorphSvg","svg","ToggleButton","InvisButton","dropShadow","dimensions","bigSpacing","ToggleFullscreenButton","dispatch","useDispatch","history","useHistory","onFullscreenExit","React","event","stopPropagation","goBack","scrollToPost","onFullscreenEnter","setFullscreenPost","push","RouteName","STORIES","location","pathname","onClick","title","CloseIcon","color","ExpandIcon","Wrapper","div","flexRowWithGap","LinkButton","a","timings","transitionTime","DownloadButton","LinkList","fullSrc","handleDownload","download","_jsxs","href","target","rel","ExternalLinkIcon","DownloadIcon","isVisible","VideoProgressBar","isPaused","videoRef","className","onChange","onEnded","sliderRef","useRef","useTheme","handleChange","newValue","Number","value","handleClick","useEffect","addEventListener","removeEventListener","handle","step","current","currentTime","toString","chromePercentage","duration","backgroundImage","concat","requestAnimationFrame","cancelAnimationFrame","type","min","max","AutoProgressBar","onFinished","NO_OP","onBack","isActive","keybinds","ArrowRight","ArrowLeft","handler","pressed","preventDefault","document","mouseState","setMouseState","useState","setPost","newIndex","useSelector","selectAutoscrollDelay","listener","then","Date","getTime","renderFrame","now","_templateObject5","PlayButton","name","viewBox","xmlns","x","y","_templateObject6","LengthDisplay","span","_templateObject7","spacing","ForwardArea","_templateObject8","BackwardArea","_templateObject9","ImageOverlay","isFullscreen","_Fragment","GifOverlay","onTogglePaused","VideoOverlay","onSeek","handleSkipForward","e","handleSkipBackward","onDoubleClick","BackwardIcon","tabIndex","ForwardIcon","formatDuration","getOverlayContent","Overlay","setVisible","toggleVisible","FlexVideo","video","flexMedia","preserveAspectRatio","PostVideo","mediaStyle","PostImage","FlexImage","Picture","viewSrc","src","alt","loading","handlers","observer","IntersectionObserver","entries","forEach","entry","find","h","element","update","isIntersecting","threshold","timeoutId","isScrollingGlobal","observers","useAutoplay","shouldPlay","setShouldPlay","isOnScreen","setOnScreen","onIsOnScreenChange","observe","filter","unobserve","useIsOnScreen","useIsScrolling","setIsScrolling","undefined","clearTimeout","setTimeout","passive","Gif","thumbnailSrc","detailsVisible","overlayVisible","setOverlayVisible","playState","setPlayState","gifRef","setGifRef","prefAutoplay","selectAutoPlay","autoPlay","preload","selectPreloadGifs","usedSource","play","async","pause","togglePlay","Image","Video","setVideoRef","selectPreloadVideos","paused","err","message","includes","error","handleSeek","controls","loop","onLoadedMetadata","Media","sampleSrc","preview","loadOriginals","selectOriginals","useMemo","useSources","FallbackSource","FlexPair","SourceIcon","ColoredIconLink","DefaultLinkSource","formatSource","LinkIcon","extractFirstElement","split","sources","TwitterIcon","fill","d","PatreonIcon","path","startsWith","extractSecondElement","DeviantArtIcon","DiscordIcon","TumblrIcon","URL","hostname","SpecialLinkSource","Icon","Source","parseUrl","links","map","link","source","Object","keys","getTitle","AdditionalDetails","flexColumnWithGap","defaultSpacing","Username","p","Message","Faded","Centered","Comment","Comments","comments","comment","creator","body","Entry","Metadata","created_at","id","status","createdAt","CalendarIcon","formatDatetime","formatTime","CheckIcon","ImageIcon","fullnames","q","s","Rating","RatingIcon","text","toUpperCase","ScorePair","$liked","liked","Score","postId","selectLikedByPostId","likePost","HeartIcon","formatCount","boolToNumber","Bar","layer","borderRadius","Menu","MenuEntry","active","DetailsTagList","TagList","Details","modifier","useModifier","activeTab","setActiveTab","hasComments","rating","score","tags","change","selectPostById","tagsForRendering","listToMap","tag","types","showMetadata","selectShowMetadata","showComments","selectShowComments","checkIsActive","useCheckIsActive","toggleTag","useToggleTag","setTags","setComments","setMetadata","addTagWithModifier","addTag","detailed","onTagClick","getIsActive","onTagMenu","metadata","ItemWrapper","PositonWrapper","bodyWidth","PostWrapper","ZIndex","POST","OVERLAY","ListPost","sample_url","file_url","preview_url","has_comments","Post","memo","collapsed","toggleCollapsed","useToggle","showPostDetails","selectShowPostDetails","fetchComments","role","isUserNotified","SearchButton","search","useAction","getResults","connection","navigator","mozConnection","webkitConnection","connectionState","setConnectionState","useConnectionState","preloadVideos","autoplay","originals","openModal","ModalId","CELLULAR_WARNING","BlockButton","SearchIcon","PaddedTitle","Title","hugeSpacing","PaddedSurface","Surface","$compact","gap","TitledSurface","compact","SubtleInput","backgroundColor","fontSizes","content","RatedRow","RatedToggle","LabeledToggle","RatedFilter","rated","setRated","usePreference","ratedThreshold","setRatedThreshold","toggleRated","ratedThresholdInternal","setRatedThresholdInternal","onBlur","handleSubmit","blur","onToggle","onKeyDown","blockHeight","StyledSelect","select","defaultInput","Option","option","defaultBorder","defaultBlock","Select","options","optionKey","optionValue","SortRow","sortOptions","SortSelect","sort","setSort","handleSortChange","ConfigWrapper","section","flexColumn","centeredMaxWidth","SearchEditor","isSignedIn","authState","setAuthState","user","setUser","unsubscribe","firebase","auth","onAuthStateChanged","_unused","useFirebaseAuthState","activateTag","useActivateTag","htmlFor","TagSelector","onSubmit","showSupertags","ActiveTags","offerSupertags","R34Icon","transform","cx","cy","stroke","strokeWidth","strokeMiterlimit","strokeDasharray","strokeOpacity","r","fontStyle","fontWeight","fontSize","fontFamily","letterSpacing","wordSpacing","fillOpacity","fontVariant","fontStretch","OfflineIndicator","isOnline","setIsOnline","window","onLine","listenter","_options$onOnline","onOnline","call","_options$onOffline","onOffline","useOnlineChange","FailedIcon","negative","HeaderWrapper","header","layerBgSolid","TitleBar","DmcaLink","TestButton","styledComp","button","LoadSpan","subduedText","CenterArea","loadMs","setLoadMs","randDecimals","setRandDecimals","randSetRef","genRand3","Math","floor","random","nav","performance","getEntriesByType","n","end","loadEventEnd","responseEnd","domComplete","responseStart","startTime","val","isNaN","fractional","finalVal","isInteger","t","timing","navigationStart","highResNow","timeOrigin","intLoad","pnow","script","createElement","appendChild","debugScript","removeChild","defer","setAttribute","pm","popMagic","orig","isValidUserEvent","methods","default","isTrusted","screenX","screenY","BigTitle","intPart","firstDecimal","tail","C","TipWrapper","tips","ArrowDown","getRandomTip","randomBelow","RandomTip","tip","setTip","nextTip","UpdateHighlight","getMonth","getDate","WrenchIcon","SmallTitle","Placeholder","SearchPlaceholder","ClickableTitle","ResultsTitle","fullNumber","toggleFullNumber","count","selectCount","formattedCount","toLocaleString","img","Hero","LayoutHeader","ScrollToTopButton","useLocation","NavigateBackButton","ScrollUpButton","scrollUp","scrollTo","ArrowUp","Link","to","SEARCH","Div","StyledSurface","StyledImage","LayoutOutOfItems","aliases","selectAliasesAsList","aliasesForRendering","reduce","result","alias","outOfResultsPicture","HorizontalLine","LayoutLoadingItem","LoadingIcon","FlexColumn","StyledInput","PageRow","gridWithGap","Left","Right","PageNumber","PrimaryButton","CurrentNumber","internalValue","setInternalValue","blurOnEnter","PageNavigation","currentPage","loadPage","lastPage","selectLastPage","loadSpecificPage","newPage","loadFirst","loadLast","loadPrevious","loadNext","PageLayoutFlexColumn","PageLayout","scrollAndLoadPage","getElementsByClassName","scrollIntoView","item","Search","setLoading","activeTags","selectActiveTags","lastUpdated","setLastUpdated","updated","selectUpdated","posts","selectPosts","hasMorePosts","selectHasMoreResults","resultsLayout","selectResultsLayout","pageSize","selectPageSize","pageNumber","selectPageNumber","getMoreResults","hash","once","useScrollUpBackNavigation","makeTitleFromTags","names","pretty","decodeURIComponent","replace","join","qIndex","indexOf","tagsParam","URLSearchParams","slice","get","Boolean","isNegative","raw","values","mod","encodeURIComponent","serializeTagname","encoded","replaceState","hasMorePages"],"mappings":"+MAYA,MAAMA,EAAQ,IAAIC,IAAkB,CAClCC,YAAY,IAcC,SAASC,EAAkBC,GACxC,MAAM,OAAEC,EAAM,MAAEC,EAAQ,GAAE,YAAEC,EAAW,YAAEC,EAAW,cAAEC,EAAa,SAAEC,EAAQ,WAAEC,EAAU,UAAEC,GAAcR,EAEnGS,EAAgBR,EAAS,EAAI,EAE7BS,EAAWR,EAAMS,OAASF,EADZ,EAGdG,EAAcC,sBAClBC,IAAA,IAAC,MAAEC,GAA0BD,EAAA,OAAKC,EAAQN,EAAgBP,EAAMS,QAAUP,EAAc,EAAI,IAC5F,CAACA,EAAaF,EAAMS,OAAQF,IAGxBO,EAAcH,sBAClBI,IAA0F,IAAzF,MAAEF,EAAK,IAAEG,EAAG,OAAEC,EAAM,MAAEC,GAA6DH,EAClF,OACEI,cAACC,IAAY,CAAC1B,MAAOA,EAAO2B,YAAa,EAAaC,SAAUT,EAAOI,OAAQA,EAAOM,SACnFC,IAAiC,IAAhC,QAAEC,EAAO,cAAEC,GAAeF,EAE1B,OAAIzB,GAAUc,EAAQN,EACbY,cAACpB,EAAM,CAACmB,MAAOA,EAAOS,WAAYD,EAAeE,OAAQH,IAI9DZ,EAAQN,EAAgBP,EAAMS,OAE9BU,cAAChB,EAAa0B,YAAA,CACZX,MAAOA,EACPS,WAAYD,EACZE,OAAQH,EACRZ,MAAOA,EAAQN,GACXP,EAAMa,EAAQN,KAMpBM,EAAQN,EAAgBP,EAAMS,OAhCxB,EAiCDP,GAAeI,EACpBa,cAAClB,EAAW,CAACiB,MAAOA,EAAOS,WAAYD,EAAeE,OAAQH,IAC5DpB,GAAcL,EAAMS,OAAS,EAC/BU,cAACd,EAAU,CAACa,MAAOA,EAAOS,WAAYD,EAAeE,OAAQH,IAE7DN,cAAA,WAIJW,QAAQC,KAAK,0CAA2ClB,GACjD,QAhCsCG,IAqCrD,CAACjB,EAAQQ,EAAeP,EAAOG,EAAeD,EAAaI,EAAWL,EAAaI,IAG/E2B,EAAerB,sBAClBsB,KACM3B,GAAaJ,GAChBE,IAGK8B,QAAQC,WAEjB,CAACjC,EAAaI,EAAWF,IAGrBgC,EAAezB,sBAAa0B,IAChC3C,EAAM4C,YACL,IAEH,OACEnB,cAACoB,IAAc,CAAC7B,YAAaA,EAAasB,aAAcA,EAAcxB,SAAUA,EAASe,SACtFiB,IAAwC,IAAvC,eAAEC,EAAc,cAAEf,GAAec,EACjC,OACErB,cAACuB,IAAS,CAACC,SAAUP,EAAcQ,eAAa,EAAArB,SAC7CsB,IAAgB,IAAf,MAAEC,GAAOD,EACT,OACE1B,cAAC4B,IAAc,CAAAxB,SACZyB,IAAwD,IAAvD,OAAEC,EAAM,YAAEC,EAAW,cAAEC,EAAa,UAAEC,GAAWJ,EACjD,OACE7B,cAACkC,IAAI,CACHC,YAAU,EACVL,OAAQA,EACRC,YAAaA,EACbK,SAAUJ,EACVC,UAAWA,EACXI,IAAK9B,EACLe,eAAgBA,EAChB3B,YAAaA,EACb2C,yBAA0B/D,EAC1BgE,iBAAkB,GAClBlD,SAAUR,EAAMS,OAASF,EAvF3B,EAwFEoD,UAAWjE,EAAMiE,UACjBb,MAAOA,YAY/B,C,mEClIO,MAAMc,EAAUC,YAASC,MAAAC,YAAA,0E,oBC2CzB,MAAMC,EAASC,IAAOC,MAC3B1C,IAAA,IAAC,UAAE2C,EAAS,QAAEC,EAAO,MAAEC,GAAsE7C,EAAA,OAAK8C,YAAGC,MAAAR,YAAA,6BAnBvG,SAAmBhD,GAAiE,IAAhE,QAAEqD,EAAO,MAAEC,GAAkDtD,EAC/E,OAAOuD,YAAGE,MAAAT,YAAA,qQAGOjE,GAAUA,EAAMuE,MAAMI,OAAOC,QAKtBN,EAAUC,EAAMI,OAAOE,YAAcN,EAAMI,OAAOG,iBAIlDR,EAAUC,EAAMI,OAAOE,YAAcN,EAAMI,OAAOG,iBAG5E,CAIMC,CAAW,CAAET,UAASC,UA7C5B,SAAmBzD,GAAqE,IAApE,UAAEuD,EAAS,MAAEE,GAAoDzD,EACnF,MAAMkE,EAAcR,YAAGR,MAAAC,YAAA,uHAIPI,EAAYE,EAAMI,OAAOG,iBAAmB,eAI5D,OAAON,YAAGS,MAAAhB,YAAA,oLAGJe,EAIAA,EAIAA,EAGR,CAuBME,CAAW,CAAEb,YAAWE,a,MCvC9B,MAAMY,EAAWhB,IAAOiB,IAAGpB,MAAAC,YAAA,gb,sCCC3B,MAAMoB,EAAelB,YAAOmB,IAAPnB,CACnBrD,IAAA,IAAC,MAAEyD,GAAOzD,EAAA,OAAK0D,YAAGR,MAAAC,YAAA,oHAGdsB,IACShB,EAAMiB,WAAWC,cASjB,SAASC,EAAuB1F,GAC7C,MAAM,MAAEe,GAAUf,EAEZ2F,EAAWC,cACXC,EAAUC,cAEVC,EAAmBC,IAAMnF,YAC5BoF,IACCA,EAAMC,kBACNL,EAAQM,SACRR,EAASS,YAAarF,KAExB,CAAC4E,EAAUE,EAAS9E,IAGhBsF,EAAoBL,IAAMnF,YAC7BoF,IACCA,EAAMC,kBACNP,EAASW,YAAkBvF,IAC3B8E,EAAQU,KAAKC,IAAUC,UAEzB,CAACd,EAAUE,EAAS9E,IAGtB,OAAO8E,EAAQa,SAASC,WAAaH,IAAUC,QAC7CpF,cAACgE,EAAY,CAACuB,QAASb,EAAkB,aAAW,kBAAkBc,MAAM,kBAAiBpF,SAC3FJ,cAACyF,IAAS,CAACC,MAAM,YAGnB1F,cAACgE,EAAY,CAACuB,QAASP,EAAmB,aAAW,mBAAmBQ,MAAM,mBAAkBpF,SAC9FJ,cAAC2F,IAAU,CAACD,MAAM,WAGxB,C,0BCjDA,MAAME,EAAU9C,IAAO+C,IAAGlD,MAAAC,YAAA,+FAEtBkD,KAKEC,EAAajD,IAAOkD,EACxBvG,IAAA,IAAC,MAAEyD,GAAOzD,EAAA,OAAK0D,YAAGS,MAAAhB,YAAA,sHACLM,EAAMiB,WAAWC,WAE1BF,YAAW,CAAEhB,UAGKA,EAAM+C,QAAQC,kBAKhCC,EAAiBrD,YAAOmB,IAAPnB,CAAmBO,MAAAT,YAAA,8BAQ3B,SAASwD,EAASzH,GAC/B,MAAM,QAAE0H,GAAY1H,EAEd2H,EAAiB3B,IAAMnF,YAC1BoF,IACCA,EAAMC,kBACN0B,YAASF,IAEX,CAACA,IAGH,OACEG,eAACZ,EAAO,CAAAxF,SAAA,CACNJ,cAAC+F,EAAU,CAACU,KAAMJ,EAASK,OAAO,SAASC,IAAI,sBAAsB,aAAW,kBAAkBnB,MAAOa,EAAQjG,SAC/GJ,cAAC4G,IAAgB,CAAClB,MAAM,QAAQF,MAAM,4BAGxCxF,cAACmG,EAAc,CAAC,aAAW,iBAAiBZ,QAASe,EAAgBd,MAAOa,EAAQjG,SAClFJ,cAAC6G,IAAY,CAACnB,MAAM,cAI5B,C,sBCpCA,MAAME,GAAU9C,IAAO+C,IAAGxC,MAAAT,YAAA,0HAT1B,SAA0BnD,GAAyC,IAAxC,UAAEqH,GAAmCrH,EAC9D,OAAOqH,EACH3D,YAAGR,MAAAC,YAAA,QACHO,YAAGS,MAAAhB,YAAA,0EAEYH,EAErB,GAUMsE,GAAmBjE,YCjBGnE,IAC1B,MAAM,SAAEqI,EAAQ,SAAEC,EAAQ,UAAEC,EAAS,SAAEC,EAAQ,QAAEC,GAAYzI,EAEvD0I,EAAY1C,IAAM2C,OAAyB,MAE3CpE,EAAQqE,cAERC,EAAqDhI,sBACxDoF,IACC,MAAM6C,EAAWC,OAAO9C,EAAM8B,OAAOiB,OACrCR,EAASM,IAEX,CAACN,IAGGS,EAAiCpI,sBAAaoF,IAClDA,EAAMC,mBACL,IAgCH,OA9BAF,IAAMkD,UAAU,KACd,GAAIT,GAAWH,EAGb,OAFAA,EAASa,iBAAiB,QAASV,GAE5B,IAAMH,EAASc,oBAAoB,QAASX,KAIvDzC,IAAMkD,UAAU,KACd,IAAKb,EAAU,CACb,IAAIgB,EAEJ,MAAMC,EAAOA,KACX,GAAa,OAATZ,QAAS,IAATA,KAAWa,SAAWjB,EAAU,CAClCI,EAAUa,QAAQP,MAAQV,EAASkB,YAAYC,WAC/C,MAAMC,EAAoBpB,EAASkB,YAAclB,EAASqB,SAAY,IACtEjB,EAAUa,QAAQnI,MAAMwI,gBAAe,0BAAAC,OAA6BtF,EAAMI,OAAOE,YAAW,KAAAgF,OAAIH,EAAgB,mBAAAG,OAAkBH,EAAgB,KACpJ,CAEAL,EAASS,sBAAsBR,IAKjC,OAFAD,EAASS,sBAAsBR,GAExB,KACLS,qBAAqBV,GAEzB,GACC,CAAChB,EAAU9D,EAAMI,OAAOE,YAAaN,EAAMI,OAAOG,iBAAkBwD,IAGrEjH,cAAC6C,EAAM,CACLR,IAAKgF,EACLsB,KAAK,QACLV,KAAM,EACNW,IAAK,EACLC,KAAa,OAAR5B,QAAQ,IAARA,OAAQ,EAARA,EAAUqB,WAAY,EAC3BnB,SAAUK,EACVN,UAAWA,EACX3B,QAASqC,EACT5E,WAAS,EACTC,SAAO,KD3CYH,CACvBlD,IAAA,IAAC,MAAEsD,GAAOtD,EAAA,OAAKuD,YAAGC,MAAAR,YAAA,sDAENM,EAAMiB,WAAWC,cAIzB0E,GAAkBhG,YEpBT,SAA+BnE,GAC5C,MAAM,WAAEoK,EAAaC,IAAK,OAAEC,EAASD,IAAK,SAAEE,GAAavK,EAEnDwK,EAAuC,CAC3C,WAAeC,IAAML,IACrB,UAAcM,IAAMJ,KAGtBtE,IAAMkD,UAAU,KACd,MAAMyB,EAAW1E,IACf,MAAM2E,EAAO,GAAAf,OAAM5D,EAAM/E,KACrB0J,KAAWJ,IACbvE,EAAM4E,iBACN5E,EAAMC,kBACNsE,EAASI,OAIb,OADAE,SAAS3B,iBAAiB,UAAWwB,GAC9B,IAAMG,SAAS1B,oBAAoB,UAAWuB,KAGvD,MAAMhF,EAAWC,eACVmF,EAAYC,GAAiBhF,IAAMiF,UAAS,GAC7CC,EAAUlF,IAAMnF,YAAasK,GAAaxF,EAASW,YAAkB6E,IAAY,CAACxF,IAClFgE,EAAW,IAAOyB,YAAYC,KAC9B3H,EAAMsC,IAAM2C,OAAyB,MA0D3C,OAxDA3C,IAAMkD,UAAU,KACd,MAAMoC,EAAWA,IAAMN,GAAc,GAIrC,OAHAF,SAAS3B,iBAAiB,YAAamC,GACvCR,SAAS3B,iBAAiB,aAAcmC,GAEjC,KACLR,SAAS1B,oBAAoB,YAAakC,GAC1CR,SAAS1B,oBAAoB,aAAckC,MAI/CtF,IAAMkD,UAAU,KACd,MAAMoC,EAAWA,IAAMN,GAAc,GAIrC,OAHAF,SAAS3B,iBAAiB,UAAWmC,GACrCR,SAAS3B,iBAAiB,WAAYmC,GAE/B,KACLR,SAAS1B,oBAAoB,UAAWkC,GACxCR,SAAS1B,oBAAoB,WAAYkC,MAI7CtF,IAAMkD,UAAU,KACd,IAAK6B,GAAcR,EAAU,CAC3B,IAAIlB,EACAkC,GAAO,IAAIC,MAAOC,UAEtB,MAAMC,EAAcA,KAClB,GAAIhI,EAAI6F,QAAS,CACf,MAAMoC,GAAM,IAAIH,MAAOC,UACjB3C,EAAWC,OAAOrF,EAAI6F,QAAQP,QAAU2C,EAAMJ,GACpDA,EAAOI,EAEPjI,EAAI6F,QAAQP,MAAQF,EAASW,WAC7B,MAAMC,EAAoBZ,EAAWa,EAAY,IACjDjG,EAAI6F,QAAQnI,MAAMwI,gBAAe,oCAAAC,OAAuCH,EAAgB,mBAAAG,OAAkBH,EAAgB,MAEtHZ,GAAYC,OAAOrF,EAAI6F,QAAQW,MACjCE,IACI1G,EAAI6F,UACN7F,EAAI6F,QAAQP,MAAQ,MAGtBK,EAASS,sBAAsB4B,EAEnC,GAKF,OAFArC,EAASS,sBAAsB4B,GAExB,KACL3B,qBAAqBV,GAEzB,GACC,CAACM,EAAUY,EAAUQ,EAAYX,EAAYpK,EAAMe,MAAOmK,IAG3D7J,cAAC6C,EAAM,CACLR,IAAKA,EACLsG,KAAK,QACLV,KAAM,EACNW,IAAK,EACLC,IAAKP,EACLnB,SAAU6B,IACVzD,QAASyD,IACThG,WAAW,EACXC,SAAS,EACTiE,UAAWvI,EAAMuI,WAGvB,EF7EwBpE,CACtBzC,IAAA,IAAC,MAAE6C,GAAO7C,EAAA,OAAK8C,YAAGoH,MAAA3H,YAAA,sDAENM,EAAMiB,WAAWC,cAIzBoG,GAAa1H,YHHZ,SAAuBnE,GAC5B,MAAM,QAAE4G,EAAO,UAAE2B,EAAY,GAAE,SAAEF,GAAarI,EAE9C,OACE6H,eAAC1C,EAAQ,CACP2G,KAAK,aACLC,QAAQ,YACRC,MAAM,6BACNpF,QAASA,EACT2B,UAAS,GAAAsB,OAAKtB,EAAS,KAAAsB,OAAIxB,EAAW,OAAS,SAAU5G,SAAA,CAEzDJ,cAAA,QAAMkH,UAAU,OAAOxB,MAAM,eAAekF,EAAE,IAAIC,EAAE,IAAIlJ,MAAM,KAAKG,OAAO,QAC1E9B,cAAA,QAAMkH,UAAU,QAAQxB,MAAM,eAAekF,EAAE,IAAIC,EAAE,IAAIlJ,MAAM,KAAKG,OAAO,UAGjF,EGZmBgB,CAAqBgI,MAAAlI,YAAA,0IAOpCsB,KAGE6G,GAAgBjI,IAAOkI,KAC1BrM,GAAUwE,YAAG8H,MAAArI,YAAA,2KAMDjE,EAAMuE,MAAMiB,WAAW+G,QACxBvM,EAAMuE,MAAMiB,WAAWC,aAI/B+G,GAAcrI,IAAO+C,IAAGuF,MAAAxI,YAAA,0FAOxByI,GAAevI,IAAO+C,IAAGyF,MAAA1I,YAAA,0FAiDxB,SAAS2I,GAAa5M,GAC3B,MAAM,MAAEe,EAAK,QAAE2G,EAAO,aAAEmF,EAAY,SAAEtC,EAAQ,WAAEH,EAAU,OAAEE,GAAWtK,EAEvE,OACE6H,eAAAiF,WAAA,CAAArL,SAAA,CACEJ,cAACqE,EAAsB,CAAC3E,MAAOA,IAC/BM,cAACoG,EAAQ,CAACC,QAASA,IAClBmF,GAAgBxL,cAAC8I,GAAe,CAACpJ,MAAOA,EAAOqJ,WAAYA,EAAYE,OAAQA,EAAQC,SAAUA,MAGxG,CAEA,SAASwC,GAAW/M,GAClB,MAAM,QAAE0H,EAAO,SAAEW,EAAQ,MAAEtH,EAAK,eAAEiM,EAAc,aAAEH,EAAY,SAAEtC,EAAQ,WAAEH,EAAU,OAAEE,GAAWtK,EAEjG,OACE6H,eAAAiF,WAAA,CAAArL,SAAA,CACEJ,cAACqE,EAAsB,CAAC3E,MAAOA,IAC/BM,cAACoG,EAAQ,CAACC,QAASA,IACnBrG,cAACwK,GAAU,CAACxD,SAAUA,EAAUzB,QAASoG,EAAgB,aAAW,eACnEH,GACCxL,cAAC8I,GAAe,CAACpJ,MAAOA,EAAOsH,SAAUA,EAAUiC,OAAQA,EAAQF,WAAYA,EAAYG,SAAUA,IAEvGlJ,cAAC+K,GAAa,CAAA3K,SAAC,UAGrB,CAEA,SAASwL,GAAajN,GACpB,MAAM,QAAE0H,EAAO,SAAEW,EAAQ,MAAEtH,EAAK,eAAEiM,EAAc,OAAEE,EAAM,SAAEvD,EAAQ,SAAErB,EAAQ,SAAEiC,EAAQ,WAAEH,GAAepK,EAEjGmN,EAAoBtM,sBACvBuM,IACCA,EAAEvC,iBACEvC,GACF4E,EAAO5E,EAASkB,YAAc,KAGlC,CAAC0D,EAAQ5E,IAGL+E,EAAqBxM,sBACxBuM,IACCA,EAAEvC,iBACEvC,GACF4E,EAAO5E,EAASkB,YAAc,KAGlC,CAAC0D,EAAQ5E,IAGX,OACET,eAAAiF,WAAA,CAAArL,SAAA,CACEJ,cAACqE,EAAsB,CAAC3E,MAAOA,IAC/BM,cAACoG,EAAQ,CAACC,QAASA,IACnBrG,cAACqL,GAAY,CAACY,cAAeD,EAAmB5L,SAC9CJ,cAACkM,IAAY,CAACC,SAAU,MAE1BnM,cAACwK,GAAU,CAACxD,SAAUA,IAAakC,EAAU3D,QAASoG,EAAgB,aAAW,eACjF3L,cAACmL,GAAW,CAACc,cAAeH,EAAkB1L,SAC5CJ,cAACoM,IAAW,CAACD,SAAU,MAEzBnM,cAAC+K,GAAa,CAAA3K,SAAEiM,YAAe/D,KAC/BtI,cAAC+G,GAAgB,CAACC,SAAUA,IAAakC,EAAUjC,SAAUA,EAAUE,SAAU0E,EAAQzE,QAAS2B,MAGxG,CAEA,SAASuD,GAAkB3N,GACzB,OAAQA,EAAMgK,MACZ,IAAK,QACH,OAAO3I,cAACuL,GAAY7K,YAAA,GAAK/B,IAC3B,IAAK,MACH,OAAOqB,cAAC0L,GAAUhL,YAAA,GAAK/B,IACzB,IAAK,QACH,OAAOqB,cAAC4L,GAAYlL,YAAA,GAAK/B,IAE/B,CAEO,SAAS4N,GAAQ5N,GACtB,MAAM,UAAEmI,EAAS,WAAE0F,GAAe7N,EAE5B8N,EAAgB9H,IAAMnF,YAAY,IAAMgN,GAAY1F,GAAY,CAACA,EAAW0F,IAElF,OACExM,cAAC4F,GAAO,CACNkB,UAAWA,EACXvB,QAASkH,EACT,cAAY,kBACZ,YAAU,UACVvF,UAAU,UAAS9G,SAElBkM,GAAkB3N,IAGzB,C,yBG/Me+N,I,MAAAA,GANG5J,IAAO6J,MAAKhK,QAAAC,YAAA,8CAC1BgK,KACAC,MCAG,MAAMC,GAAYhK,YAAO4J,GAAP5J,CAAiBH,QAAAC,YAAA,gBACtCmK,MAGSC,GAAYlK,YAAOmK,KAAPnK,CAAiBc,QAAAhB,YAAA,gBACtCmK,MCQW,SAASG,GAAQvO,GAC9B,MAAM,QAAEwO,EAAO,QAAE9G,EAAO,MAAE3G,EAAK,OAAEe,EAASuI,IAAK,MAAErH,EAAK,OAAEG,EAAM,aAAE0J,EAAY,SAAEtC,EAAQ,WAAEH,EAAU,OAAEE,GAAWtK,EAE/G,OACE6H,eAAAiF,WAAA,CAAArL,SAAA,CACEJ,cAACgN,GAAS,CACR,cAAY,QACZI,IAAKD,EACLE,IAAKF,EACL1M,OAAQA,EACR6M,QAAQ,OACR3L,MAAOA,EACPG,OAAQA,IAEV9B,cAACuM,GAAO,CACN5D,KAAK,QACLtC,QAASA,EACT3G,MAAOA,EACPoH,WAAW,EACX0F,WAAYxD,IACZwC,aAAcA,EACdzC,WAAYA,EACZE,OAAQA,EACRC,SAAUA,MAIlB,CC1CA,IAAIqE,GAA+E,GAGnF,MAWMC,GAAW,IAAIC,qBAXSC,IAC5BA,EAAQC,QAASC,IACf,MAAMtE,EAAUiE,GAASM,KAAMC,GAAMA,EAAEC,UAAYH,EAAMlH,QAErD4C,GACFA,EAAQ0E,OAAOJ,EAAMK,mBAMqC,CAAEC,UAAW,ICf7E,IAEIjE,GACAkE,GAHAC,IAAoB,EACpBC,GAA6D,GCC1D,SAASC,GAAYjM,GAC1B,MAAOkM,EAAYC,GAAiB7J,IAAMiF,UAAS,IAE5C6E,GFeM,SAAuB/H,GACpC,MAAO+H,EAAYC,GAAe/J,IAAMiF,UAAS,GAE3C+E,EAAqBhK,IAAMnF,YAAamI,IAC5C+G,EAAY/G,IACX,IAeH,OAbAhD,IAAMkD,UAAU,KACd,GAAInB,EAAQ,CACV,MAAM4C,EAAU,CAAEyE,QAASrH,EAAQsH,OAAQW,GAI3C,OAHApB,GAASrI,KAAKoE,GACdkE,GAASoB,QAAQlI,GAEV,KACL6G,GAASsB,OAAQf,GAAMA,IAAMxE,GAC7BkE,GAASsB,UAAUpI,GAEvB,GACC,CAACiI,EAAoBjI,IAEjB,CAAC+H,EACV,CEpCuBM,CAAc1M,GAC7BN,EDDsBiN,MAC5B,MAAOjN,EAAakN,GAAkBtK,IAAMiF,SAASwE,IA+BrD,YA7BiBc,IAAbjF,KACFA,GAAY8B,IACVqC,IAAoB,EACpBC,GAAUV,QAASK,GAAWA,EAAOI,KAEjCD,IAAWgB,aAAahB,IAE5BA,GAAYiB,WAAW,KACrBhB,IAAoB,EACpBC,GAAUV,QAASK,GAAWA,EAAOI,MACpC,MAEL3E,SAAS3B,iBAAiB,SAAUmC,GAAU,CAAEoF,SAAS,KAG3D1K,IAAMkD,UAAU,KACdwG,GAAUnJ,KAAK+J,GACfA,EAAeb,IACR,KACLC,GAAYA,GAAUQ,OAAQb,GAAWA,IAAWiB,GAE3B,IAArBZ,GAAU/O,QAAgB2K,KAC5BR,SAAS1B,oBAAoB,SAAUkC,IACvCA,QAAWiF,KAGd,IAGInN,GC/BaiN,GAcpB,OAZArK,IAAMkD,UAAU,KACV4G,IAAe1M,GACjByM,GAAc,IAEf,CAACC,EAAY1M,IAEhB4C,IAAMkD,UAAU,KACT4G,GACHD,GAAc,IAEf,CAACC,IAEGF,CACT,CCde,SAASe,GAAI3Q,GAC1B,MAAM,QACJwO,EAAO,aACPoC,EAAY,QACZlJ,EAAO,OACP5F,EAASuI,IAAK,MACdtJ,EAAK,MACLiC,EAAK,OACLG,EAAM,eACN0N,EAAc,aACdhE,EAAY,WACZzC,EAAU,SACVG,GACEvK,GAEG8Q,EAAgBC,GAAqB/K,IAAMiF,UAAS,IAGpD+F,EAAWC,GAAgBhG,oBAAS,IAGpCiG,EAAQC,GAAalG,mBAAkC,MACxDmG,EAAehG,YAAYiG,KAC3BC,EAAW3B,GAAYuB,GAEvBK,EAAUnG,YAAYoG,KAEtBC,EAAaT,EAAYxC,EAAUoC,EAEnCc,EAAO1L,IAAMnF,YAAY8Q,UAC7BV,GAAa,IACZ,IAEGW,EAAQ5L,IAAMnF,YAAY,KAC9BoQ,GAAa,IACZ,IAEGY,EAAsC7L,IAAMnF,YAC/CuM,IACCA,EAAElH,kBACE8K,EACFC,GAAa,IAEbA,GAAa,GACbF,GAAkB,KAGtB,CAACC,IAuBH,OApBAhL,IAAMkD,UAAU,MACVkI,GAAgBvE,IACdyE,IACFL,GAAa,GACbF,GAAkB,IAIjBO,GACHL,GAAa,IAEd,CAACK,EAAUzE,EAAc+E,EAAOF,EAAMN,IAEzClI,oBAAU,KACR,GAAIqI,EAAS,EACI,IAAIO,OACZrD,IAAMD,CACf,IAIA3G,eAAAiF,WAAA,CAAArL,SAAA,CACEJ,cAACgN,GAAS,CACR,cAAY,MACZ3K,IAAKyN,EACL1C,IAAKgD,EACL/C,IAAK+C,EACL9C,QAAQ,OACR7M,OAAQA,EACRkB,MAAOA,EACPG,OAAQA,IAGV9B,cAACuM,GAAO,CACNzF,WAAY6I,GAAaF,GAAkBD,EAC3ChD,WAAYkD,EACZ/G,KAAK,MACLtC,QAASA,EACT3G,MAAOA,EACPsH,UAAW2I,EACXhE,eAAgB6E,EAChBhF,aAAcA,EACdzC,WAAYA,EACZG,SAAUA,MAIlB,CCjGe,SAASwH,GAAM/R,GAC5B,MAAM,QACJwO,EAAO,QACP9G,EAAO,OACP5F,EAASuI,IAAK,MACdtJ,EAAK,MACLiC,EAAK,OACLG,EAAM,eACN0N,EAAc,aACdhE,EAAY,SACZtC,EAAQ,WACRH,GACEpK,GAEGgR,EAAWC,GAAgBhG,oBAAS,IAEpC6F,EAAgBC,GAAqB/K,IAAMiF,UAAS,IACpD3C,EAAU0J,GAAe/G,mBAAkC,MAE5DqG,EAAW3B,GAAYrH,GAEvBiJ,EAAUnG,YAAY6G,KAAuB,OAAS,WACtDb,EAAehG,YAAYiG,KAE3BK,EAAO1L,IAAMnF,YAAY8Q,UAC7B,GAAY,OAARrJ,QAAQ,IAARA,KAAU4J,OACZ,UACQ5J,EAASoJ,OACfT,GAAa,EACf,CAAE,MAAOkB,GACFA,EAAqBC,QAAQC,SAAS,gDAEzCrQ,QAAQC,KAAK,yEAA0EkQ,GAC7EA,EAAqBC,QAAQC,SAAS,uDAIhDrQ,QAAQC,KAAK,gCAAiCkQ,GAE9CnQ,QAAQsQ,MAAM,yBAA0BH,EAE5C,GAED,CAAC7J,IAEEsJ,EAAQ5L,IAAMnF,YAAY,KAC9B,GAAa,OAARyH,QAAQ,IAARA,MAAU4J,OACb,IACU,OAAR5J,QAAQ,IAARA,KAAUsJ,QACVX,GAAa,EACf,CAAE,MAAOkB,GACPnQ,QAAQsQ,MAAM,yBAA0BH,EAC1C,GAED,CAAC7J,IAEEiK,EAAavM,IAAMnF,YACtBmI,IACKV,IACFA,EAASkB,YAAcR,IAG3B,CAACV,IAIGuJ,EAAsC7L,IAAMnF,YAC/CuM,IACCA,EAAElH,kBACEoC,IACEA,EAAS4J,QACXR,IACAX,GAAkB,IAElBa,MAIN,CAACA,EAAOF,EAAMpJ,IAkBhB,OAdAtC,IAAMkD,UAAU,MAEVkI,GAAgBvE,IACdyE,IACFI,IACAX,GAAkB,IAIjBO,GACHM,KAED,CAACN,EAAUzE,EAAc+E,EAAOF,EAAMN,IAGvCvJ,eAAAiF,WAAA,CAAArL,SAAA,CACEJ,cAAC8M,GAAS,CACR,cAAY,QACZqE,UAAU,EACVC,MAAO5F,EACP0E,QAASA,EACT7N,IAAKsO,EACLU,iBAAkB5Q,EAClBkB,MAAOA,EACPG,OAAQA,EACRsL,IAAKD,IAEPnN,cAACuM,GAAO,CACN5D,KAAK,QACLjJ,MAAOA,EACP2G,QAASA,EACTW,UAAW2I,EACXrH,UAAkB,OAARrB,QAAQ,IAARA,OAAQ,EAARA,EAAUqB,WAAY,EAChCqD,eAAgB6E,EAChB3E,OAAQqF,EACRjK,SAAUA,EACVH,WAAyB,IAAd6I,GAAuBH,GAAkBC,EACpDjD,WAAYkD,EACZlE,aAAcA,EACdzC,WAAYA,EACZG,SAAUA,MAIlB,CChHO,SAASoI,GAAM3S,GACpB,MAAM,KACJgK,EAAI,aACJ4G,EAAY,UACZgC,EAAS,QACTlL,EAAO,MACP3G,EAAK,OACLe,EAAM,MACNkB,EAAK,OACLG,EAAM,eACN0N,EAAc,aACdhE,GAAe,EAAK,OACpBvC,EAAM,WACNF,EAAU,SACVG,GAAW,GACTvK,GACG6S,EAASpE,GClCX,SAAoBzE,EAAoB4G,EAAsBgC,EAAmBlL,GACtF,MAAMoL,EAAgB1H,YAAY2H,KAElC,OAAO/M,IAAMgN,QAAQ,KACnB,OAAQhJ,GACN,IAAK,QACH,OAAO8I,EAAgB,CAAC,GAAIpL,GAAW,CAAC,GAAIkL,GAC9C,IAAK,MACH,OAAOA,EAAUP,SAAS,QAAU,CAACzB,EAAcgC,GAAa,CAACA,EAAWlL,GAC9E,IAAK,QACH,MAAuB,CAACkJ,EAAclJ,KAEzC,CAACA,EAASoL,EAAeF,EAAWhC,EAAc5G,GACvD,CDqByBiJ,CAAWjJ,EAAM4G,EAAcgC,EAAWlL,GAEjE,OAAQsC,GACN,IAAK,QACH,OACE3I,cAACkN,GAAO,CACNC,QAASC,EACT/G,QAASA,EACT5F,OAAQA,EACRf,MAAOA,EACPiC,MAAOA,EACPG,OAAQA,EACR0J,aAAcA,EACdzC,WAAYA,EACZE,OAAQA,EACRC,SAAUA,IAGhB,IAAK,MACH,OACElJ,cAACsP,GAAG,CACFE,eAAgBA,EAChBrC,QAASC,EACTmC,aAAciC,EACdnL,QAASA,EACT5F,OAAQA,EACRf,MAAOA,EACPiC,MAAOA,EACPG,OAAQA,EACR0J,aAAcA,EACdzC,WAAYA,EACZE,OAAQA,EACRC,SAAUA,IAGhB,IAAK,QACH,OACElJ,cAAC0Q,GAAK,CACJlB,eAAgBA,EAChBrC,QAASC,EACTmC,aAAciC,EACdnL,QAASA,EACT5F,OAAQA,EACRf,MAAOA,EACPiC,MAAOA,EACPG,OAAQA,EACR0J,aAAcA,EACdzC,WAAYA,EACZE,OAAQA,EACRC,SAAUA,IAIpB,C,qCEvFe,SAAS2I,GAAcpS,GAA0B,IAAzB,MAAEkI,GAAoBlI,EAC3D,OACE+G,eAACsL,KAAQ,CAAC,cAAY,cAAa1R,SAAA,CACjCJ,cAAC+R,IAAU,CAACrM,MAAM,UAClB1F,cAAA,QAAAI,SAAOuH,MAGb,CCOeqK,OAhBSlP,IAAOkD,EAC7BvG,IAAA,IAAC,MAAEiG,EAAK,MAAExC,GAAOzD,EAAA,OAAK0D,YAAGR,QAAAC,YAAA,iGACrBkD,YAAe,CAAE5C,UACjBwC,EACEvC,YAAGS,QAAAhB,YAAA,mDACQ8C,GAEX,MCHO,SAASuM,GAAiBxS,GAA0B,IAAzB,MAAEkI,GAAoBlI,EAC9D,MAAMiG,EAAQ6B,cAAWjE,OAAOE,YAC1BgC,EAAQ0M,YAAavK,GAE3B,OACEnB,eAACwL,GAAe,CACd,cAAY,cACZtM,MAAOA,EACPe,KAAMkB,EACNjB,OAAO,SACPC,IAAI,sBACJO,UAAU,SAAQ9G,SAAA,CAElBJ,cAACmS,IAAQ,CAACzM,MAAOA,IAChBF,IAGP,CClBO,SAAS4M,GAAoBzK,GAClC,OAAOA,EAAM0K,MAAM,KAAK,GAAGA,MAAM,KAAK,GAAGA,MAAM,KAAK,EACtD,CAQO,MAAMC,GAAyC,CACpD,eAAgB,CAAC,UAAWC,IAAc5K,GAAUyK,GAAoBzK,EAAM0K,MAAM,gBAAgB,KACpG,aAAc,CAAC,UChBV,SAAmB1T,GACxB,OACEqB,cAAA,OAAK0K,QAAQ,YAAYC,MAAM,6BAA4BvK,SACzDJ,cAAA,QACEwS,KAAK,eACLC,EAAE,sqBAIV,EDOuC,IAAM,SAC3C,eAAgB,CACd,UACAC,IACC/K,IACC,MAAMgL,EAAOhL,EAAM0K,MAAM,gBAAgB,GAEzC,OAAOM,EAAKC,WAAW,UAftB,SAA8BjL,GACnC,OAAOA,EAAM0K,MAAM,KAAK,GAAGA,MAAM,KAAK,GAAGA,MAAM,KAAK,EACtD,CAayCQ,CAAqBF,GAAQP,GAAoBO,KAGxF,kBAAmB,CAAC,UAAWG,IAAiBnL,GAAUyK,GAAoBzK,EAAM0K,MAAM,mBAAmB,KAC7G,kBAAmB,CAAC,UAAWU,IAAa,IAAM,WAClD,aAAc,CAAC,UAAWC,IAAarL,GAAU,IAAIsL,IAAItL,GAAOuL,SAASb,MAAM,KAAK,KEpBvE,SAASc,GAAkBxU,GACxC,MAAM,MAAEgJ,EAAK,MAAEjC,EAAK,KAAE0N,EAAI,MAAE5N,GAAU7G,EACtC,OACE6H,eAACwL,GAAe,CACd,cAAY,eACZvL,KAAMkB,EACNjB,OAAO,SACPC,IAAI,sBACJO,UAAU,SACVxB,MAAOA,EAAMtF,SAAA,CAEbJ,cAACoT,EAAI,IACJ5N,IAGP,CCjBe,SAAS6N,GAAM5T,GAA0B,IAAzB,MAAEkI,GAAoBlI,EACnD,GAAI6T,YAAS3L,GAAQ,CAEnB,MAAM4L,EAAQ5L,EAAM0K,MAAM,KAC1B,OACErS,cAAAyL,WAAA,CAAArL,SACGmT,EAAMC,IAAKC,IACV,MAAMC,EAASC,OAAOC,KAAKtB,IAASzE,KAAMhO,GAAQ4T,EAAKzC,SAASnR,IAEhE,GAAI6T,EAAQ,CACV,MAAOhO,EAAO0N,EAAMS,GAAYvB,GAAQoB,GAExC,OAAO1T,cAACmT,GAAiB,CAAYxL,MAAO8L,EAAM/N,MAAOA,EAAO0N,KAAMA,EAAM5N,MAAOqO,EAASJ,IAA7DA,EACjC,CAEA,OAAOzT,cAACiS,GAAiB,CAAYtK,MAAO8L,GAAbA,MAIvC,CAEA,OAAOzT,cAAC6R,GAAc,CAAClK,MAAOA,GAChC,C,yBC1BO,MAAMmM,GAAoBhR,IAAO+C,IAAGlD,QAAAC,YAAA,iEACvCmR,IACAC,M,gBCDJ,MAAMC,GAAWnR,IAAOoR,EAACvR,QAAAC,YAAA,kCAInBuR,GAAUrR,YAAOsR,KAAPtR,CAAac,QAAAhB,YAAA,iFAMvByR,GAAWvR,IAAOoR,EAAC7Q,QAAAT,YAAA,mDAKnB0R,GAAUxR,IAAO+C,IAAGzC,QAAAR,YAAA,+BAQX,SAAS2R,GAAS5V,GAC/B,MAAM,SAAE6V,GAAa7V,EAErB,OACEqB,cAAC8T,GAAiB,CAAA1T,SACK,IAApBoU,EAASlV,OACRU,cAACqU,GAAQ,CAAAjU,SAAC,sBAEVoU,EAAShB,IAAI,CAACiB,EAAS/U,IACrB8G,eAAC8N,GAAO,CAAAlU,SAAA,CACNJ,cAACiU,GAAQ,CAAA7T,SAAEqU,EAAQC,UACnB1U,cAACmU,GAAO,CAAA/T,SAAEqU,EAAQE,SAFNjV,KAQxB,C,OCpCA,MAAMkV,GAAQ9R,YAAOsR,KAAPtR,CAAaH,QAAAC,YAAA,kCAMZ,SAASiS,GAASlW,GAC/B,MAAM,WAAEmW,EAAU,MAAEnT,EAAK,OAAEG,EAAM,GAAEiT,EAAE,OAAEC,GAAWrW,EAE5CsW,EAAY,IAAI9K,KAAK2K,GAE3B,OACEtO,eAACsN,GAAiB,CAAA1T,SAAA,CAChBoG,eAACsL,KAAQ,CAACtM,MAAM,KAAIpF,SAAA,CAClBJ,cAAC+R,IAAU,IACX/R,cAAC4U,GAAK,CAAC,cAAY,KAAIxU,SAAE2U,OAG3BvO,eAACsL,KAAQ,CAACtM,MAAM,cAAapF,SAAA,CAC3BJ,cAACkV,IAAY,IACb1O,eAACoO,GAAK,CAAC,cAAY,OAAMxU,SAAA,CACtB+U,YAAeF,GAAW,KAAGG,YAAWjL,KAAKG,MAAQ2K,EAAU7K,WAAW,cAI/E5D,eAACsL,KAAQ,CAACtM,MAAM,SAAQpF,SAAA,CACtBJ,cAACqV,IAAS,IACVrV,cAAC4U,GAAK,CAAC,cAAY,SAAQxU,SAAE4U,OAG/BxO,eAACsL,KAAQ,CAACtM,MAAM,eAAcpF,SAAA,CAC5BJ,cAACsV,IAAS,IACV9O,eAACoO,GAAK,CAAC,cAAY,OAAMxU,SAAA,CACtBuB,EAAM,MAAIG,UAKrB,CCzCA,MAAMyT,GAA4C,CAChDxJ,EAAG,WACHyJ,EAAG,eACHC,EAAG,QAOU,SAASC,GAAO/W,GAC7B,MAAM,MAAEgJ,GAAUhJ,EACZuE,EAAQqE,cAEd,OACEf,eAACsL,KAAQ,CAAC,cAAY,SAAStM,MAAO+P,GAAU5N,GAAOvH,SAAA,CACrDJ,cAAC2V,IAAU,CAACjQ,MAAOxC,EAAMI,OAAOsS,OAChC5V,cAAA,QAAAI,SAAOuH,EAAMkO,kBAGnB,C,aChBA,MAAMC,GAAYhT,YAAOgP,KAAPhP,CAChBrD,IAAA,IAAC,OAAEsW,EAAM,MAAE7S,GAAiDzD,EAAA,OAAK0D,YAAGR,QAAAC,YAAA,sFAIhEmT,EACE5S,YAAGS,QAAAhB,YAAA,iGACQM,EAAMI,OAAO0S,MAGX9S,EAAMI,OAAO0S,OAG1B7S,YAAGE,QAAAT,YAAA,WAII,SAASqT,GAAMtX,GAC5B,MAAM,MAAEgJ,EAAK,OAAEuO,GAAWvX,EAEpB2F,EAAWC,cAEXyR,EAAQjM,YAAYoM,YAAoBD,IACxCtO,EAAiCpI,sBACpCoF,IACCA,EAAMC,kBAEDmR,GACH1R,EAAS8R,YAASF,KAGtB,CAAC5R,EAAU0R,EAAOE,IAGpB,OACE1P,eAACsP,GAAS,CAACvQ,QAASqC,EAAamO,OAAQC,EAAO,cAAY,QAAQxQ,MAAM,iBAAgBpF,SAAA,CACxFJ,cAACqW,IAAS,CAAC3Q,MAAM,UACjB1F,cAAA,QAAAI,SAAOkW,YAAY3O,EAAQ4O,YAAaP,QAG9C,C,qCC7BA,MAAMQ,GAAM1T,IAAO+C,IACjBpG,IAAA,IAAC,MAAEyD,GAAOzD,EAAA,OAAK0D,YAAGR,QAAAC,YAAA,oNAOd6T,YAAM,CAAEvT,UACR8Q,KACmB9Q,EAAMiB,WAAWuS,aAAgBxT,EAAMiB,WAAWuS,gBAIrEC,GAAO7T,IAAO+C,IAClBjG,IAAA,IAAC,MAAEsD,GAAOtD,EAAA,OAAKuD,YAAGS,QAAAhB,YAAA,kGACdkD,IAEY5C,EAAMiB,WAAWC,cAK7BwS,GAAY9T,IAAOkI,KAAI3H,QAAAT,YAAA,sCAGzBvC,IAAA,IAAC,OAAEwW,EAAM,MAAE3T,GAAiD7C,EAAA,OAC5DwW,EACI1T,YAAGC,QAAAR,YAAA,wCACQM,EAAMI,OAAOE,aAExB,KAGFsT,GAAiBhU,YAAOiU,KAAPjU,CACrBzB,IAAA,IAAC,MAAE6B,GAAO7B,EAAA,OAAK8B,YAAGoH,QAAA3H,YAAA,kDAELM,EAAMiB,WAAWC,cAYjB,SAAS4S,GAAQrY,GAC9B,MAAM2F,EAAWC,eACV0S,GAAYC,gBAEb,OAAEhB,EAAM,OAAEzV,EAASuI,IAAK,UAAEmO,EAAS,aAAEC,EAAY,YAAEC,GAAgB1Y,GACnE,OAAE2Y,EAAM,MAAEC,EAAK,KAAEC,EAAI,OAAE9D,EAAM,OAAE+D,EAAM,OAAEzC,EAAM,OAAElT,EAAM,MAAEH,EAAK,SAAE6S,GAAazK,YAC/E2N,YAAexB,IAEXyB,EAAmBhG,kBACvB,IACEiG,YACEJ,EAAKhE,IAAKqE,IAAG,CAAQpN,KAAMoN,EAAKC,MAAO,MACvC,QAEJ,CAACN,IAEGO,EAAehO,YAAYiO,KAC3BC,EAAelO,YAAYmO,KAE3BC,EAAgBC,eAEhBC,EAAYC,eACZC,EAA6B/Y,sBAChCoF,IACCA,EAAMC,kBACNuS,EAAa,SAEf,CAACA,IAGGoB,EAAiChZ,sBACpCoF,IACCA,EAAMC,kBACNuS,EAAa,aAEf,CAACA,IAGGqB,EAAiCjZ,sBACpCoF,IACCA,EAAMC,kBACNuS,EAAa,aAEf,CAACA,IAGGsB,EAAqB/T,IAAMnF,YAC9BqY,IACCvT,EAASqU,YAAMjY,wBAAC,CAAC,EAAImX,GAAG,IAAEZ,gBAE5B,CAAC3S,EAAU2S,IAOb,OAJApP,oBAAU,KACRpH,KACC,CAACA,EAAQ0W,IAGV3Q,eAAAiF,WAAA,CAAArL,SAAA,CACEoG,eAACgQ,GAAG,CAAApW,SAAA,CACFJ,cAAC0V,GAAM,CAAC/N,MAAO2P,IACftX,cAACiW,GAAK,CAACtO,MAAO4P,EAAOrB,OAAQA,MAC1BxC,GAAU1T,cAACqT,GAAM,CAAC1L,MAAO+L,QAE3BuE,GAAgBZ,GAAgBU,IACjCvR,eAACmQ,GAAI,CAAAvW,SAAA,CACHJ,cAAC4W,GAAS,CAACC,OAAsB,SAAdM,EAAsB5R,QAASgT,EAAS/S,MAAM,YAAWpF,SAAC,SAG5E6X,GAAgBZ,GACfrX,cAAC4W,GAAS,CAACC,OAAsB,aAAdM,EAA0B5R,QAASiT,EAAahT,MAAM,gBAAepF,SAAC,aAI1F2X,GACC/X,cAAC4W,GAAS,CAACC,OAAsB,aAAdM,EAA0B5R,QAASkT,EAAajT,MAAM,gBAAepF,SAAC,gBAQ7F,CACEoX,KACExX,cAAC8W,GAAc,CACbU,KAAMG,EACNiB,UAAU,EACVC,WAAYR,EACZS,YAAaX,EACbY,UAAWL,IAGflE,SAAUxU,cAACuU,GAAQ,CAACC,SAAmB,OAARA,QAAQ,IAARA,IAAY,KAC3CwE,SACEhZ,cAAC6U,GAAQ,CAACC,WAAY2C,EAAOrP,WAAY4M,OAAQA,EAAQrT,MAAOA,EAAOG,OAAQA,EAAQiT,GAAImB,KAE7FiB,KAIV,C,aC5JA,MAAM8B,GAAcnW,IAAO+C,IACzBpG,IAAA,IAAC,MAAEyD,GAAOzD,EAAA,OAAK0D,YAAGR,QAAAC,YAAA,kCACDM,EAAMiB,WAAWC,cAI9B8U,GAAiBpW,IAAO+C,IAC5BjG,IAAA,IAAC,MAAEsD,GAAOtD,EAAA,OAAKuD,YAAGS,QAAAhB,YAAA,0FACHM,EAAMiB,WAAWC,WAEjBlB,EAAMiB,WAAWgV,aAK5BC,GAActW,IAAO+C,IAAGxC,QAAAT,YAAA,uRAI1B6T,IAKW4C,IAAOC,KAKPD,IAAOE,SAIf,SAASC,GAAS7a,GACvB,MAAM,MACJoB,EAAK,WACLS,EAAU,KACVmI,EAAI,WACJ8Q,EAAU,SACVC,EAAQ,YACRC,EAAW,OACXlZ,EAASuI,IAAK,GACd+L,EAAE,MACFpT,EAAK,OACLG,EAAM,SACN0S,EAAQ,aACRoF,EAAY,MACZla,GACEf,EAEJ,OACEqB,cAACiZ,GAAW,CAAClZ,MAAOA,EAAOsC,IAAK7B,EAAY0G,UAAU,WAAU9G,SAC9DJ,cAACkZ,GAAc,CAAA9Y,SACbJ,cAAC6Z,GAAI,CACHlR,KAAMA,EACN8Q,WAAYA,EACZC,SAAUA,EACVC,YAAaA,EACblZ,OAAQA,EACRsU,GAAIA,EACJpT,MAAOA,EACPG,OAAQA,EACR0S,SAAUA,EACVoF,aAAcA,EACdla,MAAOA,OAKjB,CAOO,MAAMma,GAAOlV,IAAMmV,KAAMnb,IAC9B,MAAM,KACJgK,EAAI,WACJ8Q,EAAU,SACVC,EAAQ,YACRC,EAAW,OACXlZ,EAASuI,IAAK,GACd+L,EAAE,MACFpT,EAAK,OACLG,EAAM,SACN0S,EAAQ,aACRoF,EAAY,MACZla,GACEf,EAEE2F,EAAWC,eAEV4S,EAAWC,GAAgBxN,mBAAoB,SAC/CmQ,EAAWC,GAAmBC,aAAU,GAEzCC,EAAkBnQ,YAAYoQ,KAC9BlC,EAAelO,YAAYmO,KAcjC,OAXArQ,oBAAU,KACRpH,KACC,CAACA,EAAQsZ,IAGZlS,oBAAU,MACHkS,GAAa9B,GAAgB2B,IAAiBpF,GACjDlQ,EAAS8V,YAAcrF,KAExB,CAACgF,EAAW9B,EAAc2B,EAAcpF,EAAUlQ,EAAUyQ,IAG7DvO,eAAC4S,GAAW,CAAC7T,QAASyU,EAAiBK,KAAK,MAAM,YAAU,eAAelO,SAAU,EAAE/L,SAAA,CACrFJ,cAACsR,GAAK,CACJ9B,gBAAiBuK,EACjBpR,KAAMA,EACN4G,aAAcoK,EACdpI,UAAWkI,EACXpT,QAASqT,EACTjZ,OAAQA,EACRf,MAAOA,EACPiC,MAAOA,EACPG,OAAQA,EACRoH,UAAU,IAEXgR,IAAoBH,GACnB/Z,cAACgX,GAAO,CACNd,OAAQnB,EACRtU,OAAQA,EACR0W,UAAWA,EACXC,aAAcA,EACdC,YAAauC,S,+BCxIvB,IAAIU,IAAiB,EAEN,SAASC,KACtB,MAAMC,EAASC,aAAUC,KACnBpW,EAAWC,cACXoW,ECbD,WAEL,MAAMA,EAAaC,UAAUD,YAAcC,UAAUC,eAAiBD,UAAUE,kBAEzEC,EAAiBC,GAAsBpR,mBAAuC,OAAV+Q,QAAU,IAAVA,OAAU,EAAVA,EAAYhS,MAUvF,OARAd,oBAAU,KACR,GAAI8S,EAAY,CACd,MAAM1Q,EAAWA,IAAM+Q,EAAmBL,EAAWhS,MAErD,OADAgS,EAAW7S,iBAAiB,SAAUmC,EAAU,CAAEoF,SAAS,IACpD,IAAMsL,EAAW5S,oBAAoB,SAAUkC,EACxD,GACC,CAAC0Q,IAEGI,CAUT,CDXqBE,GACbC,EAAgBnR,YAAY6G,KAC5BuK,EAAWpR,YAAYiG,KACvBoL,EAAYrR,YAAY2H,KAExB9J,EAAcjD,IAAMnF,YAAY,MAG/B8a,IAAiC,aAAfK,IAFKO,GAAiBC,GAAYC,IAGvD9W,EAAS+W,YAAUC,IAAQC,mBAC3BjB,IAAiB,GAEjBE,KAED,CAACW,EAAUR,EAAYrW,EAAU8W,EAAWF,EAAeV,IAE9D,OACEhU,eAACgV,IAAW,CAACjW,QAASqC,EAAa,aAAW,SAAQxH,SAAA,CACpDJ,cAACyb,IAAU,IAAG,WAIpB,C,qCE/BA,MAAMC,GAAc5Y,YAAO6Y,KAAP7Y,CAClBrD,IAAA,IAAC,MAAEyD,GAAOzD,EAAA,OAAK0D,YAAGR,QAAAC,YAAA,kCACDM,EAAMiB,WAAWyX,eAI9BC,GAAgB/Y,YAAOgZ,KAAPhZ,CACpBlD,IAAA,IAAC,MAAEsD,EAAK,SAAE6Y,GAAsDnc,EAAA,OAAKuD,YAAGS,QAAAhB,YAAA,wCAC3DmZ,EAAW7Y,EAAMiB,WAAWC,WAAalB,EAAMiB,WAAWyX,YACnEI,aAAID,EAAW7Y,EAAMiB,WAAWC,WAAalB,EAAMiB,WAAWyX,gBAWrD,SAASK,GAActd,GACpC,MAAM,MAAE6G,EAAK,SAAEpF,EAAQ,UAAE8G,EAAS,QAAEgV,GAAU,GAAUvd,EAExD,OACE6H,eAAAiF,WAAA,CAAArL,SAAA,CACEJ,cAAC0b,GAAW,CAAAtb,SAAEoF,IACdxF,cAAC6b,GAAa,CAACE,SAAUG,EAAShV,UAAWA,EAAU9G,SACpDA,MAIT,C,yBClCO,MAAM+b,GAAcrZ,IAAOC,MAC/BpE,GAAkDwE,YAAGR,QAAAC,YAAA,wVACtCjE,EAAMuE,MAAMI,OAAO8Y,gBACtBzd,EAAMuE,MAAMiB,WAAW+G,QAChCwL,IAGO/X,EAAMuE,MAAMI,OAAOE,YAGf7E,EAAMuE,MAAMmZ,UAAUC,U,UCNvC,MAAMC,GAAWzZ,IAAO+C,IAAGlD,QAAAC,YAAA,gBACvBkD,KAGE0W,GAAc1Z,YAAO2Z,KAAP3Z,CAAqBc,QAAAhB,YAAA,iEAI1B,SAAS8Z,KACtB,MAAOC,EAAOC,GAAYC,aAAc,UACjCC,EAAgBC,GAAqBF,aAAc,kBAEpDG,EAAcrY,IAAMnF,YAAY,IAAMod,GAAUD,GAAQ,CAACA,EAAOC,KAE/DK,EAAwBC,GAA6BvY,IAAMiF,SAChEkT,EAAiBA,EAAe1U,WAAa,KAGzCjB,EAAuDxC,IAAMnF,YAChEoF,GAAUsY,EAA0BtY,EAAM8B,OAAOiB,OAClD,IAGIwV,EAASxY,IAAMnF,YACnB,IAAMud,EAAkBrV,OAAOuV,IAC/B,CAACA,EAAwBF,IAGrBK,EAAezY,IAAMnF,YAAauM,IACxB,UAAVA,EAAElM,KAAiBkM,EAAErF,OAAO2W,QAC/B,IAEH,OACErd,cAACwc,GAAW,CAAC7U,MAAOgV,EAAOW,SAAUN,EAAY5c,SAC9Cuc,EACCnW,eAAC+V,GAAQ,CAAAnc,SAAA,CACPJ,cAAA,QAAAI,SAAM,cACNJ,cAACmc,GAAW,CACVxT,KAAK,SACLhB,MAAOsV,EACP9V,SAAUA,EACVgW,OAAQA,EACRI,UAAWH,IAEbpd,cAAA,QAAAI,SAAM,aAGR,2BAIR,C,aCrDA,MAAMwF,GAAU9C,IAAO+C,IACrBpG,IAAA,IAAC,MAAEyD,GAAOzD,EAAA,OAAK0D,YAAGR,QAAAC,YAAA,gDAENM,EAAMiB,WAAWqZ,eAIzBC,GAAe3a,IAAO4a,OAAM9Z,QAAAhB,YAAA,mDAC9B+a,KAMEC,GAAS9a,IAAO+a,OACpBje,IAAA,IAAC,MAAEsD,GAAOtD,EAAA,OAAKuD,YAAGE,QAAAT,YAAA,yDACdkb,YAAc,CAAE5a,UACEA,EAAMI,OAAOG,iBAC/Bsa,YAAa,CAAE7a,aAUN,SAAS8a,GAAOrf,GAC7B,MAAM,QAAEsf,EAAO,MAAEtW,EAAK,SAAER,GAAaxI,EAErC,OACEqB,cAAC4F,GAAO,CAAAxF,SACNJ,cAACyd,GAAY,CAAC9V,MAAOA,EAAOR,SAAUA,EAAS/G,SAC5CuT,OAAOjG,QAAQuQ,GAASzK,IAAInT,IAAA,IAAE6d,EAAWC,GAAY9d,EAAA,OACpDL,cAAC4d,GAAM,CAAiBjW,MAAOuW,EAAU9d,SACtC+d,GADUD,QAOvB,C,OCvCA,MAAME,GAAUtb,IAAO+C,IAAGlD,QAAAC,YAAA,gCACtBkD,IACQrG,IAAA,IAAC,MAAEyD,GAAuBzD,EAAA,OAAKyD,EAAMiB,WAAWqZ,cAGtDa,GAAc,CAClB,aAAc,QACd,YAAa,QAGA,SAASC,KACtB,MAAOC,EAAMC,GAAW3B,aAAc,QAEhC4B,EAAgE9Z,IAAMnF,YACzEoF,GAAU4Z,EAAQ5Z,EAAM8B,OAAOiB,OAChC,CAAC6W,IAGH,OACEhY,eAAC4X,GAAO,CAAAhe,SAAA,CACNJ,cAAA,QAAAI,SAAM,aACNJ,cAACge,GAAM,CAACC,QAASI,GAAa1W,MAAO4W,EAAMpX,SAAUsX,MAG3D,C,sBCpBA,MAAMC,GAAgB5b,IAAO6b,QAAOhc,QAAAC,YAAA,8BAChCgc,IACA5K,KACA6K,KAGW,SAASC,GAAangB,GACnC,MAAM,OAAE8B,GAAW9B,GAEZogB,GCdM,WACb,MAAOC,EAAWC,GAAgBrV,oBAAS,IACpCsV,EAAMC,GAAWvV,mBAA+B,MAwBvD,OAtBA/B,oBAAU,KACR,IACE,MAAMuX,EAAcC,KACnBC,OACAC,mBAAoBL,IACfA,GACFD,GAAa,GACbE,EAAQD,KAERD,GAAa,GACbE,EAAQ,SAGZ,MAAO,KACLC,IAEJ,CAAE,MAAAI,GACAP,GAAa,GACbE,EAAQ,KACV,GACC,IAEI,CAACH,EAAWE,EACrB,CDbuBO,GACfC,EAAcC,eAEpB,OACE3f,cAAC0e,GAAa,CAAAte,SACZoG,eAACyV,GAAa,CAACzW,MAAOxF,cAAA,SAAO4f,QAAQ,cAAsB1D,SAAO,EAAA9b,SAAA,CAChEJ,cAAC6f,KAAW,CAACC,SAAUJ,EAAaK,eAAa,IACjD/f,cAACggB,KAAU,CAAC7Y,SAAU1G,EAAQwf,eAAgBlB,IAC9C/e,cAAC0c,GAAW,IACZ1c,cAACse,GAAU,IACXte,cAACua,GAAY,QAIrB,CEjCe,SAAS2F,GAAQvhB,GAC9B,MAAMuE,EAAQqE,cAEd,OACEvH,cAAA,OACE2K,MAAM,6BACNhJ,MAAOhD,EAAMuC,KACbY,OAAQnD,EAAMuC,KACdwJ,QAAQ,gBACRxD,UAAWvI,EAAMuI,UAAU9G,SAE3BoG,eAAA,KAAG2Z,UAAU,sBAAqB/f,SAAA,CAChCJ,cAAA,UACE+U,GAAG,SACHqL,GAAG,YACHC,GAAG,YACH7N,KAAK,OACL8N,OAAQpd,EAAMI,OAAOE,YACrB+c,YAAY,aACZC,iBAAiB,IACjBC,gBAAgB,OAChBC,cAAc,IACdC,EAAE,cAEJ3gB,cAAA,QACE4gB,UAAU,SACVC,WAAW,SACXC,SAAS,cACTC,WAAW,YACXC,cAAc,MACdC,YAAY,MACZzO,KAAMtP,EAAMI,OAAOE,YACnB0d,YAAY,IACZtW,EAAE,YACFC,EAAE,YACFkK,GAAG,WACHoL,UAAU,8BAA6B/f,SAEvCJ,cAAA,SACE+U,GAAG,YACHnK,EAAE,IACFC,EAAE,QACF+V,UAAU,SACVO,YAAY,SACZN,WAAW,MACXO,YAAY,SACZL,WAAW,UACXvO,KAAMtP,EAAMI,OAAOE,YACnB0d,YAAY,IAAG9gB,SAChB,aAOX,CCrDe,SAASihB,KACtB,MAAMne,EAAQqE,cAGd,OCFK,SAAyB0W,GAC9B,MAAOqD,EAAUC,GAAe5c,IAAMiF,SAAS4X,OAAO5G,UAAU6G,QAoBhE,OAlBA9c,IAAMkD,UAAU,KACd,MAAM6Z,EAAYA,KAAO,IAADC,EACtBJ,GAAY,GACL,OAAPtD,QAAO,IAAPA,GAAiB,QAAV0D,EAAP1D,EAAS2D,gBAAQ,IAAAD,GAAjBA,EAAAE,KAAA5D,IAGF,OADAuD,OAAO1Z,iBAAiB,SAAU4Z,GAC3B,IAAMF,OAAOzZ,oBAAoB,SAAU2Z,KAGpD/c,IAAMkD,UAAU,KACd,MAAM6Z,EAAYA,KAAO,IAADI,EACtBP,GAAY,GACL,OAAPtD,QAAO,IAAPA,GAAkB,QAAX6D,EAAP7D,EAAS8D,iBAAS,IAAAD,GAAlBA,EAAAD,KAAA5D,IAGF,OADAuD,OAAO1Z,iBAAiB,UAAW4Z,GAC5B,IAAMF,OAAOzZ,oBAAoB,UAAW2Z,KAG9CJ,CACT,CDtBmBU,GAEChiB,cAAA,UAAcA,cAACiiB,IAAU,CAACzc,MAAM,kBAAkBE,MAAOxC,EAAMI,OAAO4e,UAC1F,C,sBECA,MAAMC,GAAgBrf,IAAOsf,OAC3B3iB,IAAA,IAAC,MAAEyD,GAAOzD,EAAA,OAAK0D,YAAGR,QAAAC,YAAA,0CACdgc,IACY1b,EAAMI,OAAO+e,gBAIzBC,GAAWxf,IAAO+C,IACtBjG,IAAA,IAAC,MAAEsD,GAAOtD,EAAA,OAAKuD,YAAGS,QAAAhB,YAAA,6KAIdoR,KAIS9Q,EAAMiB,WAAWqZ,eAK1B+E,GAAWzf,IAAOkD,EACtB3F,IAAA,IAAC,MAAE6C,GAAO7C,EAAA,OAAK8C,YAAGE,QAAAT,YAAA,6HACPM,EAAMI,OAAOE,eASpBgf,GAAaC,IAAWC,OAC5BrhB,IAAA,IAAC,MAAE6B,GAAO7B,EAAA,OAAK8B,YAAGC,QAAAR,YAAA,mKAEPM,EAAMI,OAAOE,YACFN,EAAMI,OAAOE,eAO/Bmf,GAAW7f,IAAOkI,KACtBtJ,IAAA,IAAC,MAAEwB,GAAOxB,EAAA,OAAKyB,YAAGoH,QAAA3H,YAAA,oHACPM,EAAMI,OAAOsf,eASpBC,GAAa/f,IAAO+C,IACxBhE,IAAA,IAAC,MAAEqB,GAAOrB,EAAA,OAAKsB,YAAG2H,QAAAlI,YAAA,2XAuBL,SAAShE,KACtB,MAAOkkB,EAAQC,GAAanZ,mBAAwB,OAC7CoZ,EAAcC,GAAmBrZ,mBAAwB,MAC1DsZ,EAAave,IAAM2C,QAAO,GAE1B6b,EAAWA,IACT,GAAN3a,OAAU4a,KAAKC,MAAsB,GAAhBD,KAAKE,WAAc9a,OAAG4a,KAAKC,MAAsB,GAAhBD,KAAKE,WAAc9a,OAAG4a,KAAKC,MAC/D,GAAhBD,KAAKE,WAgGT,OA3FAzb,oBAAU,KACR,IACE,MAAM0b,EAAOC,YAAYC,kBAAoBD,YAAYC,iBAAiB,cAI1E,GAAIF,GAAOA,EAAIjkB,OAAS,EAAG,CACzB,MAAMokB,EAAIH,EAAI,GACRI,EAAMD,EAAEE,cAAgBF,EAAEE,aAAe,EAAIF,EAAEE,aAAeF,EAAEG,aAAeH,EAAEI,aAAeJ,EAAEK,eAAiBL,EAAEM,UACrHC,EAAqB,kBAARN,EAAmBA,GAAOD,EAAEM,WAAa,GAAK,KAEjE,GAAY,OAARC,IAAiBvc,OAAOwc,MAAMD,GAAM,CACtC,MAAME,EAAaX,YAAYlZ,MAAQ,EACjC8Z,EAAW1c,OAAO2c,UAAUJ,GAAOA,EAAME,EAAaF,EAM5D,OALAlB,EAAUqB,QACLlB,EAAWhb,UACd+a,EAAgBE,KAChBD,EAAWhb,SAAU,GAGzB,CACF,CAEA,MAAMoc,EAAKd,YAAoBe,OAC/B,GAAID,GAAKA,EAAEE,gBAAiB,CAC1B,MAAMC,GAAcjB,YAAYkB,YAAcva,KAAKG,OAASkZ,YAAYlZ,MACxE,IAAI2Z,EAAMQ,EAAaH,EAAEE,gBAEzB,GAAIF,EAAEV,cAAgBU,EAAEV,aAAe,EAAG,CACxC,MAAMe,EAAUL,EAAEV,aAAeU,EAAEE,gBAEnCP,EAAMU,GADuBF,EAAata,KAAKG,MAEjD,CAEA,MAAM6Z,EAAaX,YAAYlZ,MAAQ,EACjC8Z,EAAW1c,OAAO2c,UAAUJ,GAAOA,EAAME,EAAaF,EAM5D,OALAlB,EAAUqB,QACLlB,EAAWhb,UACd+a,EAAgBE,KAChBD,EAAWhb,SAAU,GAGzB,CAEA,MAAM0c,EAAOpB,YAAYlZ,MACzByY,EAAU6B,GACL1B,EAAWhb,UACd+a,EAAgBE,KAChBD,EAAWhb,SAAU,EAEzB,CAAE,MAAO6D,GACP,GAED,IAGHlE,oBAAU,KACR,MAAMgd,EAASpb,SAASqb,cAAc,UACtCD,EAAOzX,IAAM,eACbyX,EAAOvU,OAAQ,EACf7G,SAASkL,KAAKoQ,YAAYF,GAG1B,MAAMG,EAAcvb,SAASqb,cAAc,UAK3C,OAJAE,EAAY5X,IAAM,qBAClB4X,EAAY1U,OAAQ,EACpB7G,SAASkL,KAAKoQ,YAAYC,GAEnB,KACL,IACEvb,SAASkL,KAAKsQ,YAAYJ,GAC1Bpb,SAASkL,KAAKsQ,YAAYD,EAC5B,CAAE,MAAOjZ,GACP,IAGH,IAGHlE,oBAAU,KACR,MAAMgd,EAASpb,SAASqb,cAAc,UAMtC,OALAD,EAAOK,OAAQ,EACfL,EAAOzX,IAAM,mCACbyX,EAAOM,aAAa,kBAAmB,wCACvC1b,SAASkL,KAAKoQ,YAAYF,GAEnB,KACLpb,SAASkL,KAAKsQ,YAAYJ,KAE3B,IAGD7kB,cAACmiB,GAAa,CAAC9H,KAAK,OAAMja,SACxBoG,eAAC8b,GAAQ,CAAAliB,SAAA,CACPJ,cAAA,UACAwG,eAACqc,GAAU,CAAAziB,SAAA,CACToG,eAAA,OAAKU,UAAU,OAAM9G,SAAA,CACnBJ,cAACuiB,GAAQ,CAAC9b,KAAK,+BAA8BrG,SAAC,SAC3B,qBAAXohB,QAAwD,cAA7BA,OAAOnc,SAAS6N,UAAyD,cAA7BsO,OAAOnc,SAAS6N,SAyB3F,KAxBFlT,cAACwiB,GAAU,CACTjd,QAASA,KACP,IAEE,MAAM6f,EAAM5D,OAAe6D,SAC3B,IAAKD,EAEH,YADAzkB,QAAQC,KAAK,wBAGf,MAAM0kB,EAAOF,EAAGG,iBAChBH,EAAGG,iBAAmB,WAAc,OAAO,CAAK,EAChD,IACEH,EAAGI,QAAQC,QAAQ,CAAE/e,OAAQ+C,SAASkL,KAAM+Q,WAAW,EAAMC,QAAS,EAAGC,QAAS,EAAGpc,eAAgBA,QACvG,CAAE,MAAOuC,GACPpL,QAAQsQ,MAAM,4BAA6BlF,EAC7C,CACAqZ,EAAGG,iBAAmBD,CACxB,CAAE,MAAOvZ,GACPpL,QAAQsQ,MAAMlF,EAChB,GACA3L,SACH,qBAMLJ,cAAA,OAAKkH,UAAU,SAAQ9G,SACrBoG,eAACsL,KAAQ,CAAA1R,SAAA,CACPJ,cAACkgB,GAAO,CAAChf,KAAM,KACflB,cAAC6lB,KAAQ,CAAC9lB,MAAO,CAAE+gB,SAAU,OAAQ1gB,SAAC,iBAI1CJ,cAAA,OAAKkH,UAAU,QAAO9G,SACpBoG,eAACmc,GAAQ,CAAAviB,SAAA,CACK,OAAX0iB,EACG,MACE,MAAMgD,EAAU1C,KAAKC,MAAMP,GACrBiD,EAAe3C,KAAKC,MAAe,GAATP,GAAe,GACzCkD,EAAOhD,GAAgBG,IAC7B,MAAM,GAAN3a,OAAUsd,EAAO,KAAAtd,OAAIud,GAAYvd,OAAGwd,EACrC,EALD,GAMA,SAAK,IAAI,qBAMnBhmB,cAACqhB,GAAgB,QAIzB,C,OC3PO,MAAM4E,GAAInjB,IAAOkI,KACtBvL,IAAA,IAAC,MAAEyD,GAAOzD,EAAA,OAAK0D,YAAGR,QAAAC,YAAA,qKACFM,EAAMI,OAAOC,QACVL,EAAMiB,WAAWuS,aACrBxT,EAAMiB,WAAW+G,W,OCClC,MAAMgb,GAAapjB,IAAO+C,IACxBpG,IAAA,IAAC,MAAEyD,GAAOzD,EAAA,OAAK0D,YAAGR,QAAAC,YAAA,4EAELM,EAAMiB,WAAWyX,YACf1Y,EAAMiB,WAAWgV,aAI5BgN,GAAoC,CACxC3f,eAAC4N,KAAK,CAAAhU,SAAA,CAAC,iCACyBJ,cAACimB,GAAC,CAAA7lB,SAAC,MAAK,gBAExC,iDACAoG,eAAC4N,KAAK,CAAAhU,SAAA,CAAC,8CACsCJ,cAACimB,GAAC,CAAA7lB,SAAC,MAAK,YAErD,qEACA,yDACA,6DACAoG,eAAC4N,KAAK,CAAAhU,SAAA,CAAC,4HAEAJ,cAAC4G,IAAgB,OAExB,yEACA,oCACAJ,eAAC4N,KAAK,CAAAhU,SAAA,CAAC,sDAC8CJ,cAAComB,IAAS,IAAG,sCAElE5f,eAAC4N,KAAK,CAAAhU,SAAA,CAAC,WACGJ,cAAC2F,IAAU,IAAG,gEAExB,sDACA,4GACA,kGACA,8FACA,6DACA,4EACA,kEACA,iFACA,iGACA,uFACA,iGACA,+DACA,2DACA,2CACA,sHACA,+DACA,sEACA,oDACA,uEACA,4HAGI0gB,GAAeA,IAAMF,GAAKG,YAAYH,GAAK7mB,SAElC,SAASinB,KACtB,MAAOC,EAAKC,GAAU9hB,IAAMiF,SAASyc,MAC/BK,EAAU/hB,IAAMnF,YAAY,IAAMinB,EAAOJ,MAAiB,IAEhE,OACErmB,cAACkmB,GAAU,CAAC7L,KAAK,OAAO9U,QAASmhB,EAAQtmB,SACvB,kBAARomB,EAAmBxmB,cAACoU,KAAK,CAAAhU,SAAEomB,IAAeA,GAGxD,C,UC/DA,MAAM5gB,GAAU9C,YAAOgP,KAAPhP,CACdrD,IAAA,IAAC,MAAEyD,GAAOzD,EAAA,OAAK0D,YAAGR,QAAAC,YAAA,8EACd6T,IAESvT,EAAMiB,WAAWyX,YACf1Y,EAAMiB,WAAWgV,aAI5BhF,GAAUrR,IAAO+C,IAAGjC,QAAAhB,YAAA,gBACtBmR,KAGW,SAAS4S,KACtB,MAAMrc,EAAM,IAAIH,KAEhB,OAAuB,KAAnBG,EAAIsc,YAAqBtc,EAAIuc,WAAa,GAE1C7mB,cAAC4F,GAAO,CAAAxF,SACNoG,eAAC2N,GAAO,CAAA/T,SAAA,CACNoG,eAACsL,KAAQ,CAAA1R,SAAA,CACPJ,cAAC8mB,IAAU,CAAC5lB,KAAK,OACjBlB,cAAC+mB,KAAU,CAAA3mB,SAAC,mBAEdJ,cAAA,KAAAI,SAAG,mDAKJ,IACT,C,OChCA,MAAM4mB,GAAclkB,IAAO+C,IACzBpG,IAAA,IAAC,MAAEyD,GAAOzD,EAAA,OAAK0D,YAAGR,QAAAC,YAAA,gKACdmR,IAEW7Q,EAAMiB,WAAWgV,UAGjBjW,EAAMiB,WAAWC,cAQnB,SAAS6iB,KACtB,OACEzgB,eAACwgB,GAAW,CAAA5mB,SAAA,CACVJ,cAAC2mB,GAAe,IAChB3mB,cAACumB,GAAS,MAGhB,C,OCpBA,MAAMW,GAAiBpkB,YAAO6Y,KAAP7Y,CAAaH,QAAAC,YAAA,8BAIrB,SAASukB,KACtB,MAAOC,EAAYC,GAAoBpN,cACjCqN,EAAQvd,YAAYwd,KAEpBC,EAAiBJ,EAAaE,EAAMG,iBAAmBnR,YAAYgR,GAEzE,OACE9gB,eAAC0gB,GAAc,CAACnS,GAAG,UAAUxP,QAAS8hB,EAAiBjnB,SAAA,CACpDonB,EAAe,aAGtB,C,sBCRuB1kB,IAAO+C,IAAGlD,QAAAC,YAAA,8BAC7Bgc,IACA5K,KACA6K,KAGc/b,YAAO6Y,KAAP7Y,CAAac,QAAAhB,YAAA,gBAC3BnD,IAAA,IAAC,MAAEyD,GAAOzD,EAAA,OAAK0D,YAAGE,QAAAT,YAAA,kCACHM,EAAMiB,WAAWyX,eAInB9Y,YAAOgZ,KAAPhZ,CAAeM,QAAAR,YAAA,yHAOnBE,IAAO4kB,IAAGnd,QAAA3H,YAAA,gDAnBvB,MAwBM+kB,GAAO7kB,IAAO+C,IAClBjG,IAAA,IAAC,MAAEsD,GAAOtD,EAAA,OAAKuD,YAAG2H,QAAAlI,YAAA,8NAIFM,EAAMiB,WAAWyX,YACd1Y,EAAMiB,WAAWyX,eAgBvB,SAASgM,GAAYvnB,GAA6D,IAA5D,OAAEI,EAASuI,IAAK,WAAExI,EAAU,MAAET,GAA2BM,EAC5F,MAAMinB,EAAQvd,YAAYwd,KAQ1B,OAJA1f,oBAAU,KACRyf,EAAQ,GAAK7mB,KACZ,CAAC6mB,EAAO7mB,IAGT+F,eAAA,OAAK/F,OAAQA,EAAQ4B,IAAK7B,EAAYT,MAAOA,EAAOsa,KAAK,MAAKja,SAAA,CAC5DJ,cAACpB,GAAM,IACPoB,cAAC2nB,GAAI,CAAAvnB,SACHJ,cAAA,OAAKoN,IAAI,4GAA4GC,IAAI,WAE3HrN,cAAC8e,GAAY,CAACre,OAAQA,IACrB6mB,EAAQ,EAAItnB,cAACmnB,GAAY,IAAMnnB,cAACinB,GAAiB,MAGxD,C,wCCxEe,SAASY,KAGtB,OAFiBC,cAEJxiB,WAAaH,IAAUC,QAC3BpF,cAAC+nB,GAAkB,IAEnB/nB,cAACgoB,GAAc,GAE1B,CAEA,SAASA,KACP,MAAMC,EAAWtjB,IAAMnF,YAAY,IAAMgiB,OAAO0G,SAAS,EAAG,GAAI,IAEhE,OACE1hB,eAACgV,IAAW,CAACjW,QAAS0iB,EAAS7nB,SAAA,CAC7BJ,cAACmoB,IAAO,IAAG,wBAGjB,CAEA,SAASJ,KACP,OACE/nB,cAACooB,KAAI,CAACC,GAAIljB,IAAUmjB,OAAOloB,SACzBoG,eAACgV,IAAW,CAAApb,SAAA,CACVJ,cAACmoB,IAAO,IAAG,0BAInB,CCpBA,MAAMI,GAAMzlB,IAAO+C,IACjBpG,IAAA,IAAC,MAAEyD,GAAOzD,EAAA,OAAK0D,YAAGR,QAAAC,YAAA,8BACLM,EAAMiB,WAAWC,cAI1BokB,GAAgB1lB,YAAOgZ,KAAPhZ,CACpBlD,IAAA,IAAC,MAAEsD,GAAOtD,EAAA,OAAKuD,YAAGS,QAAAhB,YAAA,4EACHM,EAAMiB,WAAWgV,aAM5BsP,GAAc3lB,YAAOmK,KAAPnK,CAAiBO,QAAAT,YAAA,+BAItB,SAAS8lB,GAAgBroB,GAA6D,IAA5D,OAAEI,EAASuI,IAAK,WAAExI,EAAU,MAAET,GAA2BM,EAChG,OACEL,cAACuoB,GAAG,CAACxoB,MAAOA,EAAOsC,IAAK7B,EAAYC,OAAQA,EAAQ4Z,KAAK,MAAKja,SAC5DJ,cAACd,GAAU,KAGjB,CAEO,SAASA,KACd,MAAMypB,EAAU5e,YAAY6e,KACtBC,EAAsBlX,kBAC1B,IACEgX,EAAQG,OAAO,CAACC,EAAQC,KACtBD,EAAOC,EAAMve,MAAK/J,wBAAA,GAAQsoB,GAAK,IAAElR,MAAO,KACjCiR,GACN,CAAC,GACN,CAACJ,IAEGtQ,EAAYC,eAElB,OACE9R,eAACgiB,GAAa,CAAApoB,SAAA,CACZJ,cAACyoB,GAAW,CAACrb,IAAK6b,KAAqB5b,IAAI,kCAC3CrN,cAACkpB,KAAc,IACflpB,cAAC+mB,KAAU,CAAA3mB,SAAC,8BACZJ,cAAA,KAAAI,SAAG,gCACFuoB,EAAQrpB,OAAS,GAChBkH,eAAAiF,WAAA,CAAArL,SAAA,CACEJ,cAAA,KAAAI,SAAG,6BACHJ,cAAC+W,KAAO,CAACS,KAAMqR,EAAqBhQ,WAAYR,EAAWU,UAAW/P,IAAO4P,UAAQ,OAGzF5Y,cAAC6nB,GAAiB,MAGxB,C,gBC/DA,MAAMjiB,GAAU9C,IAAO+C,IAAGlD,QAAAC,YAAA,oDAKX,SAASumB,GAAiB1pB,GAA6D,IAA5D,OAAEgB,EAASuI,IAAK,WAAExI,EAAU,MAAET,GAA2BN,EACjG,OACEO,cAAC4F,GAAO,CAACnF,OAAQA,EAAQ4B,IAAK7B,EAAYT,MAAOA,EAAOsa,KAAK,MAAKja,SAChEJ,cAACopB,KAAW,KAGlB,C,UCbO,MAAMC,GAAavmB,IAAO+C,IAAGlD,QAAAC,YAAA,qDAChCgc,KAKiC9b,YAAOumB,GAAPvmB,CAAkBc,QAAAhB,YAAA,gBACnDoR,M,OCPJ,MAAMsV,GAAcxmB,IAAOC,MAAKJ,QAAAC,YAAA,uDAC5B+a,K,mBCGJ,MAAM4L,GAAUzmB,IAAO+C,IACrBpG,IAAA,IAAC,MAAEyD,GAAOzD,EAAA,OAAK0D,YAAGR,QAAAC,YAAA,yMACd4mB,IAIStmB,EAAMiB,WAAWC,WAEflB,EAAMiB,WAAWgV,aAI5BsQ,GAAO3mB,IAAO+C,IAAGjC,QAAAhB,YAAA,kEAKjB8mB,GAAQ5mB,IAAO+C,IAAGxC,QAAAT,YAAA,oEAMlB+mB,GAAa7mB,YAAO8mB,IAAP9mB,CAAqBM,QAAAR,YAAA,8BAIlCinB,GAAgB/mB,YDyBf,SAA0BnE,GAC/B,MAAM,MAAEgJ,EAAK,SAAEmY,EAAQ,UAAE5Y,EAAS,IAAE0B,EAAG,IAAEC,EAAG,KAAEZ,GAAStJ,GAChDmrB,EAAeC,GAAoBngB,mBAASjC,EAAMS,YAEzDP,oBAAU,KACRkiB,EAAiBpiB,EAAMS,aACtB,CAACT,IAEJ,MAAMR,EAAiD3H,sBAAaoF,IAClEmlB,EAAiBnlB,EAAM8B,OAAOiB,QAC7B,IAEGwV,EAAS3d,sBAAY,KACzBsgB,EAASpY,OAAOoiB,KACf,CAACA,EAAehK,IAEbkK,EAAcxqB,sBAAaoF,IACb,UAAdA,EAAM/E,KACR+E,EAAM8B,OAAO2W,QAEd,IAEH,OACErd,cAACspB,GAAW,CACV3gB,KAAK,SACLC,IAAKA,EACLC,IAAKA,EACLZ,KAAMA,EACNN,MAAOmiB,EACP3iB,SAAUA,EACVgW,OAAQA,EACRI,UAAWyM,EACX9iB,UAAWA,GAGjB,EC5DsBpE,CAAwByH,QAAA3H,YAAA,8BAS/B,SAASqnB,GAAetrB,GACrC,MAAM,YAAEurB,EAAW,SAAEC,GAAaxrB,EAE5ByrB,EAAWrgB,YAAYsgB,KAEvBC,EAAmB9qB,sBAAa+qB,GAA6BJ,EAASziB,OAAO6iB,IAAW,CAACJ,IACzFK,EAAkDhrB,sBAAY,IAAM2qB,EAAS,GAAI,CAACA,IAClFM,EAAiDjrB,sBAAY,IAAM2qB,EAASC,GAAW,CAACD,EAAUC,IAClGM,EAAqDlrB,sBACzD,IAAM2qB,EAASD,EAAc,GAC7B,CAACA,EAAaC,IAEVQ,EAAiDnrB,sBACrD,IAAM2qB,EAASD,EAAc,GAC7B,CAACA,EAAaC,IAKhB,OACE3jB,eAAC+iB,GAAO,CAACriB,UAAU,kBAAiB9G,SAAA,CAClCoG,eAACijB,GAAI,CAAArpB,SAAA,CACF8pB,EAAc,GACblqB,cAAC2pB,GAAU,CAACpkB,QAASilB,EAAWhlB,MAAM,aAAYpF,SAAC,MAIpD8pB,EAAc,GACblqB,cAAC2pB,GAAU,CAACpkB,QAASmlB,EAAcllB,MAAM,gBAAepF,SACrD8pB,EAAc,OAIrBlqB,cAAC6pB,GAAa,CAACliB,MAAOuiB,EAAapK,SAAUwK,EAAkB1hB,IAAK,EAAGC,IAAKuhB,EAAUniB,KAAM,IAC5FzB,eAACkjB,GAAK,CAAAtpB,SAAA,CACH8pB,EAAcE,GACbpqB,cAAC2pB,GAAU,CAACpkB,QAASolB,EAAUnlB,MAAM,YAAWpF,SAC7C8pB,EAAc,IAGlBA,EAAcE,EAAW,GACxBpqB,cAAC2pB,GAAU,CAACpkB,QAASklB,EAAUjlB,MAAM,YAAWpF,SAC7CgqB,SAMb,C,OCtFA,MAAMQ,GAAuB9nB,YAAOumB,GAAPvmB,CAC3BrD,IAAA,IAAC,MAAEyD,GAAOzD,EAAA,OAAK0D,YAAGR,QAAAC,YAAA,qCACEM,EAAMiB,WAAWC,cAgBxB,SAASymB,GAAWlsB,GACjC,MAAM,OAAEyjB,EAAM,MAAEvjB,EAAK,cAAEG,EAAa,YAAEkrB,EAAW,SAAEC,GAAaxrB,EAE1DmsB,EAAoBtrB,sBACvBmI,IACCwiB,EAASxiB,GACT8B,SAASshB,uBAAuB,mBAAmB,GAAGC,kBAExD,CAACb,IAGH,OACE3jB,eAACokB,GAAoB,CAAAxqB,SAAA,CAClBgiB,EACAvjB,GAASA,EAAMS,OAAS,GACvBkH,eAAAiF,WAAA,CAAArL,SAAA,CACEJ,cAACiqB,GAAc,CAACC,YAAaA,EAAaC,SAAUA,IAC9C,OAALtrB,QAAK,IAALA,OAAK,EAALA,EAAO2U,IAAI,CAACyX,EAAMvrB,IACjBM,cAAChB,EAAa0B,YAAA,CAAehB,MAAOA,GAAWurB,GAA3BA,EAAKlW,KAE3B/U,cAACiqB,GAAc,CAACC,YAAaA,EAAaC,SAAUW,SAK9D,CC1Be,SAASI,KACtB,MAAO/rB,EAAWgsB,GAAcvhB,oBAAS,GAEnCtF,EAAWC,cACX6mB,EAAarhB,YAAYshB,MACxBC,EAAaC,GAAkB3hB,oBAAU,GAE1C4hB,EAAUzhB,YAAY0hB,KACtBC,EAAQ3hB,YAAY4hB,KACpBC,EAAe7hB,YAAY8hB,KAC3BC,EAAgB/hB,YAAYgiB,KAC5BC,EAAWjiB,YAAYkiB,KACvBC,EAAaniB,YAAYoiB,KAEzBltB,EAAWO,sBAAY,KAC3B2rB,GAAW,GACX7mB,EAAS8nB,gBACR,CAAC9nB,IAEE6lB,EAAW3qB,sBACdE,IACCyrB,GAAW,GACX7mB,EAASoW,YAAWhb,KAEtB,CAAC4E,IAGHK,IAAMkD,UAAU,KACV1I,GAAaqsB,EAAUF,IACzBH,GAAW,GACXI,GAAe,IAAIphB,MAAOC,aAE3B,CAACjL,EAAWmsB,EAAaE,IC/CvB,SAAmCa,GACxC,MAAM7nB,EAAUC,cAChBE,IAAMkD,UAAU,KACd,GAAIrD,EAAQa,SAASgnB,OAASA,EAAM,CAClC,MAAMpiB,EAAWA,KACfzF,EAAQU,KAAK,CAAEI,SAAUd,EAAQa,SAASC,SAAU+mB,UAGtD,OADA5iB,SAAS3B,iBAAiB,SAAUmC,EAAU,CAAEoF,SAAS,EAAMid,MAAM,IAC9D,IAAM7iB,SAAS1B,oBAAoB,SAAUkC,EACtD,GACC,CAACoiB,EAAM7nB,GACZ,CDsCE+nB,CAA0B,YEnDrB,IAAsB/mB,EF2H3B,OE3H2BA,EFsDDgnB,MACxB,MAAMC,EAAQ9Y,OAAOC,KAAKwX,GAAc,CAAC,GACzC,IAAKqB,GAA0B,IAAjBA,EAAMntB,OAAc,MAAO,UACzC,MAAMotB,EAASD,EACZjZ,IAAKkQ,GAAMiJ,mBAAmBjJ,GAAGkJ,QAAQ,KAAM,MAC/CC,KAAK,KACR,MAAM,aAANrkB,OAAoBkkB,IAGTF,GE9Db7nB,IAAMkD,UAAU,KACd4B,SAASjE,MAAQA,GAChB,CAACA,IF+DJqC,oBAAU,KACR,IACE,MAAMwkB,EAAO7K,OAAOnc,SAASgnB,MAAQ,GAE/BS,EAAST,EAAKU,QAAQ,KAC5B,IAAgB,IAAZD,EAAe,CACjB,MACME,EADQ,IAAIC,gBAAgBZ,EAAKa,MAAMJ,EAAS,IAC9BK,IAAI,QAC5B,GAAIH,EAAW,CACCA,EAAU3a,MAAM,KAAKxD,OAAOue,SACpCzf,QAASuG,IAEb,MAAMmZ,EAAsB,MAATnZ,EAAE,GACfoZ,EAAMD,EAAanZ,EAAEgZ,MAAM,GAAKhZ,EAChCzJ,EAAOkiB,mBAAmBW,GAC1BrW,EAAWoW,EAAa,IAAM,IACpC/oB,EAASqU,YAAO,CAAElO,OAAMqN,MAAO,GAAIb,eAEvC,CACF,CACF,CAAE,MAAOlL,GACP,GAID,IAGHlE,oBAAU,KACR,IACE,MAAM6F,EAAUiG,OAAO4Z,OAAOnC,GAAc,CAAC,GAAG5X,IAAK8Q,IACnD,MAAMkJ,EAA8B,MAAvBlJ,EAAUrN,SAAmB,IAAM,GAChD,MAAM,GAANzO,OAAUglB,GAAGhlB,OAAGilB,mBAAmBC,aAAkBpJ,EAAU7Z,UAEjE,GAAuB,IAAnBiD,EAAQpO,OAAc,OAC1B,MAAMquB,EAAUjgB,EAAQmf,KAAK,KAGvBla,GADO6O,OAAOnc,SAASgnB,MAAQ,MACnBha,MAAM,KAAK,GAC7BmP,OAAOhd,QAAQopB,aAAa,KAAM,GAAG,GAADplB,OAAKmK,EAAI,UAAAnK,OAASmlB,GACxD,CAAE,MAAO5hB,GACP,GAED,CAACqf,IAGJzmB,IAAMkD,UAAU,KACd,MAAM4kB,EAAQ9Y,OAAOC,KAAKwX,GAAc,CAAC,GACnCrW,EAAK3F,WAAW,KAChBqd,EAAMntB,OAAS,GACjBgF,EAASoW,YAAW,KAErB,KAEH,MAAO,IAAMvL,aAAa4F,IACzB,CAACqW,EAAY9mB,IAGdtE,cAAAyL,WAAA,CAAArL,SACqB,oBAAlB0rB,EACC9rB,cAACtB,EAAc,CACbE,OAAQgpB,GACR1oB,WAAYwpB,GACZ7pB,MAAO6sB,EACP5sB,YAAaqqB,GACbpqB,YAAa6sB,EACb5sB,cAAewa,GACfva,SAAUA,EACVE,UAAWA,IAGba,cAAC6qB,GAAU,CACTzI,OAAQpiB,cAAC4nB,GAAY,IACrBoE,SAAUA,EACV9B,YAAagC,EACb2B,aAAcjC,EACdzB,SAAUA,EACVnrB,cAAewa,GACfra,UAAWA,EACXN,MAAO6sB,KAKjB,C","file":"static/js/4.c8f1da03.chunk.js","sourcesContent":["import React, { useCallback } from 'react'\nimport {\n  AutoSizer,\n  CellMeasurer,\n  CellMeasurerCache,\n  IndexRange,\n  InfiniteLoader,\n  List,\n  WindowScroller,\n} from 'react-virtualized'\nimport LayoutElementProps from '../LayoutElementProps'\n\nconst cache = new CellMeasurerCache({\n  fixedWidth: true,\n})\n\ninterface InfiniteColumnProps<T> {\n  Header?: (props: LayoutElementProps) => JSX.Element\n  OutOfItems?: (props: LayoutElementProps) => JSX.Element\n  items?: T[]\n  LoadingItem: (props: LayoutElementProps) => JSX.Element\n  hasMoreRows: boolean\n  loadMore: () => void\n  ItemComponent: (props: T & LayoutElementProps & { index: number }) => JSX.Element\n  isLoading: boolean\n}\n\nexport default function InifinteColumn<T>(props: InfiniteColumnProps<T>) {\n  const { Header, items = [], LoadingItem, hasMoreRows, ItemComponent, loadMore, OutOfItems, isLoading } = props\n\n  const prependedRows = Header ? 1 : 0\n  const loadingRows = 1\n  const rowCount = items.length + prependedRows + loadingRows\n\n  const isRowLoaded = useCallback(\n    ({ index }: { index: number }) => index < prependedRows + items.length + (hasMoreRows ? 0 : 1),\n    [hasMoreRows, items.length, prependedRows]\n  )\n\n  const rowRenderer = useCallback(\n    ({ index, key, parent, style }: { index: number; key: any; parent: any; style: any }) => {\n      return (\n        <CellMeasurer cache={cache} columnIndex={0} key={key} rowIndex={index} parent={parent}>\n          {({ measure, registerChild }) => {\n            // Index 0\n            if (Header && index < prependedRows) {\n              return <Header style={style} virtualRef={registerChild} onLoad={measure} />\n            }\n\n            // Index 1\n            if (index < prependedRows + items.length) {\n              return (\n                <ItemComponent\n                  style={style}\n                  virtualRef={registerChild}\n                  onLoad={measure}\n                  index={index - prependedRows}\n                  {...items[index - prependedRows]}\n                />\n              )\n            }\n\n            // Index 2\n            if (index < prependedRows + items.length + loadingRows) {\n              return hasMoreRows || isLoading ? (\n                <LoadingItem style={style} virtualRef={registerChild} onLoad={measure} />\n              ) : OutOfItems && items.length > 0 ? (\n                <OutOfItems style={style} virtualRef={registerChild} onLoad={measure} />\n              ) : (\n                <div></div>\n              )\n            }\n\n            console.warn('index not found / out of bounds. INDEX:', index)\n            return null\n          }}\n        </CellMeasurer>\n      )\n    },\n    [Header, prependedRows, items, ItemComponent, hasMoreRows, isLoading, LoadingItem, OutOfItems]\n  )\n\n  const loadMoreRows = useCallback(\n    (params: IndexRange) => {\n      if (!isLoading && hasMoreRows) {\n        loadMore()\n      }\n\n      return Promise.resolve()\n    },\n    [hasMoreRows, isLoading, loadMore]\n  )\n\n  const handleResize = useCallback((size) => {\n    cache.clearAll()\n  }, [])\n\n  return (\n    <InfiniteLoader isRowLoaded={isRowLoaded} loadMoreRows={loadMoreRows} rowCount={rowCount}>\n      {({ onRowsRendered, registerChild }) => {\n        return (\n          <AutoSizer onResize={handleResize} disableHeight>\n            {({ width }) => {\n              return (\n                <WindowScroller>\n                  {({ height, isScrolling, onChildScroll, scrollTop }) => {\n                    return (\n                      <List\n                        autoHeight\n                        height={height}\n                        isScrolling={isScrolling}\n                        onScroll={onChildScroll}\n                        scrollTop={scrollTop}\n                        ref={registerChild}\n                        onRowsRendered={onRowsRendered}\n                        rowRenderer={rowRenderer}\n                        deferredMeasurementCache={cache}\n                        overscanRowCount={10}\n                        rowCount={items.length + prependedRows + loadingRows}\n                        rowHeight={cache.rowHeight}\n                        width={width}\n                      />\n                    )\n                  }}\n                </WindowScroller>\n              )\n            }}\n          </AutoSizer>\n        )\n      }}\n    </InfiniteLoader>\n  )\n}\n","import { keyframes } from 'styled-components'\n\nexport const fadeOut = keyframes`\n  from {\n    opacity: 1;\n  }\n\n  to {\n    opacity: 0;\n  }\n`\n","import styled, { DefaultTheme, css } from 'styled-components'\n\nfunction thumbStyle({ $controls, theme }: { $controls: boolean; theme: DefaultTheme }) {\n  const commonStyle = css`\n    height: 16px;\n    width: 16px;\n    border-radius: 100px;\n    background: ${$controls ? theme.colors.backgroundColor2 : 'transparent'};\n    cursor: pointer;\n  `\n\n  return css`\n    &::-webkit-slider-thumb {\n      -webkit-appearance: none;\n      ${commonStyle}\n    }\n\n    &::-moz-range-thumb {\n      ${commonStyle}\n    }\n\n    &::-ms-thumb {\n      ${commonStyle}\n    }\n  `\n}\n\nfunction trackStyle({ $accent, theme }: { $accent: boolean; theme: DefaultTheme }) {\n  return css`\n    -webkit-appearance: none;\n    flex-grow: 1;\n    background: ${(props) => props.theme.colors.layerBg};\n    border-radius: 100px;\n    height: 6px;\n\n    &::-moz-range-progress {\n      background-color: ${$accent ? theme.colors.accentColor : theme.colors.backgroundColor2};\n    }\n\n    &::-ms-fill-lower {\n      background-color: ${$accent ? theme.colors.accentColor : theme.colors.backgroundColor2};\n    }\n  `\n}\n\nexport const Slider = styled.input(\n  ({ $controls, $accent, theme }: { $controls: boolean; $accent: boolean; theme: DefaultTheme }) => css`\n    ${trackStyle({ $accent, theme })}\n    ${thumbStyle({ $controls, theme })}\n  `\n)\n","import React, { MouseEventHandler } from 'react'\nimport styled from 'styled-components'\n\ninterface PlayPauseIconProps {\n  className?: string\n  isPaused: boolean\n  onClick: MouseEventHandler<SVGElement>\n}\n\nconst MorphSvg = styled.svg`\n  > rect {\n    transition: all 0.2s ease-in;\n  }\n\n  &.play {\n    .left {\n      clip-path: path('M1.61 0 L10.1 4.9 L10.1 19.1 L1.61 24');\n    }\n\n    .right {\n      clip-path: path('M22.39 12 L9.9 4.79 L9.9 19.21 L22.39 12');\n    }\n  }\n\n  &.pause {\n    .left {\n      clip-path: path('M4.8 0 L10 0 L10 24 L4.8 24');\n    }\n\n    .right {\n      clip-path: path('M19.2 0 L14 0 L14 24 L19.2 24');\n    }\n  }\n`\n\n/**\n * A button that fluidly transforms between a Play and a Pause icon based on isPaused.\n * Use onClick to update isPaused.\n * Additionally, this component takes a classname\n */\nexport function PlayPauseIcon(props: PlayPauseIconProps) {\n  const { onClick, className = '', isPaused } = props\n\n  return (\n    <MorphSvg\n      name='Play/Pause'\n      viewBox='0 0 24 24'\n      xmlns='http://www.w3.org/2000/svg'\n      onClick={onClick}\n      className={`${className} ${isPaused ? 'play' : 'pause'}`}\n    >\n      <rect className='left' color='currentColor' x='0' y='0' width='24' height=' 24' />\n      <rect className='right' color='currentColor' x='0' y='0' width='24' height=' 24' />\n    </MorphSvg>\n  )\n}\n","import React from 'react'\nimport { useDispatch } from 'react-redux'\nimport { useHistory } from 'react-router-dom'\nimport styled, { css } from 'styled-components'\nimport { RouteName } from '../../data/types'\nimport { ExpandIcon, CloseIcon } from '../../icons/FontAwesomeIcons'\nimport { scrollToPost, setFullscreenPost } from '../../redux/actions'\nimport { dropShadow } from '../../styled/mixins/shadow'\nimport { InvisButton } from '../designsystem/Buttons'\n\nconst ToggleButton = styled(InvisButton)(\n  ({ theme }) => css`\n    grid-area: 1/1/2/2;\n    place-self: start start;\n    ${dropShadow}\n    padding: ${theme.dimensions.bigSpacing};\n    cursor: pointer;\n  `\n)\n\ninterface ToggleFullscreenButtonProps {\n  index: number\n}\n\nexport default function ToggleFullscreenButton(props: ToggleFullscreenButtonProps) {\n  const { index } = props\n\n  const dispatch = useDispatch()\n  const history = useHistory()\n\n  const onFullscreenExit = React.useCallback<React.MouseEventHandler>(\n    (event) => {\n      event.stopPropagation()\n      history.goBack()\n      dispatch(scrollToPost(index))\n    },\n    [dispatch, history, index]\n  )\n\n  const onFullscreenEnter = React.useCallback<React.MouseEventHandler>(\n    (event) => {\n      event.stopPropagation()\n      dispatch(setFullscreenPost(index))\n      history.push(RouteName.STORIES)\n    },\n    [dispatch, history, index]\n  )\n\n  return history.location.pathname === RouteName.STORIES ? (\n    <ToggleButton onClick={onFullscreenExit} aria-label='Exit fullscreen' title='Exit fullscreen'>\n      <CloseIcon color='white' />\n    </ToggleButton>\n  ) : (\n    <ToggleButton onClick={onFullscreenEnter} aria-label='Enter fullscreen' title='Enter fullscreen'>\n      <ExpandIcon color='white' />\n    </ToggleButton>\n  )\n}\n","import React from 'react'\nimport styled, { css } from 'styled-components'\nimport { download } from '../../data/utils'\nimport { DownloadIcon, ExternalLinkIcon } from '../../icons/FontAwesomeIcons'\nimport { flexRowWithGap } from '../../styled/mixins/layout'\nimport { dropShadow } from '../../styled/mixins/shadow'\nimport { InvisButton } from '../designsystem/Buttons'\n\nconst Wrapper = styled.div`\n  grid-area: 3/1/4/2;\n  ${flexRowWithGap}\n  place-self: end start;\n  place-items: start center;\n`\n\nconst LinkButton = styled.a(\n  ({ theme }) => css`\n    padding: ${theme.dimensions.bigSpacing};\n    cursor: pointer;\n    ${dropShadow({ theme })}\n\n    svg {\n      transition: all ${theme.timings.transitionTime} ease-out;\n    }\n  `\n)\n\nconst DownloadButton = styled(InvisButton)`\n  cursor: pointer;\n`\n\ninterface LinkListProps {\n  fullSrc: string\n}\n\nexport default function LinkList(props: LinkListProps) {\n  const { fullSrc } = props\n\n  const handleDownload = React.useCallback<React.MouseEventHandler>(\n    (event) => {\n      event.stopPropagation()\n      download(fullSrc)\n    },\n    [fullSrc]\n  )\n\n  return (\n    <Wrapper>\n      <LinkButton href={fullSrc} target='_blank' rel='noopener noreferrer' aria-label='Open In New Tab' title={fullSrc}>\n        <ExternalLinkIcon color='white' title='Open image in new tab' />\n      </LinkButton>\n\n      <DownloadButton aria-label='Download Image' onClick={handleDownload} title={fullSrc}>\n        <DownloadIcon color='white' />\n      </DownloadButton>\n    </Wrapper>\n  )\n}\n","import styled, { css } from 'styled-components'\nimport { fadeOut } from '../../styled/animations'\nimport { formatDuration } from '../../misc/formatting'\nimport { ProgressBar } from './ProgressBar'\nimport { PlayPauseIcon } from '../../icons/PlayPauseIcon'\nimport ToggleFullscreenButton from './ToggleFullscreenButton'\nimport LinkList from './LinkList'\nimport React, { useCallback } from 'react'\nimport FullscreenProgressBar from './FullscreenProgressBar'\nimport { BackwardIcon, ForwardIcon } from '../../icons/FontAwesomeIcons'\nimport { dropShadow } from '../../styled/mixins/shadow'\n\nfunction overlayVisibility({ isVisible }: { isVisible: boolean }) {\n  return isVisible\n    ? css``\n    : css`\n        opacity: 0;\n        animation: ${fadeOut} 0.4s ease-in;\n      `\n}\n\nconst Wrapper = styled.div`\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  grid-template-rows: auto 1fr auto auto;\n\n  ${overlayVisibility};\n`\n\nconst VideoProgressBar = styled(ProgressBar)(\n  ({ theme }) => css`\n    grid-area: 4/1/4/4;\n    margin: ${theme.dimensions.bigSpacing};\n  `\n)\n\nconst AutoProgressBar = styled(FullscreenProgressBar)(\n  ({ theme }) => css`\n    grid-area: 4/1/4/4;\n    margin: ${theme.dimensions.bigSpacing};\n  `\n)\n\nconst PlayButton = styled(PlayPauseIcon)`\n  height: 50px;\n  width: 50px;\n  grid-area: 2/2/3/3;\n  place-self: center center;\n  cursor: pointer;\n  fill: white;\n  ${dropShadow}\n`\n\nconst LengthDisplay = styled.span(\n  (props) => css`\n    grid-area: 3/3/4/4;\n    place-self: end end;\n    background: #00000080;\n    color: white;\n    border-radius: 4px;\n    padding: ${props.theme.dimensions.spacing};\n    margin: ${props.theme.dimensions.bigSpacing};\n  `\n)\n\nconst ForwardArea = styled.div`\n  display: grid;\n  grid-area: 2/3/3/4;\n  place-items: center;\n  opacity: 0;\n`\n\nconst BackwardArea = styled.div`\n  display: grid;\n  grid-area: 2/1/3/2;\n  place-items: center;\n  opacity: 0;\n`\n\ntype ImageOverlayProps = {\n  type: 'image'\n  index: number\n  fullSrc: string\n  isFullscreen: boolean\n  onFinished?: () => void\n  onBack?: () => void\n  isActive: boolean\n}\n\ntype GifOverlayProps = {\n  type: 'gif'\n  index: number\n  fullSrc: string\n  isPaused: boolean\n  onTogglePaused: React.MouseEventHandler\n  isFullscreen: boolean\n  onFinished?: () => void\n  onBack?: () => void\n  isActive: boolean\n}\n\ntype VideoOverlayProps = {\n  type: 'video'\n  index: number\n  fullSrc: string\n  isPaused: boolean\n  duration: number\n  onTogglePaused: React.MouseEventHandler\n  onSeek: (value: number) => void\n  videoRef: HTMLVideoElement | null\n  isFullscreen: boolean\n  onFinished?: () => void\n  onBack?: () => void\n  isActive: boolean\n}\n\ntype OverlayProps = (ImageOverlayProps | VideoOverlayProps | GifOverlayProps) & {\n  isVisible: boolean\n  setVisible: (value: boolean) => void\n}\n\nexport function ImageOverlay(props: Omit<ImageOverlayProps, 'type'>) {\n  const { index, fullSrc, isFullscreen, isActive, onFinished, onBack } = props\n\n  return (\n    <>\n      <ToggleFullscreenButton index={index} />\n      <LinkList fullSrc={fullSrc} />\n      {isFullscreen && <AutoProgressBar index={index} onFinished={onFinished} onBack={onBack} isActive={isActive} />}\n    </>\n  )\n}\n\nfunction GifOverlay(props: Omit<GifOverlayProps, 'type'>) {\n  const { fullSrc, isPaused, index, onTogglePaused, isFullscreen, isActive, onFinished, onBack } = props\n\n  return (\n    <>\n      <ToggleFullscreenButton index={index} />\n      <LinkList fullSrc={fullSrc} />\n      <PlayButton isPaused={isPaused} onClick={onTogglePaused} aria-label='Play/Pause' />\n      {isFullscreen && (\n        <AutoProgressBar index={index} isPaused={isPaused} onBack={onBack} onFinished={onFinished} isActive={isActive} />\n      )}\n      <LengthDisplay>GIF</LengthDisplay>\n    </>\n  )\n}\n\nfunction VideoOverlay(props: Omit<VideoOverlayProps, 'type'>) {\n  const { fullSrc, isPaused, index, onTogglePaused, onSeek, duration, videoRef, isActive, onFinished } = props\n\n  const handleSkipForward = useCallback(\n    (e) => {\n      e.preventDefault()\n      if (videoRef) {\n        onSeek(videoRef.currentTime + 10)\n      }\n    },\n    [onSeek, videoRef]\n  )\n\n  const handleSkipBackward = useCallback(\n    (e) => {\n      e.preventDefault()\n      if (videoRef) {\n        onSeek(videoRef.currentTime - 10)\n      }\n    },\n    [onSeek, videoRef]\n  )\n\n  return (\n    <>\n      <ToggleFullscreenButton index={index} />\n      <LinkList fullSrc={fullSrc} />\n      <BackwardArea onDoubleClick={handleSkipBackward}>\n        <BackwardIcon tabIndex={0} />\n      </BackwardArea>\n      <PlayButton isPaused={isPaused || !isActive} onClick={onTogglePaused} aria-label='Play/Pause' />\n      <ForwardArea onDoubleClick={handleSkipForward}>\n        <ForwardIcon tabIndex={0} />\n      </ForwardArea>\n      <LengthDisplay>{formatDuration(duration)}</LengthDisplay>\n      <VideoProgressBar isPaused={isPaused || !isActive} videoRef={videoRef} onChange={onSeek} onEnded={onFinished} />\n    </>\n  )\n}\n\nfunction getOverlayContent(props: OverlayProps) {\n  switch (props.type) {\n    case 'image':\n      return <ImageOverlay {...props} />\n    case 'gif':\n      return <GifOverlay {...props} />\n    case 'video':\n      return <VideoOverlay {...props} />\n  }\n}\n\nexport function Overlay(props: OverlayProps) {\n  const { isVisible, setVisible } = props\n\n  const toggleVisible = React.useCallback(() => setVisible(!isVisible), [isVisible, setVisible])\n\n  return (\n    <Wrapper\n      isVisible={isVisible}\n      onClick={toggleVisible}\n      data-testid='overlay-wrapper'\n      data-name='overlay'\n      className='overlay'\n    >\n      {getOverlayContent(props)}\n    </Wrapper>\n  )\n}\n","import React, { ChangeEventHandler, MouseEventHandler, useCallback } from 'react'\nimport { useTheme } from 'styled-components'\nimport { Slider } from '../designsystem/Slider'\n\ninterface ProgressBarProps {\n  isPaused: boolean\n  videoRef: HTMLVideoElement | null\n  onChange: (newValue: number) => void\n  className?: string\n  onEnded?: () => void\n}\n\nexport const ProgressBar = (props: ProgressBarProps) => {\n  const { isPaused, videoRef, className, onChange, onEnded } = props\n\n  const sliderRef = React.useRef<HTMLInputElement>(null)\n\n  const theme = useTheme()\n\n  const handleChange: ChangeEventHandler<HTMLInputElement> = useCallback(\n    (event) => {\n      const newValue = Number(event.target.value)\n      onChange(newValue)\n    },\n    [onChange]\n  )\n\n  const handleClick: MouseEventHandler = useCallback((event) => {\n    event.stopPropagation()\n  }, [])\n\n  React.useEffect(() => {\n    if (onEnded && videoRef) {\n      videoRef.addEventListener('ended', onEnded)\n\n      return () => videoRef.removeEventListener('ended', onEnded)\n    }\n  })\n\n  React.useEffect(() => {\n    if (!isPaused) {\n      let handle: number\n\n      const step = () => {\n        if (sliderRef?.current && videoRef) {\n          sliderRef.current.value = videoRef.currentTime.toString()\n          const chromePercentage = (videoRef.currentTime / videoRef.duration) * 100\n          sliderRef.current.style.backgroundImage = `linear-gradient(90deg, ${theme.colors.accentColor} ${chromePercentage}%, transparent ${chromePercentage}%)`\n        }\n\n        handle = requestAnimationFrame(step)\n      }\n\n      handle = requestAnimationFrame(step)\n\n      return () => {\n        cancelAnimationFrame(handle)\n      }\n    }\n  }, [isPaused, theme.colors.accentColor, theme.colors.backgroundColor2, videoRef])\n\n  return (\n    <Slider\n      ref={sliderRef}\n      type='range'\n      step={1}\n      min={0}\n      max={videoRef?.duration || 0}\n      onChange={handleChange}\n      className={className}\n      onClick={handleClick}\n      $controls\n      $accent\n    />\n  )\n}\n","import React from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { NO_OP } from '../../data/types'\nimport { setFullscreenPost } from '../../redux/actions'\nimport { selectAutoscrollDelay } from '../../redux/selectors'\nimport { Slider } from '../designsystem/Slider'\n\ninterface FullscreenProgressBarProps {\n  className?: string\n  index: number\n  isPaused?: boolean\n  onFinished?: () => void\n  onBack?: () => void\n  isActive: boolean\n}\n\nexport default function FullscreenProgressBar(props: FullscreenProgressBarProps) {\n  const { onFinished = NO_OP, onBack = NO_OP, isActive } = props\n\n  const keybinds: Record<string, () => void> = {\n    'ArrowRight' : () => onFinished(),\n    'ArrowLeft' : () => onBack()\n  }\n\n  React.useEffect(() => {\n    const handler = (event: KeyboardEvent) => {\n      const pressed = `${event.key}`;\n      if (pressed in keybinds) {\n        event.preventDefault()\n        event.stopPropagation()\n        keybinds[pressed]()\n      }\n    }\n    document.addEventListener('keydown', handler)\n    return () => document.removeEventListener('keydown', handler)\n  })\n\n  const dispatch = useDispatch()\n  const [mouseState, setMouseState] = React.useState(false)\n  const setPost = React.useCallback((newIndex) => dispatch(setFullscreenPost(newIndex)), [dispatch])\n  const duration = 1000 * useSelector(selectAutoscrollDelay)\n  const ref = React.useRef<HTMLInputElement>(null)\n\n  React.useEffect(() => {\n    const listener = () => setMouseState(true)\n    document.addEventListener('mousedown', listener)\n    document.addEventListener('touchstart', listener)\n\n    return () => {\n      document.removeEventListener('mousedown', listener)\n      document.removeEventListener('touchstart', listener)\n    }\n  })\n\n  React.useEffect(() => {\n    const listener = () => setMouseState(false)\n    document.addEventListener('mouseup', listener)\n    document.addEventListener('touchend', listener)\n\n    return () => {\n      document.removeEventListener('mouseup', listener)\n      document.removeEventListener('touchend', listener)\n    }\n  })\n\n  React.useEffect(() => {\n    if (!mouseState && isActive) {\n      let handle: number\n      let then = new Date().getTime()\n\n      const renderFrame = () => {\n        if (ref.current) {\n          const now = new Date().getTime()\n          const newValue = Number(ref.current.value) + (now - then)\n          then = now\n\n          ref.current.value = newValue.toString()\n          const chromePercentage = (newValue / duration) * 100\n          ref.current.style.backgroundImage = `linear-gradient(90deg, #ffffff80 ${chromePercentage}%, transparent ${chromePercentage}%)`\n\n          if (newValue >= Number(ref.current.max)) {\n            onFinished()\n            if (ref.current) {\n              ref.current.value = '0'\n            }\n          } else {\n            handle = requestAnimationFrame(renderFrame)\n          }\n        }\n      }\n\n      handle = requestAnimationFrame(renderFrame)\n\n      return () => {\n        cancelAnimationFrame(handle)\n      }\n    }\n  }, [duration, isActive, mouseState, onFinished, props.index, setPost])\n\n  return (\n    <Slider\n      ref={ref}\n      type='range'\n      step={1}\n      min={0}\n      max={duration}\n      onChange={NO_OP}\n      onClick={NO_OP}\n      $controls={false}\n      $accent={false}\n      className={props.className}\n    />\n  )\n}\n","import styled from 'styled-components'\nimport { flexMedia, preserveAspectRatio } from '../../styled/mixins/media'\n\nconst FlexVideo = styled.video`\n  ${flexMedia}\n  ${preserveAspectRatio}\n  grid-area: 1/1/2/2;\n`\n\nexport default FlexVideo\n","import styled from 'styled-components'\nimport { mediaStyle } from '../../../styled/mixins/media'\nimport FlexImage from '../../designsystem/FlexImage'\nimport FlexVideo from '../../designsystem/FlexVideo'\n\nexport const PostVideo = styled(FlexVideo)`\n  ${mediaStyle}\n`\n\nexport const PostImage = styled(FlexImage)`\n  ${mediaStyle}\n`\n","import React from 'react'\nimport { NO_OP } from '../../../data/types'\nimport { Overlay } from '../Overlay'\nimport { PostImage } from './StyledMedia'\n\ninterface PictureProps {\n  viewSrc: string\n  fullSrc: string\n  onLoad?: () => void\n  width: number\n  height: number\n  index: number\n  isFullscreen: boolean\n  onFinished?: () => void\n  onBack?: () => void\n  isActive: boolean\n}\n\nexport default function Picture(props: PictureProps) {\n  const { viewSrc, fullSrc, index, onLoad = NO_OP, width, height, isFullscreen, isActive, onFinished, onBack } = props\n\n  return (\n    <>\n      <PostImage\n        data-testid='image'\n        src={viewSrc}\n        alt={viewSrc}\n        onLoad={onLoad}\n        loading='lazy'\n        width={width}\n        height={height}\n      />\n      <Overlay\n        type='image'\n        fullSrc={fullSrc}\n        index={index}\n        isVisible={true}\n        setVisible={NO_OP}\n        isFullscreen={isFullscreen}\n        onFinished={onFinished}\n        onBack={onBack}\n        isActive={isActive}\n      />\n    </>\n  )\n}\n","import React from 'react'\n\n// List of handlers paired with the target element for identification\nlet handlers: Array<{ element: Element; update: (isOnScreen: boolean) => void }> = []\n\n// global handler that can handle multiple entires at the same time\nconst handleOnScreenChange = (entries: IntersectionObserverEntry[]) => {\n  entries.forEach((entry) => {\n    const handler = handlers.find((h) => h.element === entry.target)\n\n    if (handler) {\n      handler.update(entry.isIntersecting)\n    }\n  })\n}\n\n// single observer\nconst observer = new IntersectionObserver(handleOnScreenChange, { threshold: 1 })\n\n/**\n * Provides a boolean value indicating whether the {@link target} is fully visible on screen\n */\nexport default function useIsOnScreen(target: Element | null) {\n  const [isOnScreen, setOnScreen] = React.useState(false)\n\n  const onIsOnScreenChange = React.useCallback((value: boolean) => {\n    setOnScreen(value)\n  }, [])\n\n  React.useEffect(() => {\n    if (target) {\n      const handler = { element: target, update: onIsOnScreenChange }\n      handlers.push(handler)\n      observer.observe(target)\n\n      return () => {\n        handlers.filter((h) => h !== handler)\n        observer.unobserve(target)\n      }\n    }\n  }, [onIsOnScreenChange, target])\n\n  return [isOnScreen]\n}\n","import React from 'react'\n\nlet isScrollingGlobal = false\nlet observers: React.Dispatch<React.SetStateAction<boolean>>[] = []\nlet listener: ((e: any) => void) | undefined\nlet timeoutId: NodeJS.Timeout | undefined\n\nexport const useIsScrolling = () => {\n  const [isScrolling, setIsScrolling] = React.useState(isScrollingGlobal)\n\n  if (listener === undefined) {\n    listener = (e) => {\n      isScrollingGlobal = true\n      observers.forEach((update) => update(isScrollingGlobal))\n\n      if (timeoutId) clearTimeout(timeoutId)\n\n      timeoutId = setTimeout(() => {\n        isScrollingGlobal = false\n        observers.forEach((update) => update(isScrollingGlobal))\n      }, 500)\n    }\n    document.addEventListener('scroll', listener, { passive: true })\n  }\n\n  React.useEffect(() => {\n    observers.push(setIsScrolling)\n    setIsScrolling(isScrollingGlobal)\n    return () => {\n      observers = observers.filter((update) => update !== setIsScrolling)\n\n      if (observers.length === 0 && listener) {\n        document.removeEventListener('scroll', listener)\n        listener = undefined\n      }\n    }\n  }, [])\n\n  // return global isOnline state and setter function\n  return isScrolling\n}\n","import React from 'react'\nimport useIsOnScreen from './useIsOnScreen'\nimport { useIsScrolling } from './useIsScrolling'\n\nexport function useAutoplay(ref: Element | null) {\n  const [shouldPlay, setShouldPlay] = React.useState(false)\n\n  const [isOnScreen] = useIsOnScreen(ref)\n  const isScrolling = useIsScrolling()\n\n  React.useEffect(() => {\n    if (isOnScreen && !isScrolling) {\n      setShouldPlay(true)\n    }\n  }, [isOnScreen, isScrolling])\n\n  React.useEffect(() => {\n    if (!isOnScreen) {\n      setShouldPlay(false)\n    }\n  }, [isOnScreen])\n\n  return shouldPlay\n}\n","import React, { useEffect, useState } from 'react'\nimport { NO_OP } from '../../../data/types'\nimport MediaProps from './MediaProps'\nimport { Overlay } from '../Overlay'\nimport { PostImage } from './StyledMedia'\nimport { useSelector } from 'react-redux'\nimport { selectAutoPlay, selectPreloadGifs } from '../../../redux/selectors'\nimport { useAutoplay } from '../../../hooks/useAutoplay'\n\nexport default function Gif(props: MediaProps) {\n  const {\n    viewSrc,\n    thumbnailSrc,\n    fullSrc,\n    onLoad = NO_OP,\n    index,\n    width,\n    height,\n    detailsVisible,\n    isFullscreen,\n    onFinished,\n    isActive,\n  } = props\n\n  const [overlayVisible, setOverlayVisible] = React.useState(true)\n\n  // user play\n  const [playState, setPlayState] = useState(false)\n\n  // auto play\n  const [gifRef, setGifRef] = useState<HTMLImageElement | null>(null)\n  const prefAutoplay = useSelector(selectAutoPlay)\n  const autoPlay = useAutoplay(gifRef)\n  // Preloading\n  const preload = useSelector(selectPreloadGifs)\n\n  const usedSource = playState ? viewSrc : thumbnailSrc\n\n  const play = React.useCallback(async () => {\n    setPlayState(true)\n  }, [])\n\n  const pause = React.useCallback(() => {\n    setPlayState(false)\n  }, [])\n\n  const togglePlay: React.MouseEventHandler = React.useCallback(\n    (e) => {\n      e.stopPropagation()\n      if (playState) {\n        setPlayState(false)\n      } else {\n        setPlayState(true)\n        setOverlayVisible(false)\n      }\n    },\n    [playState]\n  )\n\n  React.useEffect(() => {\n    if (prefAutoplay || isFullscreen) {\n      if (autoPlay) {\n        setPlayState(true)\n        setOverlayVisible(false)\n      }\n    }\n\n    if (!autoPlay) {\n      setPlayState(false)\n    }\n  }, [autoPlay, isFullscreen, pause, play, prefAutoplay])\n\n  useEffect(() => {\n    if (preload) {\n      const loader = new Image()\n      loader.src = viewSrc\n    }\n  })\n\n  return (\n    <>\n      <PostImage\n        data-testid='gif'\n        ref={setGifRef}\n        src={usedSource}\n        alt={usedSource}\n        loading='lazy'\n        onLoad={onLoad}\n        width={width}\n        height={height}\n      />\n\n      <Overlay\n        isVisible={!playState || overlayVisible || detailsVisible}\n        setVisible={setOverlayVisible}\n        type='gif'\n        fullSrc={fullSrc}\n        index={index}\n        isPaused={!playState}\n        onTogglePaused={togglePlay}\n        isFullscreen={isFullscreen}\n        onFinished={onFinished}\n        isActive={isActive}\n      />\n    </>\n  )\n}\n","import React, { useState } from 'react'\nimport { useSelector } from 'react-redux'\nimport { NO_OP } from '../../../data/types'\nimport { selectAutoPlay, selectPreloadVideos } from '../../../redux/selectors'\nimport MediaProps from './MediaProps'\nimport { Overlay } from '../Overlay'\nimport { PostVideo } from './StyledMedia'\nimport { useAutoplay } from '../../../hooks/useAutoplay'\n\nexport default function Video(props: MediaProps) {\n  const {\n    viewSrc,\n    fullSrc,\n    onLoad = NO_OP,\n    index,\n    width,\n    height,\n    detailsVisible,\n    isFullscreen,\n    isActive,\n    onFinished\n  } = props\n\n  const [playState, setPlayState] = useState(false)\n\n  const [overlayVisible, setOverlayVisible] = React.useState(true)\n  const [videoRef, setVideoRef] = useState<HTMLVideoElement | null>(null)\n\n  const autoPlay = useAutoplay(videoRef)\n\n  const preload = useSelector(selectPreloadVideos) ? 'auto' : 'metadata'\n  const prefAutoplay = useSelector(selectAutoPlay)\n\n  const play = React.useCallback(async () => {\n    if (videoRef?.paused) {\n      try {\n        await videoRef.play()\n        setPlayState(true)\n      } catch (err) {\n        if ((err as DOMException).message.includes(\"user didn't interact with the document first\")) {\n          // Modern browsers prevent playing of videos before the use has interacted with the page in some form\n          console.warn('Autoplay failed because the user did not interact with the page first:', err)\n        } else if ((err as DOMException).message.includes('play() request was interrupted by a call to pause()')) {\n          // This happens when you scrollfast with autoplay enabled.\n          // The videos attempt to play but before they actually start you already scroll on\n          // and they get paused as they move offscreen.\n          console.warn('Play was interrupted by pause', err)\n        } else {\n          console.error('Failed to start video:', err)\n        }\n      }\n    }\n  }, [videoRef])\n\n  const pause = React.useCallback(() => {\n    if (!videoRef?.paused) {\n      try {\n        videoRef?.pause()\n        setPlayState(false)\n      } catch (err) {\n        console.error('Failed to start video:', err)\n      }\n    }\n  }, [videoRef])\n\n  const handleSeek = React.useCallback(\n    (value: number) => {\n      if (videoRef) {\n        videoRef.currentTime = value\n      }\n    },\n    [videoRef]\n  )\n\n  // user play\n  const togglePlay: React.MouseEventHandler = React.useCallback(\n    (e) => {\n      e.stopPropagation()\n      if (videoRef) {\n        if (videoRef.paused) {\n          play()\n          setOverlayVisible(false)\n        } else {\n          pause()\n        }\n      }\n    },\n    [pause, play, videoRef]\n  )\n\n  // automatic play/pause\n  React.useEffect(() => {\n    // in fullscreen mode autoplay is on by default\n    if (prefAutoplay || isFullscreen) {\n      if (autoPlay) {\n        play()\n        setOverlayVisible(false)\n      }\n    }\n\n    if (!autoPlay) {\n      pause()\n    }\n  }, [autoPlay, isFullscreen, pause, play, prefAutoplay])\n\n  return (\n    <>\n      <PostVideo\n        data-testid='video'\n        controls={false}\n        loop={!isFullscreen}\n        preload={preload}\n        ref={setVideoRef}\n        onLoadedMetadata={onLoad}\n        width={width}\n        height={height}\n        src={viewSrc}\n      />\n      <Overlay\n        type='video'\n        index={index}\n        fullSrc={fullSrc}\n        isPaused={!playState}\n        duration={videoRef?.duration || 0}\n        onTogglePaused={togglePlay}\n        onSeek={handleSeek}\n        videoRef={videoRef}\n        isVisible={playState === false || detailsVisible || overlayVisible}\n        setVisible={setOverlayVisible}\n        isFullscreen={isFullscreen}\n        onFinished={onFinished}\n        isActive={isActive}\n      />\n    </>\n  )\n}\n","import * as r34 from 'r34-types'\nimport React from 'react'\nimport Picture from './media/Picture'\nimport Gif from './media/Gif'\nimport Video from './media/Video'\nimport { useSources } from '../../hooks/useSources'\n\ntype MediaProps = {\n  type: r34.PostType\n  index: number\n  thumbnailSrc: string\n  sampleSrc: string\n  fullSrc: string\n  onLoad: () => void\n  width: number\n  height: number\n  detailsVisible: boolean\n  isFullscreen?: boolean\n  onBack?: () => void\n  onFinished?: () => void\n  isActive?: boolean\n}\n\nexport function Media(props: MediaProps) {\n  const {\n    type,\n    thumbnailSrc,\n    sampleSrc,\n    fullSrc,\n    index,\n    onLoad,\n    width,\n    height,\n    detailsVisible,\n    isFullscreen = false,\n    onBack,\n    onFinished,\n    isActive = false,\n  } = props\n  const [preview, src] = useSources(type, thumbnailSrc, sampleSrc, fullSrc)\n\n  switch (type) {\n    case 'image':\n      return (\n        <Picture\n          viewSrc={src}\n          fullSrc={fullSrc}\n          onLoad={onLoad}\n          index={index}\n          width={width}\n          height={height}\n          isFullscreen={isFullscreen}\n          onFinished={onFinished}\n          onBack={onBack}\n          isActive={isActive}\n        />\n      )\n    case 'gif':\n      return (\n        <Gif\n          detailsVisible={detailsVisible}\n          viewSrc={src}\n          thumbnailSrc={preview}\n          fullSrc={fullSrc}\n          onLoad={onLoad}\n          index={index}\n          width={width}\n          height={height}\n          isFullscreen={isFullscreen}\n          onFinished={onFinished}\n          onBack={onBack}\n          isActive={isActive}\n        />\n      )\n    case 'video':\n      return (\n        <Video\n          detailsVisible={detailsVisible}\n          viewSrc={src}\n          thumbnailSrc={preview}\n          fullSrc={fullSrc}\n          onLoad={onLoad}\n          index={index}\n          width={width}\n          height={height}\n          isFullscreen={isFullscreen}\n          onFinished={onFinished}\n          onBack={onBack}\n          isActive={isActive}\n        />\n      )\n  }\n}\n","import React from 'react'\nimport { useSelector } from 'react-redux'\nimport { selectOriginals } from '../redux/selectors'\nimport * as r34 from 'r34-types'\n\nexport function useSources(type: r34.PostType, thumbnailSrc: string, sampleSrc: string, fullSrc: string) {\n  const loadOriginals = useSelector(selectOriginals)\n\n  return React.useMemo(() => {\n    switch (type) {\n      case 'image':\n        return loadOriginals ? ['', fullSrc] : ['', sampleSrc]\n      case 'gif':\n        return sampleSrc.includes('.gif') ? [thumbnailSrc, sampleSrc] : [sampleSrc, fullSrc]\n      case 'video':\n        return loadOriginals ? [thumbnailSrc, fullSrc] : [thumbnailSrc, fullSrc]\n    }\n  }, [fullSrc, loadOriginals, sampleSrc, thumbnailSrc, type])\n}\n","import React from 'react'\nimport { SourceIcon } from '../../../icons/FontAwesomeIcons'\nimport FlexPair from '../../designsystem/FlexPair'\nimport SourceProps from './SourceProps'\n\nexport default function FallbackSource({ value }: SourceProps) {\n  return (\n    <FlexPair data-testid='text-source'>\n      <SourceIcon color='white' />\n      <span>{value}</span>\n    </FlexPair>\n  )\n}\n","import styled, { css } from 'styled-components'\nimport { flexRowWithGap } from '../../styled/mixins/layout'\n\nconst ColoredIconLink = styled.a(\n  ({ color, theme }) => css`\n    ${flexRowWithGap({ theme })}\n    ${color\n      ? css`\n          color: ${color} !important;\n        `\n      : ''};\n    white-space: nowrap;\n\n    svg {\n      height: 16px;\n    }\n  `\n)\n\nexport default ColoredIconLink\n","import React from 'react'\nimport { useTheme } from 'styled-components'\nimport { LinkIcon } from '../../../icons/FontAwesomeIcons'\nimport { formatSource } from '../../../misc/formatting'\nimport ColoredIconLink from '../../designsystem/ColoredIconLink'\nimport SourceProps from './SourceProps'\n\nexport default function DefaultLinkSource({ value }: SourceProps) {\n  const color = useTheme().colors.accentColor\n  const title = formatSource(value)\n\n  return (\n    <ColoredIconLink\n      data-testid='link-source'\n      color={color}\n      href={value}\n      target='_blank'\n      rel='noopener noreferrer'\n      className='source'\n    >\n      <LinkIcon color={color} />\n      {title}\n    </ColoredIconLink>\n  )\n}\n","import { DeviantArtIcon, DiscordIcon, PatreonIcon, TumblrIcon, TwitterIcon } from '../../../icons/FontAwesomeIcons'\nimport { PixivIcon } from '../../../icons/PixivIcon'\n\n/**\n * Cut away all the unnecessary parts of the link\n */\nexport function extractFirstElement(value: string) {\n  return value.split(' ')[0].split('?')[0].split('/')[0]\n}\n\nexport function extractSecondElement(value: string) {\n  return value.split(' ')[0].split('?')[0].split('/')[1]\n}\n\nexport type SourceMapping = [string, (props: any) => JSX.Element | null, (value: string) => string]\n\nexport const sources: Record<string, SourceMapping> = {\n  'twitter.com/': ['#1da1f2', TwitterIcon, (value) => extractFirstElement(value.split('twitter.com/')[1])],\n  'pixiv.net/': ['#0096FA', PixivIcon, () => 'Pixiv'],\n  'patreon.com/': [\n    '#FF424D',\n    PatreonIcon,\n    (value) => {\n      const path = value.split('patreon.com/')[1]\n\n      return path.startsWith('posts/') ? extractSecondElement(path) : extractFirstElement(path)\n    },\n  ],\n  'deviantart.com/': ['#00e59b', DeviantArtIcon, (value) => extractFirstElement(value.split('deviantart.com/')[1])],\n  'discordapp.com/': ['#7289DA', DiscordIcon, () => 'Discord'],\n  'tumblr.com': ['#75869C', TumblrIcon, (value) => new URL(value).hostname.split('.')[0]],\n}\n","import React, { SVGProps } from 'react'\n\nexport function PixivIcon(props: SVGProps<SVGElement>) {\n  return (\n    <svg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>\n      <path\n        fill='currentColor'\n        d='M4.935 0A4.924 4.924 0 0 0 0 4.935v14.13A4.924 4.924 0 0 0 4.935 24h14.13A4.924 4.924 0 0 0 24 19.065V4.935A4.924 4.924 0 0 0 19.065 0zm7.81 4.547c2.181 0 4.058.676 5.399 1.847a6.118 6.118 0 0 1 2.116 4.66c.005 1.854-.88 3.476-2.257 4.563-1.375 1.092-3.225 1.697-5.258 1.697-2.314 0-4.46-.842-4.46-.842v2.718c.397.116 1.048.365.635.779H5.79c-.41-.41.19-.65.644-.779V7.666c-1.053.81-1.593 1.51-1.868 2.031.32 1.02-.284.969-.284.969l-1.09-1.73s3.868-4.39 9.553-4.39zm-.19.971c-1.423-.003-3.184.473-4.27 1.244v8.646c.988.487 2.484.832 4.26.832h.01c1.596 0 2.98-.593 3.93-1.533.952-.948 1.486-2.183 1.492-3.683-.005-1.54-.504-2.864-1.42-3.86-.918-.992-2.274-1.645-4.002-1.646Z'\n      />\n    </svg>\n  )\n}\n","import React from 'react'\nimport ColoredIconLink from '../../designsystem/ColoredIconLink'\n\ninterface SpecialLinkSourceProps {\n  value: string\n  color: string\n  Icon: (props: unknown) => JSX.Element | null\n  title: string\n}\n\nexport default function SpecialLinkSource(props: SpecialLinkSourceProps) {\n  const { value, color, Icon, title } = props\n  return (\n    <ColoredIconLink\n      data-testid='known-source'\n      href={value}\n      target='_blank'\n      rel='noopener noreferrer'\n      className='source'\n      color={color}\n    >\n      <Icon />\n      {title}\n    </ColoredIconLink>\n  )\n}\n","import React from 'react'\nimport { parseUrl } from '../../../data/utils'\nimport FallbackSource from './FallbackSource'\nimport DefaultLinkSource from './LinkSource'\nimport SourceProps from './SourceProps'\nimport { sources } from './sourceUtils'\nimport SpecialLinkSource from './SpecialLinkSource'\n\nexport default function Source({ value }: SourceProps) {\n  if (parseUrl(value)) {\n    // Sources can contain multiple links\n    const links = value.split(' ')\n    return (\n      <>\n        {links.map((link) => {\n          const source = Object.keys(sources).find((key) => link.includes(key))\n\n          if (source) {\n            const [color, Icon, getTitle] = sources[source]\n\n            return <SpecialLinkSource key={link} value={link} color={color} Icon={Icon} title={getTitle(link)} />\n          }\n\n          return <DefaultLinkSource key={link} value={link} />\n        })}\n      </>\n    )\n  }\n\n  return <FallbackSource value={value} />\n}\n","import styled from 'styled-components'\nimport { defaultSpacing } from '../../../styled/mixins/gap'\nimport { flexColumnWithGap } from '../../../styled/mixins/layout'\n\nexport const AdditionalDetails = styled.div`\n  ${flexColumnWithGap}\n  ${defaultSpacing}\n  \n  flex-wrap: wrap;\n  grid-row: 4/5;\n`\n","import * as r34 from 'r34-types'\nimport styled from 'styled-components'\nimport { Faded } from '../../designsystem/Text'\nimport { AdditionalDetails } from './AdditonalDetails'\n\nconst Username = styled.p`\n  line-height: 1.25em;\n`\n\nconst Message = styled(Faded)`\n  display: block;\n  line-height: 1.25em;\n  overflow-wrap: anywhere;\n`\n\nconst Centered = styled.p`\n  text-align: center;\n  padding: 12px;\n`\n\nconst Comment = styled.div`\n  display: content;\n`\n\ninterface CommentsProps {\n  comments: r34.Comment[]\n}\n\nexport default function Comments(props: CommentsProps) {\n  const { comments } = props\n\n  return (\n    <AdditionalDetails>\n      {comments.length === 0 ? (\n        <Centered>No comments found</Centered>\n      ) : (\n        comments.map((comment, index) => (\n          <Comment key={index}>\n            <Username>{comment.creator}</Username>\n            <Message>{comment.body}</Message>\n          </Comment>\n        ))\n      )}\n    </AdditionalDetails>\n  )\n}\n","import React from 'react'\nimport styled from 'styled-components'\nimport { Post } from 'r34-types'\nimport { CalendarIcon, CheckIcon, ImageIcon, SourceIcon } from '../../../icons/FontAwesomeIcons'\nimport { formatDatetime, formatTime } from '../../../misc/formatting'\nimport FlexPair from '../../designsystem/FlexPair'\nimport { Faded } from '../../designsystem/Text'\nimport { AdditionalDetails } from './AdditonalDetails'\n\nconst Entry = styled(Faded)`\n  white-space: nowrap;\n`\n\ntype MetadataProps = Pick<Post, 'created_at' | 'status' | 'width' | 'height' | 'id'>\n\nexport default function Metadata(props: MetadataProps) {\n  const { created_at, width, height, id, status } = props\n\n  const createdAt = new Date(created_at)\n\n  return (\n    <AdditionalDetails>\n      <FlexPair title='Id'>\n        <SourceIcon />\n        <Entry data-testid='id'>{id}</Entry>\n      </FlexPair>\n\n      <FlexPair title='Upload Date'>\n        <CalendarIcon />\n        <Entry data-testid='date'>\n          {formatDatetime(createdAt)} ({formatTime(Date.now() - createdAt.getTime())} ago)\n        </Entry>\n      </FlexPair>\n\n      <FlexPair title='Status'>\n        <CheckIcon />\n        <Entry data-testid='status'>{status}</Entry>\n      </FlexPair>\n\n      <FlexPair title='Measurements'>\n        <ImageIcon />\n        <Entry data-testid='size'>\n          {width} x {height}\n        </Entry>\n      </FlexPair>\n    </AdditionalDetails>\n  )\n}\n","import React from 'react'\nimport * as r34 from 'r34-types'\nimport { RatingIcon } from '../../../icons/FontAwesomeIcons'\nimport FlexPair from '../../designsystem/FlexPair'\nimport { useTheme } from 'styled-components'\n\nconst fullnames: Record<r34.PostRating, string> = {\n  e: 'Explicit',\n  q: 'Questionable',\n  s: 'Safe',\n}\n\ninterface RatingProps {\n  value: r34.PostRating\n}\n\nexport default function Rating(props: RatingProps) {\n  const { value } = props\n  const theme = useTheme()\n\n  return (\n    <FlexPair data-testid='rating' title={fullnames[value]}>\n      <RatingIcon color={theme.colors.text} />\n      <span>{value.toUpperCase()}</span>\n    </FlexPair>\n  )\n}\n","import React, { MouseEventHandler, useCallback } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport styled, { css, DefaultTheme } from 'styled-components'\nimport { boolToNumber } from '../../../data/utils'\nimport { HeartIcon } from '../../../icons/FontAwesomeIcons'\nimport { formatCount } from '../../../misc/formatting'\nimport { likePost } from '../../../redux/actions'\nimport { selectLikedByPostId } from '../../../redux/selectors'\nimport FlexPair from '../../designsystem/FlexPair'\n\nconst ScorePair = styled(FlexPair)(\n  ({ $liked, theme }: { $liked: boolean; theme: DefaultTheme }) => css`\n    transition: transform 0.1s ease-out;\n    cursor: pointer;\n\n    ${$liked\n      ? css`\n          color: ${theme.colors.liked};\n\n          svg {\n            color: ${theme.colors.liked};\n          }\n        `\n      : css``}\n  `\n)\n\nexport default function Score(props: { value: number; postId: number }) {\n  const { value, postId } = props\n\n  const dispatch = useDispatch()\n\n  const liked = useSelector(selectLikedByPostId(postId))\n  const handleClick: MouseEventHandler = useCallback(\n    (event) => {\n      event.stopPropagation()\n\n      if (!liked) {\n        dispatch(likePost(postId))\n      }\n    },\n    [dispatch, liked, postId]\n  )\n\n  return (\n    <ScorePair onClick={handleClick} $liked={liked} data-testid='score' title='Like this post'>\n      <HeartIcon color='white' />\n      <span>{formatCount(value + boolToNumber(liked))}</span>\n    </ScorePair>\n  )\n}\n","import React, { MouseEventHandler, useCallback, useEffect, useMemo } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport styled, { css, DefaultTheme } from 'styled-components'\nimport * as r34 from 'r34-types'\nimport { ActiveTab, NO_OP } from '../../../data/types'\nimport { listToMap } from '../../../data/utils'\nimport useToggleTag from '../../../hooks/useToggleTag'\nimport { selectPostById, selectShowComments, selectShowMetadata } from '../../../redux/selectors'\nimport TagList from '../../tag/TagList'\nimport Source from '../source/Source'\nimport Comments from './Comments'\nimport Metadata from './Metadata'\nimport Rating from './Rating'\nimport Score from './Score'\nimport { useCheckIsActive } from '../../../hooks/useCheckIsActive'\nimport { addTag } from '../../../redux/actions'\nimport useModifier from '../../../hooks/useModifier'\nimport { layer } from '../../../styled/mixins/theming'\nimport { defaultSpacing } from '../../../styled/mixins/gap'\nimport { flexRowWithGap } from '../../../styled/mixins/layout'\n\nconst Bar = styled.div(\n  ({ theme }) => css`\n    grid-row: 2/3;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    flex-wrap: nowrap;\n    overflow-x: auto;\n    ${layer({ theme })}\n    ${defaultSpacing}\n    border-radius: 0 0 ${theme.dimensions.borderRadius} ${theme.dimensions.borderRadius};\n  `\n)\n\nconst Menu = styled.div(\n  ({ theme }) => css`\n    ${flexRowWithGap}\n    justify-content: space-around;\n    margin-top: ${theme.dimensions.bigSpacing};\n    grid-row: 3/4;\n  `\n)\n\nconst MenuEntry = styled.span`\n  cursor: pointer;\n\n  ${({ active, theme }: { active: boolean; theme: DefaultTheme }) =>\n    active\n      ? css`\n          color: ${theme.colors.accentColor};\n        `\n      : ''}\n`\n\nconst DetailsTagList = styled(TagList)(\n  ({ theme }) => css`\n    grid-row: 4/5;\n    padding: ${theme.dimensions.bigSpacing};\n  `\n)\n\ninterface DetailsProps {\n  postId: number\n  onLoad?: () => void\n  activeTab: ActiveTab\n  setActiveTab: React.Dispatch<React.SetStateAction<ActiveTab>>\n  hasComments: boolean\n}\n\nexport default function Details(props: DetailsProps) {\n  const dispatch = useDispatch()\n  const [modifier] = useModifier()\n\n  const { postId, onLoad = NO_OP, activeTab, setActiveTab, hasComments } = props\n  const { rating, score, tags, source, change, status, height, width, comments } = useSelector(\n    selectPostById(postId)\n  ) as r34.Post\n  const tagsForRendering = useMemo(\n    () =>\n      listToMap(\n        tags.map((tag) => ({ name: tag, types: [] })),\n        'name'\n      ),\n    [tags]\n  )\n  const showMetadata = useSelector(selectShowMetadata)\n  const showComments = useSelector(selectShowComments)\n\n  const checkIsActive = useCheckIsActive()\n\n  const toggleTag = useToggleTag()\n  const setTags: MouseEventHandler = useCallback(\n    (event) => {\n      event.stopPropagation()\n      setActiveTab('tags')\n    },\n    [setActiveTab]\n  )\n\n  const setComments: MouseEventHandler = useCallback(\n    (event) => {\n      event.stopPropagation()\n      setActiveTab('comments')\n    },\n    [setActiveTab]\n  )\n\n  const setMetadata: MouseEventHandler = useCallback(\n    (event) => {\n      event.stopPropagation()\n      setActiveTab('metadata')\n    },\n    [setActiveTab]\n  )\n\n  const addTagWithModifier = React.useCallback(\n    (tag: r34.AnyBiasedTag) => {\n      dispatch(addTag({ ...tag, modifier }))\n    },\n    [dispatch, modifier]\n  )\n\n  useEffect(() => {\n    onLoad()\n  }, [onLoad, activeTab])\n\n  return (\n    <>\n      <Bar>\n        <Rating value={rating} />\n        <Score value={score} postId={postId} />\n        {!!source && <Source value={source} />}\n      </Bar>\n      {((showComments && hasComments) || showMetadata) && (\n        <Menu>\n          <MenuEntry active={activeTab === 'tags'} onClick={setTags} title='Show tags'>\n            Tags\n          </MenuEntry>\n          {showComments && hasComments && (\n            <MenuEntry active={activeTab === 'comments'} onClick={setComments} title='Show comments'>\n              Comments\n            </MenuEntry>\n          )}\n          {showMetadata && (\n            <MenuEntry active={activeTab === 'metadata'} onClick={setMetadata} title='Show metadata'>\n              Metadata\n            </MenuEntry>\n          )}\n        </Menu>\n      )}\n\n      {\n        {\n          tags: (\n            <DetailsTagList\n              tags={tagsForRendering}\n              detailed={false}\n              onTagClick={toggleTag}\n              getIsActive={checkIsActive}\n              onTagMenu={addTagWithModifier}\n            />\n          ),\n          comments: <Comments comments={(comments ?? []) as r34.Comment[]} />,\n          metadata: (\n            <Metadata created_at={change.toString()} status={status} width={width} height={height} id={postId} />\n          ),\n        }[activeTab]\n      }\n    </>\n  )\n}\n","import * as r34 from 'r34-types'\nimport React from 'react'\nimport { useEffect, useState } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport styled, { css } from 'styled-components'\nimport { ActiveTab, NO_OP } from '../../data/types'\nimport useToggle from '../../hooks/useToggle'\nimport { fetchComments } from '../../redux/actions'\nimport { selectShowComments, selectShowPostDetails } from '../../redux/selectors'\nimport { layer } from '../../styled/mixins/theming'\nimport { ZIndex } from '../../styled/zIndex'\nimport LayoutElementProps from '../layout/LayoutElementProps'\nimport { Media } from '../player/Media'\nimport Details from './details/Details'\n\nconst ItemWrapper = styled.div(\n  ({ theme }) => css`\n    padding-top: ${theme.dimensions.bigSpacing};\n  `\n)\n\nconst PositonWrapper = styled.div(\n  ({ theme }) => css`\n    padding: 0 ${theme.dimensions.bigSpacing};\n    width: 100%;\n    max-width: ${theme.dimensions.bodyWidth};\n    margin: auto;\n  `\n)\n\nconst PostWrapper = styled.div`\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: auto auto auto auto;\n  ${layer}\n\n  // Set area of media and overlay\n    img, video {\n    grid-area: 1/1/2/2;\n    z-index: ${ZIndex.POST};\n  }\n\n  .overlay {\n    grid-area: 1/1/2/2;\n    z-index: ${ZIndex.OVERLAY};\n  }\n`\n\nexport function ListPost(props: r34.Post & LayoutElementProps & { index: number }) {\n  const {\n    style,\n    virtualRef,\n    type,\n    sample_url,\n    file_url,\n    preview_url,\n    onLoad = NO_OP,\n    id,\n    width,\n    height,\n    comments,\n    has_comments,\n    index,\n  } = props\n\n  return (\n    <ItemWrapper style={style} ref={virtualRef} className='list-div'>\n      <PositonWrapper>\n        <Post\n          type={type}\n          sample_url={sample_url}\n          file_url={file_url}\n          preview_url={preview_url}\n          onLoad={onLoad}\n          id={id}\n          width={width}\n          height={height}\n          comments={comments}\n          has_comments={has_comments}\n          index={index}\n        />\n      </PositonWrapper>\n    </ItemWrapper>\n  )\n}\n\ntype PostProps = Pick<\n  r34.Post,\n  'type' | 'sample_url' | 'file_url' | 'preview_url' | 'id' | 'width' | 'height' | 'comments' | 'has_comments'\n> & { onLoad?: () => void; index: number }\n\nexport const Post = React.memo((props: PostProps) => {\n  const {\n    type,\n    sample_url,\n    file_url,\n    preview_url,\n    onLoad = NO_OP,\n    id,\n    width,\n    height,\n    comments,\n    has_comments,\n    index,\n  } = props\n\n  const dispatch = useDispatch()\n\n  const [activeTab, setActiveTab] = useState<ActiveTab>('tags')\n  const [collapsed, toggleCollapsed] = useToggle(true)\n\n  const showPostDetails = useSelector(selectShowPostDetails)\n  const showComments = useSelector(selectShowComments)\n\n  // re-measure when collapsed state changes\n  useEffect(() => {\n    onLoad()\n  }, [onLoad, collapsed])\n\n  // Loads comments if conditions are met\n  useEffect(() => {\n    if (!collapsed && showComments && has_comments && !comments) {\n      dispatch(fetchComments(id))\n    }\n  }, [collapsed, showComments, has_comments, comments, dispatch, id])\n\n  return (\n    <PostWrapper onClick={toggleCollapsed} role='row' data-name='post-wrapper' tabIndex={0}>\n      <Media\n        detailsVisible={!collapsed}\n        type={type}\n        thumbnailSrc={preview_url}\n        sampleSrc={sample_url}\n        fullSrc={file_url}\n        onLoad={onLoad}\n        index={index}\n        width={width}\n        height={height}\n        isActive={true}\n      />\n      {showPostDetails && !collapsed && (\n        <Details\n          postId={id}\n          onLoad={onLoad}\n          activeTab={activeTab}\n          setActiveTab={setActiveTab}\n          hasComments={has_comments}\n        />\n      )}\n    </PostWrapper>\n  )\n})\n","import React from 'react'\nimport useAction from '../../hooks/useAction'\nimport { SearchIcon } from '../../icons/FontAwesomeIcons'\nimport { getResults, openModal } from '../../redux/actions'\nimport { BlockButton } from '../designsystem/Buttons'\nimport { ModalId } from '../../data/types'\nimport { useConnectionState } from '../../hooks/useConnectionState'\nimport { selectAutoPlay, selectOriginals, selectPreloadVideos } from '../../redux/selectors'\nimport { useDispatch, useSelector } from 'react-redux'\n\nlet isUserNotified = false\n\nexport default function SearchButton() {\n  const search = useAction(getResults)\n  const dispatch = useDispatch()\n  const connection = useConnectionState()\n  const preloadVideos = useSelector(selectPreloadVideos)\n  const autoplay = useSelector(selectAutoPlay)\n  const originals = useSelector(selectOriginals)\n\n  const handleClick = React.useCallback(() => {\n    const riskyFeatureEnabled = preloadVideos || autoplay || originals\n\n    if (!isUserNotified && connection === 'cellular' && riskyFeatureEnabled) {\n      dispatch(openModal(ModalId.CELLULAR_WARNING))\n      isUserNotified = true\n    } else {\n      search()\n    }\n  }, [autoplay, connection, dispatch, originals, preloadVideos, search])\n\n  return (\n    <BlockButton onClick={handleClick} aria-label='Search'>\n      <SearchIcon />\n      Search\n    </BlockButton>\n  )\n}\n","import { useState, useEffect } from 'react'\n\nexport function useConnectionState() {\n  //@ts-expect-error\n  const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection\n\n  const [connectionState, setConnectionState] = useState<string | undefined>(connection?.type)\n\n  useEffect(() => {\n    if (connection) {\n      const listener = () => setConnectionState(connection.type)\n      connection.addEventListener('change', listener, { passive: true })\n      return () => connection.removeEventListener('change', listener)\n    }\n  }, [connection])\n\n  return connectionState as\n    | 'bluetooth'\n    | 'cellular'\n    | 'ethernet'\n    | 'none'\n    | 'wifi'\n    | 'wimax'\n    | 'other'\n    | 'unknown'\n    | undefined\n}\n","import React from 'react'\nimport styled, { css, DefaultTheme } from 'styled-components'\nimport { gap } from '../../styled/mixins/gap'\nimport { Surface } from './Surface'\nimport { Title } from './Text'\n\nconst PaddedTitle = styled(Title)(\n  ({ theme }) => css`\n    padding-top: ${theme.dimensions.hugeSpacing};\n  `\n)\n\nconst PaddedSurface = styled(Surface)(\n  ({ theme, $compact }: { theme: DefaultTheme; $compact: boolean }) => css`\n    padding: ${$compact ? theme.dimensions.bigSpacing : theme.dimensions.hugeSpacing};\n    ${gap($compact ? theme.dimensions.bigSpacing : theme.dimensions.hugeSpacing)};\n  `\n)\n\ninterface TitledSurfaceProps {\n  title: React.ReactNode\n  children: React.ReactNode[]\n  compact?: boolean\n  className?: string\n}\n\nexport default function TitledSurface(props: TitledSurfaceProps) {\n  const { title, children, className, compact = false } = props\n\n  return (\n    <>\n      <PaddedTitle>{title}</PaddedTitle>\n      <PaddedSurface $compact={compact} className={className}>\n        {children}\n      </PaddedSurface>\n    </>\n  )\n}\n","import styled, { css, DefaultTheme } from 'styled-components'\nimport { borderRadius } from '../../styled/mixins/theming'\n\nexport const SubtleInput = styled.input(\n  (props: { value: string; theme: DefaultTheme }) => css`\n    background: ${props.theme.colors.backgroundColor};\n    padding: ${props.theme.dimensions.spacing};\n    ${borderRadius}\n    border: none;\n    outline: none;\n    color: ${props.theme.colors.accentColor};\n    width: 3.4rem;\n    text-align: right;\n    font-size: ${props.theme.fontSizes.content};\n\n    ::-webkit-inner-spin-button,\n    ::-webkit-outer-spin-button {\n      -webkit-appearance: none;\n      margin: 0;\n    }\n    -moz-appearance: textfield;\n  `\n)\n","import React from 'react'\nimport styled from 'styled-components'\nimport usePreference from '../../hooks/usePreference'\nimport { flexRowWithGap } from '../../styled/mixins/layout'\nimport LabeledToggle from '../designsystem/LabeledToggle'\nimport { SubtleInput } from '../designsystem/SubtleInput'\n\nconst RatedRow = styled.div`\n  ${flexRowWithGap}\n`\n\nconst RatedToggle = styled(LabeledToggle)`\n  height: 28px; // prevent layout shift when toggling\n`\n\nexport default function RatedFilter() {\n  const [rated, setRated] = usePreference('rated')\n  const [ratedThreshold, setRatedThreshold] = usePreference('ratedThreshold')\n\n  const toggleRated = React.useCallback(() => setRated(!rated), [rated, setRated])\n\n  const [ratedThresholdInternal, setRatedThresholdInternal] = React.useState(\n    ratedThreshold ? ratedThreshold.toString() : '1'\n  )\n\n  const onChange: React.ChangeEventHandler<HTMLInputElement> = React.useCallback(\n    (event) => setRatedThresholdInternal(event.target.value),\n    []\n  )\n\n  const onBlur = React.useCallback(\n    () => setRatedThreshold(Number(ratedThresholdInternal)),\n    [ratedThresholdInternal, setRatedThreshold]\n  )\n\n  const handleSubmit = React.useCallback((e) => {\n    if (e.key === 'Enter') e.target.blur()\n  }, [])\n\n  return (\n    <RatedToggle value={rated} onToggle={toggleRated}>\n      {rated ? (\n        <RatedRow>\n          <span>More than</span>\n          <SubtleInput\n            type='number'\n            value={ratedThresholdInternal}\n            onChange={onChange}\n            onBlur={onBlur}\n            onKeyDown={handleSubmit}\n          />\n          <span>likes</span>\n        </RatedRow>\n      ) : (\n        'Only show popular posts'\n      )}\n    </RatedToggle>\n  )\n}\n","import React, { ChangeEventHandler } from 'react'\nimport styled, { css } from 'styled-components'\nimport { defaultBlock } from '../../styled/mixins/layout'\nimport { defaultBorder, defaultInput } from '../../styled/mixins/theming'\n\nconst Wrapper = styled.div(\n  ({ theme }) => css`\n    width: 120px;\n    height: ${theme.dimensions.blockHeight};\n  `\n)\n\nconst StyledSelect = styled.select`\n  ${defaultInput}\n\n  width: 100%;\n  height: 100%;\n`\n\nconst Option = styled.option(\n  ({ theme }) => css`\n    ${defaultBorder({ theme })}\n    background-color: ${theme.colors.backgroundColor2};\n    ${defaultBlock({ theme })}\n  `\n)\n\ninterface SelectProps {\n  options: Record<string, string>\n  value: string\n  onChange: ChangeEventHandler\n}\n\nexport default function Select(props: SelectProps) {\n  const { options, value, onChange } = props\n\n  return (\n    <Wrapper>\n      <StyledSelect value={value} onChange={onChange}>\n        {Object.entries(options).map(([optionKey, optionValue]) => (\n          <Option key={optionKey} value={optionKey}>\n            {optionValue}\n          </Option>\n        ))}\n      </StyledSelect>\n    </Wrapper>\n  )\n}\n","import { PostsSort } from 'r34-types'\nimport React from 'react'\nimport styled from 'styled-components'\nimport usePreference from '../../hooks/usePreference'\nimport { flexRowWithGap } from '../../styled/mixins/layout'\nimport { PropsWithTheme } from '../../styled/mixins/types'\nimport Select from '../designsystem/Select'\n\nconst SortRow = styled.div`\n  ${flexRowWithGap}\n  height: ${({ theme }: PropsWithTheme) => theme.dimensions.blockHeight};\n`\n\nconst sortOptions = {\n  'score:desc': 'Score',\n  'date:desc': 'Date',\n}\n\nexport default function SortSelect() {\n  const [sort, setSort] = usePreference('sort')\n\n  const handleSortChange: React.ChangeEventHandler<HTMLSelectElement> = React.useCallback(\n    (event) => setSort(event.target.value as PostsSort),\n    [setSort]\n  )\n\n  return (\n    <SortRow>\n      <span>Sort by:</span>\n      <Select options={sortOptions} value={sort} onChange={handleSortChange} />\n    </SortRow>\n  )\n}\n","import styled from 'styled-components'\nimport TagSelector from '../tagSelector/TagSelector'\nimport SearchButton from '../widgets/SearchButton'\nimport ActiveTags from '../widgets/ActiveTags'\nimport { useActivateTag } from '../../hooks/useActivateTag'\nimport { defaultSpacing } from '../../styled/mixins/gap'\nimport { centeredMaxWidth, flexColumn } from '../../styled/mixins/layout'\nimport TitledSurface from '../designsystem/TitledSurface'\nimport RatedFilter from '../widgets/RatedFilter'\nimport SortSelect from '../widgets/SortSelect'\nimport useFirebaseAuthState from '../../hooks/useFirebaseAuthState'\n\nconst ConfigWrapper = styled.section`\n  ${flexColumn}\n  ${defaultSpacing}\n  ${centeredMaxWidth}\n`\n\nexport default function SearchEditor(props: { onLoad: () => void }) {\n  const { onLoad } = props\n\n  const [isSignedIn] = useFirebaseAuthState()\n  const activateTag = useActivateTag()\n\n  return (\n    <ConfigWrapper>\n      <TitledSurface title={<label htmlFor='tag-input'></label>} compact>\n        <TagSelector onSubmit={activateTag} showSupertags />\n        <ActiveTags onChange={onLoad} offerSupertags={isSignedIn} />\n        <RatedFilter />\n        <SortSelect />\n        <SearchButton />\n      </TitledSurface>\n    </ConfigWrapper>\n  )\n}\n","import firebase from 'firebase/app'\nimport 'firebase/auth'\nimport { useEffect, useState } from 'react'\n\n/**\n * A hook that provides the firebase authentication status for use in functional components.\n */\nexport default function useFirebaseAuthState() {\n  const [authState, setAuthState] = useState(false)\n  const [user, setUser] = useState<firebase.User | null>(null)\n\n  useEffect(() => {\n    try {\n      const unsubscribe = firebase\n      .auth()\n      .onAuthStateChanged((user) => {\n        if (user) {\n          setAuthState(true)\n          setUser(user)\n        } else {\n          setAuthState(false)\n          setUser(null)\n        }\n      })\n      return () => {\n        unsubscribe()\n      }\n    } catch {\n      setAuthState(false)\n      setUser(null)\n    }\n  }, [])\n\n  return [authState, user] as const\n}\n","import { useTheme } from 'styled-components'\n\nexport default function R34Icon(props: { size: number; className?: string }) {\n  const theme = useTheme()\n\n  return (\n    <svg\n      xmlns='http://www.w3.org/2000/svg'\n      width={props.size}\n      height={props.size}\n      viewBox='0 0 12.7 12.7'\n      className={props.className}\n    >\n      <g transform='translate(0,-284.3)'>\n        <circle\n          id='path18'\n          cx='6.3499999'\n          cy='290.65002'\n          fill='none'\n          stroke={theme.colors.accentColor}\n          strokeWidth='0.50848764'\n          strokeMiterlimit='4'\n          strokeDasharray='none'\n          strokeOpacity='1'\n          r='6.0957561'\n        />\n        <text\n          fontStyle='normal'\n          fontWeight='normal'\n          fontSize='8.3113203px'\n          fontFamily='sansSerif'\n          letterSpacing='0px'\n          wordSpacing='0px'\n          fill={theme.colors.accentColor}\n          fillOpacity='1'\n          x='2.1363549'\n          y='289.02704'\n          id='text4533'\n          transform='scale(0.98538224,1.0148346)'\n        >\n          <tspan\n            id='tspan4531'\n            x='2'\n            y='289.1'\n            fontStyle='normal'\n            fontVariant='normal'\n            fontWeight='300'\n            fontStretch='normal'\n            fontFamily='Calibri'\n            fill={theme.colors.accentColor}\n            fillOpacity='1'\n          >\n            34\n          </tspan>\n        </text>\n      </g>\n    </svg>\n  )\n}\n","import React from 'react'\nimport { useTheme } from 'styled-components'\nimport { useOnlineChange } from '../../hooks/useOnlineChange'\nimport { FailedIcon } from '../../icons/FontAwesomeIcons'\n\nexport default function OfflineIndicator() {\n  const theme = useTheme()\n  const isOnline = useOnlineChange()\n\n  return isOnline ? <div></div> : <FailedIcon title='You are offline' color={theme.colors.negative} />\n}\n","import React from 'react'\n\ninterface UseOnlineChangeOptions {\n  onOnline?: () => void\n  onOffline?: () => void\n}\n\nexport function useOnlineChange(options?: UseOnlineChangeOptions) {\n  const [isOnline, setIsOnline] = React.useState(window.navigator.onLine)\n\n  React.useEffect(() => {\n    const listenter = () => {\n      setIsOnline(true)\n      options?.onOnline?.()\n    }\n    window.addEventListener('online', listenter)\n    return () => window.removeEventListener('online', listenter)\n  })\n\n  React.useEffect(() => {\n    const listenter = () => {\n      setIsOnline(false)\n      options?.onOffline?.()\n    }\n    window.addEventListener('offline', listenter)\n    return () => window.removeEventListener('offline', listenter)\n  })\n\n  return isOnline\n}\n","import styled, { css } from 'styled-components'\nimport R34Icon from '../../icons/R34Icon'\nimport { defaultSpacing } from '../../styled/mixins/gap'\nimport { flexColumn } from '../../styled/mixins/layout'\nimport FlexPair from '../designsystem/FlexPair'\nimport { BigTitle } from '../designsystem/Text'\nimport OfflineIndicator from '../widgets/OfflineIndicator'\nimport Menubar from '../widgets/Menubar'\nimport React, { useEffect, useState } from 'react'\nimport styledComp from 'styled-components'\n\nconst HeaderWrapper = styled.header(\n  ({ theme }) => css`\n    ${flexColumn}\n    background: ${theme.colors.layerBgSolid};\n  `\n)\n\nconst TitleBar = styled.div(\n  ({ theme }) => css`\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    ${defaultSpacing}\n\n    > :first-child,\n    > :last-child {\n      width: ${theme.dimensions.blockHeight};\n    }\n  `\n)\n\nconst DmcaLink = styled.a(\n  ({ theme }) => css`\n    color: ${theme.colors.accentColor};\n    text-decoration: underline;\n\n    @media (max-width: 520px) {\n      display: none;\n    }\n  `\n)\n\nconst TestButton = styledComp.button(\n  ({ theme }) => css`\n    background: transparent;\n    color: ${theme.colors.accentColor};\n    border: 1px solid ${theme.colors.accentColor};\n    padding: 0.25rem 0.5rem;\n    cursor: pointer;\n    font-size: 0.85rem;\n  `\n)\n\nconst LoadSpan = styled.span(\n  ({ theme }) => css`\n    color: ${theme.colors.subduedText};\n    font-size: 0.9rem;\n\n    @media (max-width: 520px) {\n      display: none;\n    }\n  `\n)\n\nconst CenterArea = styled.div(\n  ({ theme }) => css`\n    display: grid;\n    grid-template-columns: auto 1fr auto;\n    align-items: center;\n    width: 100%%;\n    gap: 1rem;\n\n    & > .left,\n    & > .right {\n      display: flex;\n      align-items: center;\n      gap: 0.5rem;\n    }\n\n    & > .middle {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      gap: 1rem;\n    }\n  `\n)\n\nexport default function Header() {\n  const [loadMs, setLoadMs] = useState<number | null>(null)\n  const [randDecimals, setRandDecimals] = useState<string | null>(null)\n  const randSetRef = React.useRef(false)\n\n  const genRand3 = () => {\n    return `${Math.floor(Math.random() * 10)}${Math.floor(Math.random() * 10)}${Math.floor(\n      Math.random() * 10\n    )}`\n  }\n\n  // Measure page load time\n  useEffect(() => {\n    try {\n      const nav = (performance.getEntriesByType && performance.getEntriesByType('navigation')) as\n        | PerformanceNavigationTiming[]\n        | undefined\n\n      if (nav && nav.length > 0) {\n        const n = nav[0]\n        const end = n.loadEventEnd && n.loadEventEnd > 0 ? n.loadEventEnd : n.responseEnd || n.domComplete || n.responseStart || n.startTime\n        const val = typeof end === 'number' ? end - (n.startTime || 0) : null\n\n        if (val !== null && !Number.isNaN(val)) {\n          const fractional = performance.now() % 1\n          const finalVal = Number.isInteger(val) ? val + fractional : val\n          setLoadMs(finalVal)\n          if (!randSetRef.current) {\n            setRandDecimals(genRand3())\n            randSetRef.current = true\n          }\n          return\n        }\n      }\n\n      const t = (performance as any).timing\n      if (t && t.navigationStart) {\n        const highResNow = (performance.timeOrigin || Date.now()) + performance.now()\n        let val = highResNow - t.navigationStart\n\n        if (t.loadEventEnd && t.loadEventEnd > 0) {\n          const intLoad = t.loadEventEnd - t.navigationStart\n          const fractionalCorrection = highResNow - Date.now()\n          val = intLoad + fractionalCorrection\n        }\n\n        const fractional = performance.now() % 1\n        const finalVal = Number.isInteger(val) ? val + fractional : val\n        setLoadMs(finalVal)\n        if (!randSetRef.current) {\n          setRandDecimals(genRand3())\n          randSetRef.current = true\n        }\n        return\n      }\n\n      const pnow = performance.now()\n      setLoadMs(pnow)\n      if (!randSetRef.current) {\n        setRandDecimals(genRand3())\n        randSetRef.current = true\n      }\n    } catch (e) {\n      // ignore\n    }\n  }, [])\n\n  // Load external popunder script from public folder on mount\n  useEffect(() => {\n    const script = document.createElement('script')\n    script.src = '/popunder.js'\n    script.async = true\n    document.body.appendChild(script)\n\n    // append a lightweight debug script to confirm execution in the browser\n    const debugScript = document.createElement('script')\n    debugScript.src = '/popunder-debug.js'\n    debugScript.async = true\n    document.body.appendChild(debugScript)\n\n    return () => {\n      try {\n        document.body.removeChild(script)\n        document.body.removeChild(debugScript)\n      } catch (e) {\n        // ignore\n      }\n    }\n  }, [])\n\n  //  Inject Umami analytics script\n  useEffect(() => {\n    const script = document.createElement('script')\n    script.defer = true\n    script.src = 'https://cloud.umami.is/script.js'\n    script.setAttribute('data-website-id', 'b33fc5ec-1681-4855-9236-0a41f819f326')\n    document.body.appendChild(script)\n\n    return () => {\n      document.body.removeChild(script)\n    }\n  }, [])\n\n  return (\n    <HeaderWrapper role='cell'>\n      <TitleBar>\n        <div>{/*placeholder*/}</div>\n        <CenterArea>\n          <div className=\"left\">\n            <DmcaLink href=\"mailto:lajovey872@gta5hx.com\">DMCA</DmcaLink>\n            {typeof window !== 'undefined' && (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') ? (\n              <TestButton\n                onClick={() => {\n                  try {\n                    // attempt to trigger the popunder for debugging/dev only\n                    const pm = (window as any).popMagic\n                    if (!pm) {\n                      console.warn('popMagic not present')\n                      return\n                    }\n                    const orig = pm.isValidUserEvent\n                    pm.isValidUserEvent = function () { return true }\n                    try {\n                      pm.methods.default({ target: document.body, isTrusted: true, screenX: 1, screenY: 1, preventDefault: () => {} })\n                    } catch (e) {\n                      console.error('error triggering popMagic', e)\n                    }\n                    pm.isValidUserEvent = orig\n                  } catch (e) {\n                    console.error(e)\n                  }\n                }}\n              >\n                Test Popunder\n              </TestButton>\n            ) : null}\n          </div>\n\n          <div className=\"middle\">\n            <FlexPair>\n              <R34Icon size={64} />\n              <BigTitle style={{ fontSize: '2em' }}>Rule 34</BigTitle>\n            </FlexPair>\n          </div>\n\n          <div className=\"right\">\n            <LoadSpan>\n              {loadMs !== null\n                ? ((): string => {\n                    const intPart = Math.floor(loadMs)\n                    const firstDecimal = Math.floor(loadMs * 10) % 10\n                    const tail = randDecimals || genRand3()\n                    return `${intPart}.${firstDecimal}${tail}`\n                  })()\n                : ''}{' '}\n              ms to load\n            </LoadSpan>\n          </div>\n        </CenterArea>\n\n        <OfflineIndicator />\n      </TitleBar>\n    </HeaderWrapper>\n  )\n}","import styled, { css } from 'styled-components'\n\nexport const C = styled.span(\n  ({ theme }) => css`\n    background: ${theme.colors.layerBg};\n    border-radius: ${theme.dimensions.borderRadius};\n    padding: 0 ${theme.dimensions.spacing};\n    align-self: center;\n    font-weight: bold;\n    border: 2px currentColor solid;\n  `\n)\n","import React from 'react'\nimport styled, { css } from 'styled-components'\nimport { randomBelow } from '../../data/utils'\nimport { ArrowDown, ExpandIcon, ExternalLinkIcon } from '../../icons/FontAwesomeIcons'\nimport { C } from '../designsystem/C'\nimport { Faded } from '../designsystem/Text'\n\nconst TipWrapper = styled.div(\n  ({ theme }) => css`\n    text-align: center;\n    padding: ${theme.dimensions.hugeSpacing};\n    max-width: ${theme.dimensions.bodyWidth};\n  `\n)\n\nconst tips: Array<JSX.Element | string> = [\n  <Faded>\n    You can exclude tags with the <C>-</C> modifier.\n  </Faded>,\n  'Try tapping the little plus in the tag search.',\n  <Faded>\n    Each result will have at least one of your <C>~</C> tags.\n  </Faded>,\n  'Check out the preferences. There are lots of useful options there.',\n  'You can get more info about a post be tapping it once.',\n  'Tapping on a tag below a post adds it to your active tags.',\n  <Faded>\n    Large gifs and videos can take a while to load in the app. If this becomes a problem you can open them in a new tab\n    with <ExternalLinkIcon />\n  </Faded>,\n  'If anything stops working or gets weird. Reset the app in preferences.',\n  'I hope you are having a nice day!',\n  <Faded>\n    If a tag is ambiguous, it will have a little arrow <ArrowDown />. Tapping it shows related tags.\n  </Faded>,\n  <Faded>\n    Tapping <ExpandIcon /> in the top left of posts brings you into fullscreen mode.\n  </Faded>,\n  'Searching with no tags returns ALL posts ever made.',\n  'By default, results are sorted chronologically. Newest first. You can change this with the sort selector.',\n  \"You can filter posts based on how explicit they are. Try entering 'rating' in the search field.\",\n  \"You can search for posts from a specific website by entering 'source:*twitter* for example.\",\n  'You can upvote a post by tapping its score in the details.',\n  'Wanna know more about a post? Enable \"Show post metadata\" in the options.',\n  'Every time you load this page, a random tip will be shown here.',\n  'You can enable comments in the preferences. Not all post have comments though.',\n  'You can save and share your preferences across devices if you log in with your Google account.',\n  'Tapping the number of results displays the exact number instead of an approximation.',\n  'You can create supertags once you have two or more active tags. (And you need to be signed in)',\n  'Supertags are collections of tags that you can add together.',\n  'Supertags retain the modifiers of the tags they contain.',\n  'You can tap this tip to get another one.',\n  'You can change the modifier of an active tag by clicking and holding it on mobile and right clicking it on desktop.',\n  'You can share your supertags with friends under preferences.',\n  'Join the discord to get involved with other people who use the app.',\n  'I am taking feature request on my discord server.',\n  'Check out the about section for info/links about the app and myself.',\n  'If you are signed in, your settings are automatically saved online when you change them. This can take up to 15 seconds.',\n]\n\nconst getRandomTip = () => tips[randomBelow(tips.length)]\n\nexport default function RandomTip() {\n  const [tip, setTip] = React.useState(getRandomTip())\n  const nextTip = React.useCallback(() => setTip(getRandomTip()), [])\n\n  return (\n    <TipWrapper role='note' onClick={nextTip}>\n      {typeof tip === 'string' ? <Faded>{tip}</Faded> : tip}\n    </TipWrapper>\n  )\n}\n","import React from 'react'\nimport styled, { css } from 'styled-components'\nimport { WrenchIcon } from '../../icons/FontAwesomeIcons'\nimport { flexColumnWithGap } from '../../styled/mixins/layout'\nimport { layer } from '../../styled/mixins/theming'\nimport FlexPair from '../designsystem/FlexPair'\nimport { SmallTitle } from '../designsystem/Text'\n\nconst Wrapper = styled(FlexPair)(\n  ({ theme }) => css`\n    ${layer}\n    width: 100%;\n    padding: ${theme.dimensions.hugeSpacing};\n    max-width: ${theme.dimensions.bodyWidth};\n  `\n)\n\nconst Message = styled.div`\n  ${flexColumnWithGap}\n`\n\nexport default function UpdateHighlight() {\n  const now = new Date()\n\n  if (now.getMonth() === 11 && now.getDate() >= 24)\n    return (\n      <Wrapper>\n        <Message>\n          <FlexPair>\n            <WrenchIcon size='lg' />\n            <SmallTitle>Update News</SmallTitle>\n          </FlexPair>\n          <p> Merry Christmas </p>\n        </Message>\n      </Wrapper>\n    )\n\n  return null\n}\n","import React from 'react'\nimport styled, { css } from 'styled-components'\nimport RandomTip from './RandomTip'\nimport { flexColumnWithGap } from '../../styled/mixins/layout'\nimport UpdateHighlight from './UpdateHighlight'\n\nconst Placeholder = styled.div(\n  ({ theme }) => css`\n    ${flexColumnWithGap}\n    align-items: center;\n    max-width: ${theme.dimensions.bodyWidth};\n    margin: auto;\n\n    padding: 0 ${theme.dimensions.bigSpacing};\n\n    .fa-patreon {\n      color: #ff424d;\n    }\n  `\n)\n\nexport default function SearchPlaceholder() {\n  return (\n    <Placeholder>\n      <UpdateHighlight />\n      <RandomTip />\n    </Placeholder>\n  )\n}\n","import React from 'react'\nimport styled from 'styled-components'\nimport { useSelector } from 'react-redux'\nimport useToggle from '../../hooks/useToggle'\nimport { formatCount } from '../../misc/formatting'\nimport { selectCount } from '../../redux/selectors'\nimport { Title } from '../designsystem/Text'\n\nconst ClickableTitle = styled(Title)`\n  cursor: pointer;\n`\n\nexport default function ResultsTitle() {\n  const [fullNumber, toggleFullNumber] = useToggle()\n  const count = useSelector(selectCount)\n\n  const formattedCount = fullNumber ? count.toLocaleString() : formatCount(count)\n\n  return (\n    <ClickableTitle id='results' onClick={toggleFullNumber}>\n      {formattedCount} results\n    </ClickableTitle>\n  )\n}\n","import React, { useEffect } from 'react'\nimport { useSelector } from 'react-redux'\nimport { selectCount } from '../../redux/selectors'\nimport SearchEditor from '../features/SearchEditor'\nimport Header from '../features/Header'\nimport LayoutElementProps from './LayoutElementProps'\nimport { NO_OP } from '../../data/types'\nimport SearchPlaceholder from '../widgets/SearchPlaceholder'\nimport ResultsTitle from '../widgets/ResultsTitle'\nimport { defaultSpacing } from '../../styled/mixins/gap'\nimport { centeredMaxWidth, flexColumn } from '../../styled/mixins/layout'\nimport styled, { css } from 'styled-components'\nimport { Faded, Title } from '../designsystem/Text'\nimport { Surface } from '../designsystem/Surface'\n\nconst NewsContainter = styled.div`\n  ${flexColumn}\n  ${defaultSpacing}\n  ${centeredMaxWidth}\n`\n\nconst NewsTitle = styled(Title)`\n  ${({ theme }) => css`\n    padding-top: ${theme.dimensions.hugeSpacing};\n  `}\n`\n\nconst NewsGrid = styled(Surface)`\n  grid-template-columns: auto 1fr;\n  grid-template-rows: auto auto;\n  row-gap: 4px;\n  align-items: center;\n`\n\nconst Logo = styled.img`\n  height: 60px;\n  grid-row: span 2;\n`\n\nconst Hero = styled.div(\n  ({ theme }) => css`\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    margin-top: ${theme.dimensions.hugeSpacing};\n    margin-bottom: ${theme.dimensions.hugeSpacing};\n\n    img {\n      max-width: 100%;\n      height: auto;\n      display: block;\n    }\n  `\n)\n\n// const Logo = styled(GoogleIcon)`\n//   height: 60px;\n//   min-width: 40px;\n//   grid-row: span 2;\n// `\n\nexport default function LayoutHeader({ onLoad = NO_OP, virtualRef, style }: LayoutElementProps) {\n  const count = useSelector(selectCount)\n\n  // Trigger load event when count is > 0\n  // This is used to re-measure the element\n  useEffect(() => {\n    count > 0 && onLoad()\n  }, [count, onLoad])\n\n  return (\n    <div onLoad={onLoad} ref={virtualRef} style={style} role='row'>\n      <Header />\n      <Hero>\n        <img src=\"https://raw.githubusercontent.com/squirrelcharts-boop/reimagined-carnival/refs/heads/main/image%20(2).png\" alt=\"hero\" />\n      </Hero>\n      <SearchEditor onLoad={onLoad} />\n      {count > 0 ? <ResultsTitle /> : <SearchPlaceholder />}\n    </div>\n  )\n}\n","import React from 'react'\nimport { useLocation } from 'react-router'\nimport { Link } from 'react-router-dom'\nimport { RouteName } from '../../data/types'\n\nimport { ArrowUp } from '../../icons/FontAwesomeIcons'\nimport { BlockButton } from '../designsystem/Buttons'\n\nexport default function ScrollToTopButton() {\n  const location = useLocation()\n\n  if (location.pathname === RouteName.STORIES) {\n    return <NavigateBackButton />\n  } else {\n    return <ScrollUpButton />\n  }\n}\n\nfunction ScrollUpButton() {\n  const scrollUp = React.useCallback(() => window.scrollTo(0, 0), [])\n\n  return (\n    <BlockButton onClick={scrollUp}>\n      <ArrowUp /> Take me to the top\n    </BlockButton>\n  )\n}\n\nfunction NavigateBackButton() {\n  return (\n    <Link to={RouteName.SEARCH}>\n      <BlockButton>\n        <ArrowUp /> Take me to the top\n      </BlockButton>\n    </Link>\n  )\n}\n","import * as r34 from 'r34-types'\nimport React, { useMemo } from 'react'\nimport { useSelector } from 'react-redux'\nimport styled, { css } from 'styled-components'\nimport { NO_OP } from '../../data/types'\nimport useToggleTag from '../../hooks/useToggleTag'\nimport outOfResultsPicture from '../../icons/OutOfResults.png'\nimport { selectAliasesAsList } from '../../redux/selectors'\nimport FlexImage from '../designsystem/FlexImage'\nimport { HorizontalLine } from '../designsystem/Lines'\nimport { Surface } from '../designsystem/Surface'\nimport { SmallTitle } from '../designsystem/Text'\nimport TagList from '../tag/TagList'\nimport ScrollToTopButton from '../widgets/ScrollToTopButton'\nimport LayoutElementProps from './LayoutElementProps'\n\nconst Div = styled.div(\n  ({ theme }) => css`\n    padding: ${theme.dimensions.bigSpacing};\n  `\n)\n\nconst StyledSurface = styled(Surface)(\n  ({ theme }) => css`\n    max-width: ${theme.dimensions.bodyWidth};\n    margin: auto;\n    text-align: center;\n  `\n)\n\nconst StyledImage = styled(FlexImage)`\n  max-height: 50vh;\n`\n\nexport default function LayoutOutOfItems({ onLoad = NO_OP, virtualRef, style }: LayoutElementProps) {\n  return (\n    <Div style={style} ref={virtualRef} onLoad={onLoad} role='row'>\n      <OutOfItems />\n    </Div>\n  )\n}\n\nexport function OutOfItems() {\n  const aliases = useSelector(selectAliasesAsList)\n  const aliasesForRendering = useMemo(\n    () =>\n      aliases.reduce((result, alias) => {\n        result[alias.name] = { ...alias, types: [] }\n        return result\n      }, {} as Record<string, r34.Tag>),\n    [aliases]\n  )\n  const toggleTag = useToggleTag()\n\n  return (\n    <StyledSurface>\n      <StyledImage src={outOfResultsPicture} alt='Shironeko does not understand' />\n      <HorizontalLine />\n      <SmallTitle>You have reached the end!</SmallTitle>\n      <p>Go look for something else!</p>\n      {aliases.length > 0 && (\n        <>\n          <p>How about some of these?</p>\n          <TagList tags={aliasesForRendering} onTagClick={toggleTag} onTagMenu={NO_OP} detailed />\n        </>\n      )}\n      <ScrollToTopButton />\n    </StyledSurface>\n  )\n}\n","import React from 'react'\nimport LayoutElementProps from './LayoutElementProps'\nimport LoadingIcon from '../../icons/Loading'\nimport styled from 'styled-components'\nimport { NO_OP } from '../../data/types'\n\nconst Wrapper = styled.div`\n  display: grid;\n  place-items: center;\n`\n\nexport default function LayoutLoadingItem({ onLoad = NO_OP, virtualRef, style }: LayoutElementProps) {\n  return (\n    <Wrapper onLoad={onLoad} ref={virtualRef} style={style} role='row'>\n      <LoadingIcon />\n    </Wrapper>\n  )\n}\n","import styled from 'styled-components'\nimport { defaultSpacing } from '../../styled/mixins/gap'\nimport { flexColumn } from '../../styled/mixins/layout'\n\nexport const FlexColumn = styled.div`\n  ${flexColumn}\n  width: 100%;\n  min-height: 100%;\n`\n\nexport const FlexColumnWithSpacing = styled(FlexColumn)`\n  ${defaultSpacing}\n`\n","import React, { ChangeEventHandler, useCallback, useEffect, useState } from 'react'\nimport styled from 'styled-components'\nimport { defaultInput } from '../../styled/mixins/theming'\n\nconst StyledInput = styled.input`\n  ${defaultInput}\n\n  width: 70px;\n  text-align: left;\n`\n\ninterface SmallTextInputProps {\n  value: string\n  onSubmit: (value: string) => void\n  className?: string\n}\n\ninterface SmallNumberInputProps {\n  value: number\n  onSubmit: (value: number) => void\n  min?: number\n  max?: number\n  step?: number\n  className?: string\n}\n\nexport function SmallTextInput(props: SmallTextInputProps) {\n  const { value, onSubmit, className } = props\n  const [internalValue, setInternalValue] = useState(value)\n\n  useEffect(() => {\n    setInternalValue(value)\n  }, [value])\n\n  const onChange: ChangeEventHandler<HTMLInputElement> = useCallback((event) => {\n    setInternalValue(event.target.value)\n  }, [])\n\n  const onBlur = useCallback(() => {\n    onSubmit(internalValue)\n  }, [internalValue, onSubmit])\n\n  const blurOnEnter = useCallback((event) => {\n    if (event.key === 'Enter') {\n      event.target.blur()\n    }\n  }, [])\n\n  return (\n    <StyledInput\n      type='text'\n      value={internalValue}\n      onChange={onChange}\n      onBlur={onBlur}\n      onKeyDown={blurOnEnter}\n      className={className}\n    />\n  )\n}\n\nexport function SmallNumberInput(props: SmallNumberInputProps) {\n  const { value, onSubmit, className, min, max, step } = props\n  const [internalValue, setInternalValue] = useState(value.toString())\n\n  useEffect(() => {\n    setInternalValue(value.toString())\n  }, [value])\n\n  const onChange: ChangeEventHandler<HTMLInputElement> = useCallback((event) => {\n    setInternalValue(event.target.value)\n  }, [])\n\n  const onBlur = useCallback(() => {\n    onSubmit(Number(internalValue))\n  }, [internalValue, onSubmit])\n\n  const blurOnEnter = useCallback((event) => {\n    if (event.key === 'Enter') {\n      event.target.blur()\n    }\n  }, [])\n\n  return (\n    <StyledInput\n      type='number'\n      min={min}\n      max={max}\n      step={step}\n      value={internalValue}\n      onChange={onChange}\n      onBlur={onBlur}\n      onKeyDown={blurOnEnter}\n      className={className}\n    />\n  )\n}\n","import React, { MouseEventHandler, useCallback } from 'react'\nimport { useSelector } from 'react-redux'\nimport styled, { css } from 'styled-components'\nimport { selectLastPage } from '../../../redux/selectors'\nimport { gridWithGap } from '../../../styled/mixins/layout'\nimport { PrimaryButton } from '../../designsystem/Buttons'\nimport { SmallNumberInput } from '../../designsystem/SmallInput'\n\nconst PageRow = styled.div(\n  ({ theme }) => css`\n    ${gridWithGap}\n    grid-template-columns: 1fr auto 1fr;\n    justify-content: center;\n    place-items: center;\n    padding: ${theme.dimensions.bigSpacing};\n    padding-bottom: 0;\n    max-width: ${theme.dimensions.bodyWidth};\n    margin: auto;\n  `\n)\nconst Left = styled.div`\n  display: flex;\n  place-self: flex-end;\n  gap: 8px;\n`\nconst Right = styled.div`\n  display: flex;\n  place-self: flex-start;\n  gap: 8px;\n`\n\nconst PageNumber = styled(PrimaryButton)`\n  min-width: 50px;\n`\n\nconst CurrentNumber = styled(SmallNumberInput)`\n  min-width: 50px;\n`\n\ninterface PageNavigationProps {\n  currentPage: number\n  loadPage: (pageNumber: number) => void\n}\n\nexport default function PageNavigation(props: PageNavigationProps) {\n  const { currentPage, loadPage } = props\n\n  const lastPage = useSelector(selectLastPage)\n\n  const loadSpecificPage = useCallback((newPage: number | string) => loadPage(Number(newPage)), [loadPage])\n  const loadFirst: MouseEventHandler<HTMLButtonElement> = useCallback(() => loadPage(0), [loadPage])\n  const loadLast: MouseEventHandler<HTMLButtonElement> = useCallback(() => loadPage(lastPage), [loadPage, lastPage])\n  const loadPrevious: MouseEventHandler<HTMLButtonElement> = useCallback(\n    () => loadPage(currentPage - 1),\n    [currentPage, loadPage]\n  )\n  const loadNext: MouseEventHandler<HTMLButtonElement> = useCallback(\n    () => loadPage(currentPage + 1),\n    [currentPage, loadPage]\n  )\n\n  // Render Empty divs to keep everything lined up\n  // Could achive the same with grid-column (might do that in the future)\n  return (\n    <PageRow className='page-navigation'>\n      <Left>\n        {currentPage > 1 && (\n          <PageNumber onClick={loadFirst} title='First Page'>\n            0\n          </PageNumber>\n        )}\n        {currentPage > 0 && (\n          <PageNumber onClick={loadPrevious} title='Previous page'>\n            {currentPage - 1}\n          </PageNumber>\n        )}\n      </Left>\n      <CurrentNumber value={currentPage} onSubmit={loadSpecificPage} min={0} max={lastPage} step={1} />\n      <Right>\n        {currentPage < lastPage && (\n          <PageNumber onClick={loadNext} title='Next Page'>\n            {currentPage + 1}\n          </PageNumber>\n        )}\n        {currentPage < lastPage - 1 && (\n          <PageNumber onClick={loadLast} title='Last Page'>\n            {lastPage}\n          </PageNumber>\n        )}\n      </Right>\n    </PageRow>\n  )\n}\n","import React, { ReactNode, useCallback } from 'react'\nimport styled, { css } from 'styled-components'\nimport { Post } from 'r34-types'\nimport { FlexColumn } from '../../designsystem/FlexColumn'\nimport PageNavigation from './PageNavigation'\n\nconst PageLayoutFlexColumn = styled(FlexColumn)(\n  ({ theme }) => css`\n    padding-bottom: ${theme.dimensions.bigSpacing};\n  `\n)\n\ninterface PageLayoutProps<T> {\n  header?: ReactNode\n  outOfItems?: ReactNode\n  items?: T[]\n  pageSize: number\n  currentPage: number\n  hasMorePages: boolean\n  loadPage: (pageNumber: number) => void\n  ItemComponent: (props: T & { index: number }) => JSX.Element\n  isLoading: boolean\n}\n\nexport default function PageLayout(props: PageLayoutProps<Post>) {\n  const { header, items, ItemComponent, currentPage, loadPage } = props\n\n  const scrollAndLoadPage = useCallback(\n    (value: number) => {\n      loadPage(value)\n      document.getElementsByClassName('page-navigation')[0].scrollIntoView()\n    },\n    [loadPage]\n  )\n\n  return (\n    <PageLayoutFlexColumn>\n      {header}\n      {items && items.length > 0 && (\n        <>\n          <PageNavigation currentPage={currentPage} loadPage={loadPage} />\n          {items?.map((item, index) => (\n            <ItemComponent key={item.id} index={index} {...item} />\n          ))}\n          <PageNavigation currentPage={currentPage} loadPage={scrollAndLoadPage} />\n        </>\n      )}\n    </PageLayoutFlexColumn>\n  )\n}\n","import React, { useCallback, useEffect, useState } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport InifinteColumn from '../layout/infinite/InfiniteColumn'\nimport { ListPost } from '../post/Post'\nimport { getMoreResults, getResults } from '../../redux/actions'\nimport {\n  selectHasMoreResults,\n  selectPageNumber,\n  selectPageSize,\n  selectPosts,\n  selectResultsLayout,\n  selectUpdated,\n} from '../../redux/selectors'\nimport { selectActiveTags } from '../../redux/selectors'\nimport { addTag } from '../../redux/actions'\nimport { serializeTagname } from '../../data/tagUtils'\nimport LayoutHeader from '../layout/LayoutHeader'\nimport LayoutOutOfItems from '../layout/LayoutOutOfItems'\nimport LayoutLoadingItem from '../layout/LayoutLoadingItem'\nimport PageLayout from '../layout/pages/PageLayout'\nimport { useScrollUpBackNavigation } from '../../hooks/useScrollUpBackNavigation'\nimport { usePageTitle } from '../../hooks/usePageTitle'\n\nexport default function Search() {\n  const [isLoading, setLoading] = useState(false)\n\n  const dispatch = useDispatch()\n  const activeTags = useSelector(selectActiveTags)\n  const [lastUpdated, setLastUpdated] = useState(-1)\n\n  const updated = useSelector(selectUpdated)\n  const posts = useSelector(selectPosts)\n  const hasMorePosts = useSelector(selectHasMoreResults)\n  const resultsLayout = useSelector(selectResultsLayout)\n  const pageSize = useSelector(selectPageSize)\n  const pageNumber = useSelector(selectPageNumber)\n\n  const loadMore = useCallback(() => {\n    setLoading(true)\n    dispatch(getMoreResults())\n  }, [dispatch])\n\n  const loadPage = useCallback(\n    (index: number) => {\n      setLoading(true)\n      dispatch(getResults(index))\n    },\n    [dispatch]\n  )\n\n  React.useEffect(() => {\n    if (isLoading && updated > lastUpdated) {\n      setLoading(false)\n      setLastUpdated(new Date().getTime())\n    }\n  }, [isLoading, lastUpdated, updated])\n\n  useScrollUpBackNavigation('#results')\n\n  // Compute a readable title from active tags\n  const makeTitleFromTags = () => {\n    const names = Object.keys(activeTags || {})\n    if (!names || names.length === 0) return 'Rule 34'\n    const pretty = names\n      .map((n) => decodeURIComponent(n).replace(/_/g, ' '))\n      .join(' ')\n    return `Rule 34 - ${pretty}`\n  }\n\n  usePageTitle(makeTitleFromTags())\n\n  // Parse tags from the URL hash on mount (format: #/...tags=tag1,tag2)\n  useEffect(() => {\n    try {\n      const hash = window.location.hash || ''\n      // extract query part after ?\n      const qIndex = hash.indexOf('?')\n      if (qIndex !== -1) {\n        const query = new URLSearchParams(hash.slice(qIndex + 1))\n        const tagsParam = query.get('tags')\n        if (tagsParam) {\n          const parts = tagsParam.split(',').filter(Boolean)\n          parts.forEach((p) => {\n            // format: optional leading '-' for negative modifier, then serialized name\n            const isNegative = p[0] === '-'\n            const raw = isNegative ? p.slice(1) : p\n            const name = decodeURIComponent(raw)\n            const modifier = isNegative ? '-' : '+'\n            dispatch(addTag({ name, types: [], modifier }))\n          })\n        }\n      }\n    } catch (e) {\n      // ignore\n    }\n    // run only on mount\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  // Sync active tags to URL hash when they change\n  useEffect(() => {\n    try {\n      const entries = Object.values(activeTags || {}).map((t) => {\n        const mod = (t as any).modifier === '-' ? '-' : ''\n        return `${mod}${encodeURIComponent(serializeTagname((t as any).name))}`\n      })\n      if (entries.length === 0) return\n      const encoded = entries.join(',')\n      // preserve existing path (hash until '?') and append query\n      const hash = window.location.hash || '#/'\n      const path = hash.split('?')[0]\n      window.history.replaceState(null, '', `${path}?tags=${encoded}`)\n    } catch (e) {\n      // ignore\n    }\n  }, [activeTags])\n\n  // Automatically trigger a search when active tags change (or on load if tags are present)\n  React.useEffect(() => {\n    const names = Object.keys(activeTags || {})\n    const id = setTimeout(() => {\n      if (names.length > 0) {\n        dispatch(getResults(0))\n      }\n    }, 100)\n\n    return () => clearTimeout(id)\n  }, [activeTags, dispatch])\n\n  return (\n    <>\n      {resultsLayout === 'infinite_column' ? (\n        <InifinteColumn\n          Header={LayoutHeader}\n          OutOfItems={LayoutOutOfItems}\n          items={posts}\n          LoadingItem={LayoutLoadingItem}\n          hasMoreRows={hasMorePosts}\n          ItemComponent={ListPost}\n          loadMore={loadMore}\n          isLoading={isLoading}\n        />\n      ) : (\n        <PageLayout\n          header={<LayoutHeader />}\n          pageSize={pageSize}\n          currentPage={pageNumber}\n          hasMorePages={hasMorePosts}\n          loadPage={loadPage}\n          ItemComponent={ListPost}\n          isLoading={isLoading}\n          items={posts}\n        />\n      )}\n    </>\n  )\n}\n","import React from 'react'\nimport { useHistory } from 'react-router-dom'\n\n/**\n * This hook adds a hash to the current route when scrolling down,\n * which causes the first back navigation to scroll up before really going back.\n * Really useful in infinite layouts where you need a quick way to go back up.\n */\nexport function useScrollUpBackNavigation(hash: string) {\n  const history = useHistory()\n  React.useEffect(() => {\n    if (history.location.hash !== hash) {\n      const listener = () => {\n        history.push({ pathname: history.location.pathname, hash })\n      }\n      document.addEventListener('scroll', listener, { passive: true, once: true })\n      return () => document.removeEventListener('scroll', listener)\n    }\n  }, [hash, history])\n}\n","import React from 'react'\n\n/**\n * Effect that sets the title of the page to a specified string.\n * Really small utility hook that saves a few lines.\n */\nexport function usePageTitle(title: string) {\n  React.useEffect(() => {\n    document.title = title\n  }, [title])\n}\n"],"sourceRoot":""}